<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>MySQL练习题 | MasterYangBlog</title><meta name="description" content="MySQL练习题"><meta name="keywords" content="SQL,MySQL"><meta name="author" content="Yang4"><meta name="copyright" content="Yang4"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="MySQL练习题"><meta name="twitter:description" content="MySQL练习题"><meta name="twitter:image" content="https://pic.downk.cc/item/5eeb147114195aa5946b0444.jpg"><meta property="og:type" content="article"><meta property="og:title" content="MySQL练习题"><meta property="og:url" content="https://masteryang4.github.io/2020/06/18/MySQL%E7%BB%83%E4%B9%A0%E9%A2%98/"><meta property="og:site_name" content="MasterYangBlog"><meta property="og:description" content="MySQL练习题"><meta property="og:image" content="https://pic.downk.cc/item/5eeb147114195aa5946b0444.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://masteryang4.github.io/2020/06/18/MySQL%E7%BB%83%E4%B9%A0%E9%A2%98/"><link rel="next" title="kafka知识整理" href="https://masteryang4.github.io/2020/06/18/kafka%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://masteryang4.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="MasterYangBlog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">MasterYangBlog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/n.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">46</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">43</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">23</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#MySQL练习题"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">MySQL练习题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-组合两个表"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">1. 组合两个表</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-第二高的薪水"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">2. 第二高的薪水</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-分数排名"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">3. 分数排名</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-连续出现的数字"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">4. 连续出现的数字</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-超过经理收入的员工"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">5. 超过经理收入的员工</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#6-查找重复的邮箱"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">6. 查找重复的邮箱</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-从不订购的客户"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">7. 从不订购的客户</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#8-部门工资最高的员工"><span class="toc_mobile_items-number">1.8.</span> <span class="toc_mobile_items-text">8. 部门工资最高的员工</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#9-删除重复的电子邮箱"><span class="toc_mobile_items-number">1.9.</span> <span class="toc_mobile_items-text">9. 删除重复的电子邮箱</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#10-上升的温度"><span class="toc_mobile_items-number">1.10.</span> <span class="toc_mobile_items-text">10. 上升的温度</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#11-行程和用户"><span class="toc_mobile_items-number">1.11.</span> <span class="toc_mobile_items-text">11. 行程和用户</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#12-游戏玩法分析"><span class="toc_mobile_items-number">1.12.</span> <span class="toc_mobile_items-text">12. 游戏玩法分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#13-员工薪水中位数"><span class="toc_mobile_items-number">1.13.</span> <span class="toc_mobile_items-text">13. 员工薪水中位数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#14-至少有5名直接下属的经理"><span class="toc_mobile_items-number">1.14.</span> <span class="toc_mobile_items-text">14. 至少有5名直接下属的经理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#15-给定数字的频率查询中位数"><span class="toc_mobile_items-number">1.15.</span> <span class="toc_mobile_items-text">15. 给定数字的频率查询中位数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#16-当选者"><span class="toc_mobile_items-number">1.16.</span> <span class="toc_mobile_items-text">16. 当选者</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#17-员工奖金"><span class="toc_mobile_items-number">1.17.</span> <span class="toc_mobile_items-text">17. 员工奖金</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#18-最高回答率"><span class="toc_mobile_items-number">1.18.</span> <span class="toc_mobile_items-text">18. 最高回答率</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#19-员工累计薪水"><span class="toc_mobile_items-number">1.19.</span> <span class="toc_mobile_items-text">19. 员工累计薪水</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#20-统计各专业人数"><span class="toc_mobile_items-number">1.20.</span> <span class="toc_mobile_items-text">20. 统计各专业人数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#21-寻找用户推荐人"><span class="toc_mobile_items-number">1.21.</span> <span class="toc_mobile_items-text">21. 寻找用户推荐人</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#22-2016年的投资"><span class="toc_mobile_items-number">1.22.</span> <span class="toc_mobile_items-text">22. 2016年的投资</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#23-订单最多的客户"><span class="toc_mobile_items-number">1.23.</span> <span class="toc_mobile_items-text">23. 订单最多的客户</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#24-大的国家"><span class="toc_mobile_items-number">1.24.</span> <span class="toc_mobile_items-text">24. 大的国家</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#25-超过五名学生的课"><span class="toc_mobile_items-number">1.25.</span> <span class="toc_mobile_items-text">25. 超过五名学生的课</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#26-好友申请"><span class="toc_mobile_items-number">1.26.</span> <span class="toc_mobile_items-text">26. 好友申请</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#27-体育馆人流量"><span class="toc_mobile_items-number">1.27.</span> <span class="toc_mobile_items-text">27. 体育馆人流量</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#28-连续空余座位"><span class="toc_mobile_items-number">1.28.</span> <span class="toc_mobile_items-text">28. 连续空余座位</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#29-销售员"><span class="toc_mobile_items-number">1.29.</span> <span class="toc_mobile_items-text">29. 销售员</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#30-节点树"><span class="toc_mobile_items-number">1.30.</span> <span class="toc_mobile_items-text">30. 节点树</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#31-判断是否是三角形"><span class="toc_mobile_items-number">1.31.</span> <span class="toc_mobile_items-text">31. 判断是否是三角形</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#32-平面上的最近距离"><span class="toc_mobile_items-number">1.32.</span> <span class="toc_mobile_items-text">32. 平面上的最近距离</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#33-直线上最近距离"><span class="toc_mobile_items-number">1.33.</span> <span class="toc_mobile_items-text">33. 直线上最近距离</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#34-二级关注者"><span class="toc_mobile_items-number">1.34.</span> <span class="toc_mobile_items-text">34. 二级关注者</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#35-平均工资"><span class="toc_mobile_items-number">1.35.</span> <span class="toc_mobile_items-text">35. 平均工资</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#36-学生地理信息报告"><span class="toc_mobile_items-number">1.36.</span> <span class="toc_mobile_items-text">36. 学生地理信息报告</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#37-只出现一次的最大数字"><span class="toc_mobile_items-number">1.37.</span> <span class="toc_mobile_items-text">37. 只出现一次的最大数字</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#38-有趣的电影"><span class="toc_mobile_items-number">1.38.</span> <span class="toc_mobile_items-text">38. 有趣的电影</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#39-换座位"><span class="toc_mobile_items-number">1.39.</span> <span class="toc_mobile_items-text">39. 换座位</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#40-交换工资"><span class="toc_mobile_items-number">1.40.</span> <span class="toc_mobile_items-text">40. 交换工资</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#41-买下所有产品的用户"><span class="toc_mobile_items-number">1.41.</span> <span class="toc_mobile_items-text">41. 买下所有产品的用户</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#42-合作过至少三次的演员和导演"><span class="toc_mobile_items-number">1.42.</span> <span class="toc_mobile_items-text">42. 合作过至少三次的演员和导演</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#43-产品销售分析"><span class="toc_mobile_items-number">1.43.</span> <span class="toc_mobile_items-text">43. 产品销售分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#44-项目员工"><span class="toc_mobile_items-number">1.44.</span> <span class="toc_mobile_items-text">44. 项目员工</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#45-销售分析"><span class="toc_mobile_items-number">1.45.</span> <span class="toc_mobile_items-text">45. 销售分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#46-小众书籍"><span class="toc_mobile_items-number">1.46.</span> <span class="toc_mobile_items-text">46. 小众书籍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#47-每日新用户统计"><span class="toc_mobile_items-number">1.47.</span> <span class="toc_mobile_items-text">47. 每日新用户统计</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#48-每位学生的最高成绩"><span class="toc_mobile_items-number">1.48.</span> <span class="toc_mobile_items-text">48. 每位学生的最高成绩</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#49-Reported-Posts"><span class="toc_mobile_items-number">1.49.</span> <span class="toc_mobile_items-text">49. Reported Posts</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#50-Active-Businesses"><span class="toc_mobile_items-number">1.50.</span> <span class="toc_mobile_items-text">50. Active Businesses</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#51-User-Purchase-Platform"><span class="toc_mobile_items-number">1.51.</span> <span class="toc_mobile_items-text">51. User Purchase Platform</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#52-User-Activity-for-the-Past-30-Days"><span class="toc_mobile_items-number">1.52.</span> <span class="toc_mobile_items-text">52. User Activity for the Past 30 Days</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#52-文章浏览"><span class="toc_mobile_items-number">1.53.</span> <span class="toc_mobile_items-text">52. 文章浏览</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#53-Market-Analysis"><span class="toc_mobile_items-number">1.54.</span> <span class="toc_mobile_items-text">53. Market Analysis</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#54-Product-Price-at-a-Given-Date"><span class="toc_mobile_items-number">1.55.</span> <span class="toc_mobile_items-text">54. Product Price at a Given Date</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#55-Immediate-Food-Delivery"><span class="toc_mobile_items-number">1.56.</span> <span class="toc_mobile_items-text">55. Immediate Food Delivery</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#56-重新格式化部门表"><span class="toc_mobile_items-number">1.57.</span> <span class="toc_mobile_items-text">56. 重新格式化部门表</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#57-每月交易"><span class="toc_mobile_items-number">1.58.</span> <span class="toc_mobile_items-text">57. 每月交易</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#58-锦标赛优胜者"><span class="toc_mobile_items-number">1.59.</span> <span class="toc_mobile_items-text">58. 锦标赛优胜者</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#59-Last-Person-to-Fit-in-the-Elevator"><span class="toc_mobile_items-number">1.60.</span> <span class="toc_mobile_items-text">59. Last Person to Fit in the Elevator</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#60-Queries-Quality-and-Percentage"><span class="toc_mobile_items-number">1.61.</span> <span class="toc_mobile_items-text">60. Queries Quality and Percentage</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#61-Team-Scores-in-Football-Tournament"><span class="toc_mobile_items-number">1.62.</span> <span class="toc_mobile_items-text">61. Team Scores in Football Tournament</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#62-报告系统状态的连续日期"><span class="toc_mobile_items-number">1.63.</span> <span class="toc_mobile_items-text">62. 报告系统状态的连续日期</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#62-每个帖子的评论数"><span class="toc_mobile_items-number">1.64.</span> <span class="toc_mobile_items-text">62. 每个帖子的评论数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#63-Average-Selling-Price"><span class="toc_mobile_items-number">1.65.</span> <span class="toc_mobile_items-text">63. Average Selling Price</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#64-Page-Recommendations"><span class="toc_mobile_items-number">1.66.</span> <span class="toc_mobile_items-text">64. Page Recommendations</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#65-All-People-Report-to-the-Given-Manager"><span class="toc_mobile_items-number">1.67.</span> <span class="toc_mobile_items-text">65. All People Report to the Given Manager</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL练习题"><span class="toc-number">1.</span> <span class="toc-text">MySQL练习题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-组合两个表"><span class="toc-number">1.1.</span> <span class="toc-text">1. 组合两个表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-第二高的薪水"><span class="toc-number">1.2.</span> <span class="toc-text">2. 第二高的薪水</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-分数排名"><span class="toc-number">1.3.</span> <span class="toc-text">3. 分数排名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-连续出现的数字"><span class="toc-number">1.4.</span> <span class="toc-text">4. 连续出现的数字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-超过经理收入的员工"><span class="toc-number">1.5.</span> <span class="toc-text">5. 超过经理收入的员工</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-查找重复的邮箱"><span class="toc-number">1.6.</span> <span class="toc-text">6. 查找重复的邮箱</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-从不订购的客户"><span class="toc-number">1.7.</span> <span class="toc-text">7. 从不订购的客户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-部门工资最高的员工"><span class="toc-number">1.8.</span> <span class="toc-text">8. 部门工资最高的员工</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-删除重复的电子邮箱"><span class="toc-number">1.9.</span> <span class="toc-text">9. 删除重复的电子邮箱</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-上升的温度"><span class="toc-number">1.10.</span> <span class="toc-text">10. 上升的温度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-行程和用户"><span class="toc-number">1.11.</span> <span class="toc-text">11. 行程和用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-游戏玩法分析"><span class="toc-number">1.12.</span> <span class="toc-text">12. 游戏玩法分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-员工薪水中位数"><span class="toc-number">1.13.</span> <span class="toc-text">13. 员工薪水中位数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-至少有5名直接下属的经理"><span class="toc-number">1.14.</span> <span class="toc-text">14. 至少有5名直接下属的经理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-给定数字的频率查询中位数"><span class="toc-number">1.15.</span> <span class="toc-text">15. 给定数字的频率查询中位数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-当选者"><span class="toc-number">1.16.</span> <span class="toc-text">16. 当选者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-员工奖金"><span class="toc-number">1.17.</span> <span class="toc-text">17. 员工奖金</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-最高回答率"><span class="toc-number">1.18.</span> <span class="toc-text">18. 最高回答率</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-员工累计薪水"><span class="toc-number">1.19.</span> <span class="toc-text">19. 员工累计薪水</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-统计各专业人数"><span class="toc-number">1.20.</span> <span class="toc-text">20. 统计各专业人数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-寻找用户推荐人"><span class="toc-number">1.21.</span> <span class="toc-text">21. 寻找用户推荐人</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-2016年的投资"><span class="toc-number">1.22.</span> <span class="toc-text">22. 2016年的投资</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-订单最多的客户"><span class="toc-number">1.23.</span> <span class="toc-text">23. 订单最多的客户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-大的国家"><span class="toc-number">1.24.</span> <span class="toc-text">24. 大的国家</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-超过五名学生的课"><span class="toc-number">1.25.</span> <span class="toc-text">25. 超过五名学生的课</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-好友申请"><span class="toc-number">1.26.</span> <span class="toc-text">26. 好友申请</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-体育馆人流量"><span class="toc-number">1.27.</span> <span class="toc-text">27. 体育馆人流量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-连续空余座位"><span class="toc-number">1.28.</span> <span class="toc-text">28. 连续空余座位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-销售员"><span class="toc-number">1.29.</span> <span class="toc-text">29. 销售员</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-节点树"><span class="toc-number">1.30.</span> <span class="toc-text">30. 节点树</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31-判断是否是三角形"><span class="toc-number">1.31.</span> <span class="toc-text">31. 判断是否是三角形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-平面上的最近距离"><span class="toc-number">1.32.</span> <span class="toc-text">32. 平面上的最近距离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-直线上最近距离"><span class="toc-number">1.33.</span> <span class="toc-text">33. 直线上最近距离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#34-二级关注者"><span class="toc-number">1.34.</span> <span class="toc-text">34. 二级关注者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#35-平均工资"><span class="toc-number">1.35.</span> <span class="toc-text">35. 平均工资</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#36-学生地理信息报告"><span class="toc-number">1.36.</span> <span class="toc-text">36. 学生地理信息报告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#37-只出现一次的最大数字"><span class="toc-number">1.37.</span> <span class="toc-text">37. 只出现一次的最大数字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#38-有趣的电影"><span class="toc-number">1.38.</span> <span class="toc-text">38. 有趣的电影</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#39-换座位"><span class="toc-number">1.39.</span> <span class="toc-text">39. 换座位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#40-交换工资"><span class="toc-number">1.40.</span> <span class="toc-text">40. 交换工资</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#41-买下所有产品的用户"><span class="toc-number">1.41.</span> <span class="toc-text">41. 买下所有产品的用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-合作过至少三次的演员和导演"><span class="toc-number">1.42.</span> <span class="toc-text">42. 合作过至少三次的演员和导演</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43-产品销售分析"><span class="toc-number">1.43.</span> <span class="toc-text">43. 产品销售分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44-项目员工"><span class="toc-number">1.44.</span> <span class="toc-text">44. 项目员工</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45-销售分析"><span class="toc-number">1.45.</span> <span class="toc-text">45. 销售分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#46-小众书籍"><span class="toc-number">1.46.</span> <span class="toc-text">46. 小众书籍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#47-每日新用户统计"><span class="toc-number">1.47.</span> <span class="toc-text">47. 每日新用户统计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#48-每位学生的最高成绩"><span class="toc-number">1.48.</span> <span class="toc-text">48. 每位学生的最高成绩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#49-Reported-Posts"><span class="toc-number">1.49.</span> <span class="toc-text">49. Reported Posts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#50-Active-Businesses"><span class="toc-number">1.50.</span> <span class="toc-text">50. Active Businesses</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51-User-Purchase-Platform"><span class="toc-number">1.51.</span> <span class="toc-text">51. User Purchase Platform</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-User-Activity-for-the-Past-30-Days"><span class="toc-number">1.52.</span> <span class="toc-text">52. User Activity for the Past 30 Days</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-文章浏览"><span class="toc-number">1.53.</span> <span class="toc-text">52. 文章浏览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-Market-Analysis"><span class="toc-number">1.54.</span> <span class="toc-text">53. Market Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#54-Product-Price-at-a-Given-Date"><span class="toc-number">1.55.</span> <span class="toc-text">54. Product Price at a Given Date</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#55-Immediate-Food-Delivery"><span class="toc-number">1.56.</span> <span class="toc-text">55. Immediate Food Delivery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#56-重新格式化部门表"><span class="toc-number">1.57.</span> <span class="toc-text">56. 重新格式化部门表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#57-每月交易"><span class="toc-number">1.58.</span> <span class="toc-text">57. 每月交易</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#58-锦标赛优胜者"><span class="toc-number">1.59.</span> <span class="toc-text">58. 锦标赛优胜者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#59-Last-Person-to-Fit-in-the-Elevator"><span class="toc-number">1.60.</span> <span class="toc-text">59. Last Person to Fit in the Elevator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#60-Queries-Quality-and-Percentage"><span class="toc-number">1.61.</span> <span class="toc-text">60. Queries Quality and Percentage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#61-Team-Scores-in-Football-Tournament"><span class="toc-number">1.62.</span> <span class="toc-text">61. Team Scores in Football Tournament</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#62-报告系统状态的连续日期"><span class="toc-number">1.63.</span> <span class="toc-text">62. 报告系统状态的连续日期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#62-每个帖子的评论数"><span class="toc-number">1.64.</span> <span class="toc-text">62. 每个帖子的评论数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#63-Average-Selling-Price"><span class="toc-number">1.65.</span> <span class="toc-text">63. Average Selling Price</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#64-Page-Recommendations"><span class="toc-number">1.66.</span> <span class="toc-text">64. Page Recommendations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#65-All-People-Report-to-the-Given-Manager"><span class="toc-number">1.67.</span> <span class="toc-text">65. All People Report to the Given Manager</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://pic.downk.cc/item/5eeb147114195aa5946b0444.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">MySQL练习题</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-06-18<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-06-18</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SQL/">SQL</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SQL/MySQL/">MySQL</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="MySQL练习题"><a href="#MySQL练习题" class="headerlink" title="MySQL练习题"></a>MySQL练习题</h1><h2 id="1-组合两个表"><a href="#1-组合两个表" class="headerlink" title="1. 组合两个表"></a>1. 组合两个表</h2><p>需求：编写一个 SQL 查询，对两表进行关联，展示列为：<br>FirstName, LastName, City, State</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>FirstName</th>
<th>LastName</th>
<th>City</th>
<th>State</th>
</tr>
</thead>
<tbody><tr>
<td>Allen</td>
<td>Wang</td>
<td>New York City</td>
<td>New York</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Create table Person (PersonId int, FirstName varchar(255), LastName varchar(255));</span><br><span class="line"></span><br><span class="line">Create table Address (AddressId int, PersonId int, City varchar(255), State varchar(255));</span><br><span class="line"></span><br><span class="line">insert into Person (PersonId, LastName, FirstName) values (1, &#39;Wang&#39;, &#39;Allen&#39;);</span><br><span class="line">insert into Address (AddressId, PersonId, City, State) values (1, 1, &#39;New York City&#39;, &#39;New York&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">     p.FirstName,</span><br><span class="line">     p.LastName,</span><br><span class="line">     a.City,</span><br><span class="line">     a.State</span><br><span class="line">from </span><br><span class="line">     Person as p </span><br><span class="line">left join </span><br><span class="line">     Address as a </span><br><span class="line">on </span><br><span class="line">     p.PersonId &#x3D; a.PersonId;</span><br></pre></td></tr></table></figure></div>

<h2 id="2-第二高的薪水"><a href="#2-第二高的薪水" class="headerlink" title="2. 第二高的薪水"></a>2. 第二高的薪水</h2><p><strong>需求二</strong>：编写一个 SQL 查询，获取 Employee 表中第二高的薪水（Salary）。如果不存在第二高的薪水，那么查询应返回 null。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>SecondHighestSalary</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
</tr>
</tbody></table>
<p>建表语句：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Employee (Id int, Salary int);</span><br><span class="line"></span><br><span class="line">insert into Employee (Id, Salary) values (1, 100);</span><br><span class="line">insert into Employee (Id, Salary) values (2, 200);</span><br><span class="line">insert into Employee (Id, Salary) values (3, 300);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">select (</span><br><span class="line">	     select </span><br><span class="line">               DISTINCT Salary</span><br><span class="line">	     from  </span><br><span class="line">               Employee</span><br><span class="line">	     order by</span><br><span class="line">               Salary DESC</span><br><span class="line">	     limit 1,1</span><br><span class="line">      )  as SecondHighestSalary;</span><br><span class="line">方法二：</span><br><span class="line">select </span><br><span class="line">       max(Salary) as SecondHighestSalary </span><br><span class="line">from </span><br><span class="line">       Employee</span><br><span class="line">where </span><br><span class="line">       Salary &lt; (select</span><br><span class="line">                       max(Salary) </span><br><span class="line">                 from </span><br><span class="line">                       Employee</span><br><span class="line">                );</span><br></pre></td></tr></table></figure></div>

<p>提示：LIMIT 子句可以被用于强制 SELECT 语句返回指定的记录数。LIMIT 接受一个或两个数字参数。参数必须是一个整数常量。如果给定两个参数，第一个参数指定第一个返回记录行的偏移量，第二个参数指定返回记录行的最大数目。</p>
<p><strong>需求二</strong>：编写一个 SQL 查询，获取 Employee 表中第 n 高的薪水（Salary）。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT</span><br><span class="line">BEGIN</span><br><span class="line">  SET n &#x3D; N-1;</span><br><span class="line">  RETURN (     </span><br><span class="line">  SELECT DISTINCT Salary FROM Employee ORDER BY Salary DESC LIMIT n,1</span><br><span class="line">  );</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">select getNthHighestSalary(2) ;</span><br><span class="line"></span><br><span class="line">方案二：</span><br><span class="line">CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT</span><br><span class="line">BEGIN</span><br><span class="line">  RETURN (     </span><br><span class="line">  SELECT  IF(count&lt;N,NULL,min) </span><br><span class="line">  FROM</span><br><span class="line">    (SELECT MIN(Salary) AS min, COUNT(1) AS count</span><br><span class="line">    FROM</span><br><span class="line">      (SELECT DISTINCT Salary</span><br><span class="line">      FROM Employee ORDER BY Salary DESC LIMIT N) AS a</span><br><span class="line">    ) as b</span><br><span class="line">  );</span><br><span class="line">END</span><br></pre></td></tr></table></figure></div>

<h2 id="3-分数排名"><a href="#3-分数排名" class="headerlink" title="3. 分数排名"></a>3. 分数排名</h2><p>需求：编写一个 SQL 查询来实现分数排名。如果两个分数相同，则两个分数排名（Rank）相同。请注意，平分后的下一个名次应该是下一个连续的整数值。换句话说，名次之间不应该有“间隔”。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Score</th>
<th>Rank</th>
</tr>
</thead>
<tbody><tr>
<td>4.00</td>
<td>1</td>
</tr>
<tr>
<td>4.00</td>
<td>1</td>
</tr>
<tr>
<td>3.85</td>
<td>2</td>
</tr>
<tr>
<td>3.65</td>
<td>3</td>
</tr>
<tr>
<td>3.65</td>
<td>3</td>
</tr>
<tr>
<td>3.50</td>
<td>4</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Scores (Id int, Score DECIMAL(3,2));</span><br><span class="line"></span><br><span class="line">insert into Scores (Id, Score) values (1, 3.5);</span><br><span class="line">insert into Scores (Id, Score) values (2, 3.65);</span><br><span class="line">insert into Scores (Id, Score) values (3, 4.0);</span><br><span class="line">insert into Scores (Id, Score) values (4, 3.85);</span><br><span class="line">insert into Scores (Id, Score) values (5, 4.0);</span><br><span class="line">insert into Scores (Id, Score) values (6, 3.65);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      a.Score as score , </span><br><span class="line">      (select </span><br><span class="line">              count(distinct b.Score) </span><br><span class="line">       from </span><br><span class="line">              Scores b </span><br><span class="line">       where </span><br><span class="line">              b.Score &gt;&#x3D;a.Score) as rank</span><br><span class="line">from </span><br><span class="line">     Scores a </span><br><span class="line">order by </span><br><span class="line">     Score DESC;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-连续出现的数字"><a href="#4-连续出现的数字" class="headerlink" title="4. 连续出现的数字"></a>4. 连续出现的数字</h2><p>需求：编写一个 SQL 查询，查找所有至少连续出现三次的数字。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>ConsecutiveNums</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Logs (Id int, Num int);</span><br><span class="line"></span><br><span class="line">insert into Logs (Id, Num) values (1, 1);</span><br><span class="line">insert into Logs (Id, Num) values (2, 1);</span><br><span class="line">insert into Logs (Id, Num) values (3, 1);</span><br><span class="line">insert into Logs (Id, Num) values (4, 2);</span><br><span class="line">insert into Logs (Id, Num) values (5, 1);</span><br><span class="line">insert into Logs (Id, Num) values (6, 2);</span><br><span class="line">insert into Logs (Id, Num) values (7, 2);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM</span><br><span class="line">    Logs l1,</span><br><span class="line">    Logs l2,</span><br><span class="line">    Logs l3</span><br><span class="line">WHERE</span><br><span class="line">    l1.Id &#x3D; l2.Id - 1 AND l1.Num &#x3D; l2.Num</span><br><span class="line">    AND l2.Id &#x3D; l3.Id - 1 AND l2.Num &#x3D; l3.Num;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-超过经理收入的员工"><a href="#5-超过经理收入的员工" class="headerlink" title="5. 超过经理收入的员工"></a>5. 超过经理收入的员工</h2><p>需求：Employee 表包含所有员工，他们的经理也属于员工。每个员工都有一个 Id，此外还有一列对应员工的经理的 Id。</p>
<p>数据样式：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Name</th>
<th>Salary</th>
<th>ManagerId</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Joe</td>
<td>70000</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>Henry</td>
<td>80000</td>
<td>4</td>
</tr>
<tr>
<td>3</td>
<td>Sam</td>
<td>60000</td>
<td>null</td>
</tr>
<tr>
<td>4</td>
<td>Max</td>
<td>90000</td>
<td>null</td>
</tr>
</tbody></table>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Employee</th>
</tr>
</thead>
<tbody><tr>
<td>Joe</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table If Not Exists Employee (Id int, Name varchar(255), Salary int, ManagerId int);</span><br><span class="line"></span><br><span class="line">insert into Employee (Id, Name, Salary, ManagerId) values (1, &#39;Joe&#39;, 70000, 3);</span><br><span class="line">insert into Employee (Id, Name, Salary, ManagerId) values (2, &#39;Henry&#39;, 80000, 4);</span><br><span class="line">insert into Employee (Id, Name, Salary, ManagerId) values (3, &#39;Sam&#39;, 60000, null);</span><br><span class="line">insert into Employee (Id, Name, Salary, ManagerId) values (4, &#39;Max&#39;, 90000, null);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">     a.NAME AS Employee</span><br><span class="line">FROM </span><br><span class="line">     Employee AS a </span><br><span class="line">JOIN </span><br><span class="line">     Employee AS b</span><br><span class="line">ON </span><br><span class="line">     a.ManagerId &#x3D; b.Id </span><br><span class="line">AND </span><br><span class="line">     a.Salary &gt; b.Salary;</span><br></pre></td></tr></table></figure></div>

<h2 id="6-查找重复的邮箱"><a href="#6-查找重复的邮箱" class="headerlink" title="6. 查找重复的邮箱"></a>6. 查找重复的邮箱</h2><p>需求：编写一个 SQL 查询，查找 Person 表中所有重复的电子邮箱。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Email</th>
</tr>
</thead>
<tbody><tr>
<td><a href="mailto:a@b.com">a@b.com</a></td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Person (Id int, Email varchar(255))</span><br><span class="line"></span><br><span class="line">insert into Person (Id, Email) values (1, &#39;a@b.com&#39;)</span><br><span class="line">insert into Person (Id, Email) values (2, &#39;c@d.com&#39;)</span><br><span class="line">insert into Person (Id, Email) values (3, &#39;a@b.com&#39;)</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      Email</span><br><span class="line">from </span><br><span class="line">      Person</span><br><span class="line">group by </span><br><span class="line">      Email</span><br><span class="line">having </span><br><span class="line">      count(Email) &gt; 1;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-从不订购的客户"><a href="#7-从不订购的客户" class="headerlink" title="7. 从不订购的客户"></a>7. 从不订购的客户</h2><p>需求：某网站包含两个表，Customers 表和 Orders 表。编写一个 SQL 查询，找出所有从不订购任何东西的客户。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Customers</th>
</tr>
</thead>
<tbody><tr>
<td>Henry</td>
</tr>
<tr>
<td>Max</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Customers (Id int, Name varchar(255));</span><br><span class="line">Create table If Not Exists Orders (Id int, CustomerId int);</span><br><span class="line"></span><br><span class="line">insert into Customers (Id, Name) values (1, &#39;Joe&#39;);</span><br><span class="line">insert into Customers (Id, Name) values (2, &#39;Henry&#39;);</span><br><span class="line">insert into Customers (Id, Name) values (3, &#39;Sam&#39;);</span><br><span class="line">insert into Customers (Id, Name) values (4, &#39;Max&#39;);</span><br><span class="line"></span><br><span class="line">insert into Orders (Id, CustomerId) values (1, 3);</span><br><span class="line">insert into Orders (Id, CustomerId) values (2, 1);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">     customers.name as &#39;Customers&#39;</span><br><span class="line">from </span><br><span class="line">     customers</span><br><span class="line">where </span><br><span class="line">     customers.id not in(</span><br><span class="line">        select</span><br><span class="line">              customerid </span><br><span class="line">        from </span><br><span class="line">              orders</span><br><span class="line">     );</span><br></pre></td></tr></table></figure></div>

<h2 id="8-部门工资最高的员工"><a href="#8-部门工资最高的员工" class="headerlink" title="8. 部门工资最高的员工"></a>8. 部门工资最高的员工</h2><p><strong>需求一</strong>：编写一个 SQL 查询，找出每个部门工资最高的员工。例如，根据上述给定的表格，Max 在 IT 部门有最高工资，Henry 在 Sales 部门有最高工资。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Department</th>
<th>Employee</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>IT</td>
<td>Jim</td>
<td>90000</td>
</tr>
<tr>
<td>IT</td>
<td>Max</td>
<td>90000</td>
</tr>
<tr>
<td>Sales</td>
<td>Henry</td>
<td>80000</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Employee (Id int, Name varchar(255), Salary int, DepartmentId int);</span><br><span class="line">Create table If Not Exists Department (Id int, Name varchar(255));</span><br><span class="line"></span><br><span class="line">insert into Employee (Id, Name, Salary, DepartmentId) values (1, &#39;Joe&#39;, 70000, 1);</span><br><span class="line">insert into Employee (Id, Name, Salary, DepartmentId) values (2, &#39;Jim&#39;, 90000, 1);</span><br><span class="line">insert into Employee (Id, Name, Salary, DepartmentId) values (3, &#39;Henry&#39;, 80000, 2);</span><br><span class="line">insert into Employee (Id, Name, Salary, DepartmentId) values (4, &#39;Sam&#39;, 60000, 2);</span><br><span class="line">insert into Employee (Id, Name, Salary, DepartmentId) values (5, &#39;Max&#39;, 90000, 1);</span><br><span class="line">insert into Employee (Id, Name, Salary, DepartmentId) values (6, &#39;Randy&#39;, 85000, 1);</span><br><span class="line">insert into Employee (Id, Name, Salary, DepartmentId) values (7, &#39;Will&#39;, 70000, 1);</span><br><span class="line"></span><br><span class="line">insert into Department (Id, Name) values (1, &#39;IT&#39;);</span><br><span class="line">insert into Department (Id, Name) values (2, &#39;Sales&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    Department.name AS &#39;Department&#39;,</span><br><span class="line">    Employee.name AS &#39;Employee&#39;,</span><br><span class="line">    Salary</span><br><span class="line">FROM</span><br><span class="line">    Employee</span><br><span class="line">        JOIN</span><br><span class="line">    Department ON Employee.DepartmentId &#x3D; Department.Id</span><br><span class="line">WHERE</span><br><span class="line">    (Employee.DepartmentId , Salary) IN</span><br><span class="line">    (   SELECT</span><br><span class="line">            DepartmentId, MAX(Salary)</span><br><span class="line">        FROM</span><br><span class="line">            Employee</span><br><span class="line">        GROUP BY DepartmentId</span><br><span class="line">	);</span><br></pre></td></tr></table></figure></div>

<p><strong>需求二</strong>：编写一个 SQL 查询，找出每个部门获得前三高工资的所有员工。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Department</th>
<th>Employee</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>IT</td>
<td>Max</td>
<td>90000</td>
</tr>
<tr>
<td>IT</td>
<td>Randy</td>
<td>85000</td>
</tr>
<tr>
<td>IT</td>
<td>Joe</td>
<td>85000</td>
</tr>
<tr>
<td>IT</td>
<td>Will</td>
<td>70000</td>
</tr>
<tr>
<td>Sales</td>
<td>Henry</td>
<td>80000</td>
</tr>
<tr>
<td>Sales</td>
<td>Sam</td>
<td>60000</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    d.Name AS &#39;Department&#39;, e1.Name AS &#39;Employee&#39;, e1.Salary</span><br><span class="line">FROM</span><br><span class="line">    Employee e1</span><br><span class="line">        JOIN</span><br><span class="line">    Department d ON e1.DepartmentId &#x3D; d.Id</span><br><span class="line">WHERE</span><br><span class="line">    3 &gt; (SELECT</span><br><span class="line">            COUNT(DISTINCT e2.Salary)</span><br><span class="line">        FROM</span><br><span class="line">            Employee e2</span><br><span class="line">        WHERE</span><br><span class="line">            e2.Salary &gt; e1.Salary</span><br><span class="line">                AND e1.DepartmentId &#x3D; e2.DepartmentId</span><br><span class="line">        );</span><br></pre></td></tr></table></figure></div>

<h2 id="9-删除重复的电子邮箱"><a href="#9-删除重复的电子邮箱" class="headerlink" title="9. 删除重复的电子邮箱"></a>9. 删除重复的电子邮箱</h2><p>需求：编写一个 SQL 查询，来删除 Person 表中所有重复的电子邮箱，重复的邮箱里只保留 Id 最小 的那个。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Email</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><a href="mailto:john@example.com">john@example.com</a></td>
</tr>
<tr>
<td>2</td>
<td><a href="mailto:bob@example.com">bob@example.com</a></td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Person (Id int, email varchar(255));</span><br><span class="line"></span><br><span class="line">insert into Person (Id, email) values (1, &#39;john@example.com&#39;);</span><br><span class="line">insert into Person (Id, email) values (2, &#39;bob@example.com&#39;);</span><br><span class="line">insert into Person (Id, email) values (3, &#39;john@example.com&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DELETE </span><br><span class="line">      p1 </span><br><span class="line">FROM </span><br><span class="line">      Person p1,</span><br><span class="line">      Person p2</span><br><span class="line">WHERE</span><br><span class="line">      p1.Email &#x3D; p2.Email AND p1.Id &gt; p2.Id;</span><br></pre></td></tr></table></figure></div>

<h2 id="10-上升的温度"><a href="#10-上升的温度" class="headerlink" title="10. 上升的温度"></a>10. 上升的温度</h2><p>需求：编写一个 SQL 查询，来查找与之前（昨天的）日期相比温度更高的所有日期的 Id。</p>
<table>
<thead>
<tr>
<th>Id</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
</tr>
<tr>
<td>4</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Weather (Id int, RecordDate date, Temperature int);</span><br><span class="line"></span><br><span class="line">insert into Weather (Id, RecordDate, Temperature) values (1, &#39;2015-01-01&#39;, 10);</span><br><span class="line">insert into Weather (Id, RecordDate, Temperature) values (2, &#39;2015-01-02&#39;, 25);</span><br><span class="line">insert into Weather (Id, RecordDate, Temperature) values (3, &#39;2015-01-03&#39;, 20);</span><br><span class="line">insert into Weather (Id, RecordDate, Temperature) values (4, &#39;2015-01-04&#39;, 30);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    weather.id AS &#39;Id&#39;</span><br><span class="line">FROM</span><br><span class="line">    weather</span><br><span class="line">JOIN</span><br><span class="line">    weather w </span><br><span class="line">ON </span><br><span class="line">    DATEDIFF(weather.RecordDate, w.RecordDate) &#x3D; 1</span><br><span class="line">AND weather.Temperature &gt; w.Temperature;</span><br></pre></td></tr></table></figure></div>

<h2 id="11-行程和用户"><a href="#11-行程和用户" class="headerlink" title="11. 行程和用户"></a>11. 行程和用户</h2><p>需求：写一段 SQL 语句查出 2019年10月1日 至 2019年10月3日 期间非禁止用户的取消率。基于上表，你的 SQL 语句应返回如下结果，取消率（Cancellation Rate）保留两位小数。</p>
<p>取消率的计算方式如下：(被司机或乘客取消的非禁止用户生成的订单数量) / (非禁止用户生成的订单总数)</p>
<p>Trips表：所有出租车的行程信息。每段行程有唯一键 Id，Client_Id 和 Driver_Id 是 Users 表中 Users_Id 的外键。Status 是枚举类型，枚举成员为 (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’)。</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Client_Id</th>
<th>Driver_Id</th>
<th>City_Id</th>
<th>Status</th>
<th>Request_at</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>10</td>
<td>1</td>
<td>completed</td>
<td>2019-10-01</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>11</td>
<td>1</td>
<td>cancelled_by_driver</td>
<td>2019-10-01</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>12</td>
<td>6</td>
<td>completed</td>
<td>2019-10-01</td>
</tr>
<tr>
<td>4</td>
<td>4</td>
<td>13</td>
<td>6</td>
<td>cancelled_by_client</td>
<td>2019-10-01</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
<td>10</td>
<td>1</td>
<td>completed</td>
<td>2019-10-02</td>
</tr>
<tr>
<td>6</td>
<td>2</td>
<td>11</td>
<td>6</td>
<td>completed</td>
<td>2019-10-02</td>
</tr>
<tr>
<td>7</td>
<td>3</td>
<td>12</td>
<td>6</td>
<td>completed</td>
<td>2019-10-02</td>
</tr>
<tr>
<td>8</td>
<td>2</td>
<td>12</td>
<td>12</td>
<td>completed</td>
<td>2019-10-03</td>
</tr>
<tr>
<td>9</td>
<td>3</td>
<td>10</td>
<td>12</td>
<td>completed</td>
<td>2019-10-03</td>
</tr>
<tr>
<td>10</td>
<td>4</td>
<td>13</td>
<td>12</td>
<td>cancelled_by_driver</td>
<td>2019-10-03</td>
</tr>
</tbody></table>
<p>Users 表存所有用户。每个用户有唯一键 Users_Id。Banned 表示这个用户是否被禁止，Role 则是一个表示（‘client’, ‘driver’, ‘partner’）的枚举类型。</p>
<table>
<thead>
<tr>
<th>Users_Id</th>
<th>Banned</th>
<th>Cancellation Rate</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>No</td>
<td>client</td>
</tr>
<tr>
<td>2</td>
<td>Yes</td>
<td>client</td>
</tr>
<tr>
<td>3</td>
<td>No</td>
<td>client</td>
</tr>
<tr>
<td>4</td>
<td>No</td>
<td>client</td>
</tr>
<tr>
<td>10</td>
<td>No</td>
<td>driver</td>
</tr>
<tr>
<td>11</td>
<td>No</td>
<td>driver</td>
</tr>
<tr>
<td>12</td>
<td>No</td>
<td>driver</td>
</tr>
<tr>
<td>13</td>
<td>No</td>
<td>driver</td>
</tr>
</tbody></table>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Day</th>
<th>Cancellation Rate</th>
</tr>
</thead>
<tbody><tr>
<td>2019-10-01</td>
<td>0.33</td>
</tr>
<tr>
<td>2019-10-02</td>
<td>0.00</td>
</tr>
<tr>
<td>2019-10-03</td>
<td>0.50</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Trips (Id int, Client_Id int, Driver_Id int, City_Id int, Status ENUM(&#39;completed&#39;, &#39;cancelled_by_driver&#39;, &#39;cancelled_by_client&#39;), Request_at varchar(50));</span><br><span class="line"></span><br><span class="line">Create table If Not Exists Users (Users_Id int, Banned varchar(50), Role ENUM(&#39;client&#39;, &#39;driver&#39;, &#39;partner&#39;));</span><br><span class="line"></span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (1, 1, 10, 1, &#39;completed&#39;, &#39;2019-10-01&#39;);</span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (2, 2, 11, 1, &#39;cancelled_by_driver&#39;, &#39;2019-10-01&#39;);</span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (3, 3, 12, 6, &#39;completed&#39;, &#39;2019-10-01&#39;);</span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (4, 4, 13, 6, &#39;cancelled_by_client&#39;, &#39;2019-10-01&#39;);</span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (5, 1, 10, 1, &#39;completed&#39;, &#39;2019-10-02&#39;);</span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (6, 2, 11, 6, &#39;completed&#39;, &#39;2019-10-02&#39;);</span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (7, 3, 12, 6, &#39;completed&#39;, &#39;2019-10-02&#39;);</span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (8, 2, 12, 12, &#39;completed&#39;, &#39;2019-10-03&#39;);</span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (9, 3, 10, 12, &#39;completed&#39;, &#39;2019-10-03&#39;);</span><br><span class="line">insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (10, 4, 13, 12, &#39;cancelled_by_driver&#39;, &#39;2019-10-03&#39;);</span><br><span class="line"></span><br><span class="line">insert into Users (Users_Id, Banned, Role) values (1, &#39;No&#39;, &#39;client&#39;);</span><br><span class="line">insert into Users (Users_Id, Banned, Role) values (2, &#39;Yes&#39;, &#39;client&#39;);</span><br><span class="line">insert into Users (Users_Id, Banned, Role) values (3, &#39;No&#39;, &#39;client&#39;);</span><br><span class="line">insert into Users (Users_Id, Banned, Role) values (4, &#39;No&#39;, &#39;client&#39;);</span><br><span class="line">insert into Users (Users_Id, Banned, Role) values (10, &#39;No&#39;, &#39;driver&#39;);</span><br><span class="line">insert into Users (Users_Id, Banned, Role) values (11, &#39;No&#39;, &#39;driver&#39;);</span><br><span class="line">insert into Users (Users_Id, Banned, Role) values (12, &#39;No&#39;, &#39;driver&#39;);</span><br><span class="line">insert into Users (Users_Id, Banned, Role) values (13, &#39;No&#39;, &#39;driver&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">SELECT </span><br><span class="line">      T.request_at AS &#96;Day&#96;, </span><br><span class="line">	  ROUND(</span><br><span class="line">            SUM(IF(T.STATUS &#x3D; &#39;completed&#39;,0,1))&#x2F; COUNT(T.STATUS),</span><br><span class="line">            2</span><br><span class="line">            ) AS &#96;Cancellation Rate&#96;</span><br><span class="line">FROM </span><br><span class="line">      Trips AS T</span><br><span class="line">JOIN </span><br><span class="line">      Users AS U1 </span><br><span class="line">ON </span><br><span class="line">      T.client_id &#x3D; U1.users_id AND U1.banned &#x3D;&#39;No&#39;</span><br><span class="line">JOIN </span><br><span class="line">      Users AS U2 </span><br><span class="line">ON </span><br><span class="line">      T.driver_id &#x3D; U2.users_id AND U2.banned &#x3D;&#39;No&#39;</span><br><span class="line">WHERE </span><br><span class="line">      T.request_at BETWEEN &#39;2019-10-01&#39; AND &#39;2019-10-03&#39;</span><br><span class="line">GROUP BY </span><br><span class="line">      T.request_at;</span><br><span class="line"></span><br><span class="line">方法二：</span><br><span class="line">SELECT </span><br><span class="line">      T.request_at AS &#96;Day&#96;, </span><br><span class="line">	  ROUND(</span><br><span class="line">			SUM(IF(T.STATUS &#x3D; &#39;completed&#39;,0,1))&#x2F; COUNT(T.STATUS),</span><br><span class="line">			2</span><br><span class="line">	        ) AS &#96;Cancellation Rate&#96;</span><br><span class="line">FROM </span><br><span class="line">     trips AS T </span><br><span class="line">LEFT JOIN (</span><br><span class="line">	        SELECT</span><br><span class="line">                  users_id</span><br><span class="line">	        FROM</span><br><span class="line">                  users</span><br><span class="line">	        WHERE  </span><br><span class="line">                  banned &#x3D; &#39;Yes&#39;</span><br><span class="line">           ) AS A </span><br><span class="line">ON </span><br><span class="line">     T.Client_Id &#x3D; A.users_id</span><br><span class="line">LEFT JOIN (</span><br><span class="line">	        SELECT</span><br><span class="line">                  users_id</span><br><span class="line">	        FROM </span><br><span class="line">                  users</span><br><span class="line">	        WHERE </span><br><span class="line">                  banned &#x3D; &#39;Yes&#39;</span><br><span class="line">           ) AS A1</span><br><span class="line">ON </span><br><span class="line">     T.Driver_Id &#x3D; A1.users_id</span><br><span class="line">WHERE </span><br><span class="line">     A.users_id IS NULL </span><br><span class="line">     AND A1.users_id IS NULL </span><br><span class="line">     AND T.request_at BETWEEN &#39;2019-10-01&#39; AND &#39;2019-10-03&#39;</span><br><span class="line">GROUP BY </span><br><span class="line">     T.request_at;</span><br><span class="line"></span><br><span class="line">方法三：</span><br><span class="line">SELECT </span><br><span class="line">     T.request_at AS &#96;Day&#96;, </span><br><span class="line">	 ROUND(</span><br><span class="line">           SUM(IF(T.STATUS &#x3D; &#39;completed&#39;,0,1))&#x2F; COUNT(T.STATUS),</span><br><span class="line">		   2</span><br><span class="line">	       ) AS &#96;Cancellation Rate&#96;</span><br><span class="line">FROM</span><br><span class="line">     trips AS T</span><br><span class="line">WHERE </span><br><span class="line">     T.Client_Id NOT IN (</span><br><span class="line">	                      SELECT </span><br><span class="line">                                 users_id</span><br><span class="line">	                      FROM </span><br><span class="line">                                 users</span><br><span class="line">	                      WHERE </span><br><span class="line">                                 banned &#x3D; &#39;Yes&#39;</span><br><span class="line">     )</span><br><span class="line">AND</span><br><span class="line">     T.Driver_Id NOT IN (</span><br><span class="line">     	                  SELECT </span><br><span class="line">                                 users_id</span><br><span class="line">     	                  FROM  </span><br><span class="line">                                 users</span><br><span class="line">     	                  WHERE </span><br><span class="line">                                 banned &#x3D; &#39;Yes&#39;</span><br><span class="line">     )</span><br><span class="line">AND </span><br><span class="line">     T.request_at BETWEEN &#39;2019-10-01&#39; AND &#39;2019-10-03&#39;;</span><br></pre></td></tr></table></figure></div>

<h2 id="12-游戏玩法分析"><a href="#12-游戏玩法分析" class="headerlink" title="12. 游戏玩法分析"></a>12. 游戏玩法分析</h2><p><strong>需求一</strong>：写一条 SQL 查询语句获取每位玩家 第一次登陆平台的日期。</p>
<p> Activity表：显示了某些游戏的玩家的活动情况。</p>
<table>
<thead>
<tr>
<th>player_id</th>
<th>device_id</th>
<th>event_date</th>
<th>games_played</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>2016-03-01</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>2016-05-02</td>
<td>6</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>2017-06-25</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>2016-03-02</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>2018-07-03</td>
<td>5</td>
</tr>
</tbody></table>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>player_id</th>
<th>first_login</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2016-03-01</td>
</tr>
<tr>
<td>2</td>
<td>2017-06-25</td>
</tr>
<tr>
<td>3</td>
<td>2016-03-02</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Activity (player_id int, device_id int, event_date date, games_played int);</span><br><span class="line"></span><br><span class="line">insert into Activity (player_id, device_id, event_date, games_played) values (1, 2, &#39;2016-03-01&#39;, 5);</span><br><span class="line">insert into Activity (player_id, device_id, event_date, games_played) values (1, 2, &#39;2016-05-02&#39;, 6);</span><br><span class="line">insert into Activity (player_id, device_id, event_date, games_played) values (2, 3, &#39;2017-06-25&#39;, 1);</span><br><span class="line">insert into Activity (player_id, device_id, event_date, games_played) values (3, 1, &#39;2016-03-02&#39;, 0);</span><br><span class="line">insert into Activity (player_id, device_id, event_date, games_played) values (3, 4, &#39;2018-07-03&#39;, 5);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      player_id, </span><br><span class="line">      min(event_date) as first_login </span><br><span class="line">from </span><br><span class="line">      Activity </span><br><span class="line">group by </span><br><span class="line">      player_id;</span><br></pre></td></tr></table></figure></div>

<p><strong>需求二</strong>：描述每一个玩家首次登陆的设备名称</p>
<table>
<thead>
<tr>
<th>player_id</th>
<th>device_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      player_id,</span><br><span class="line">      device_id </span><br><span class="line">from</span><br><span class="line">     (select *  </span><br><span class="line">      from </span><br><span class="line">          Activity</span><br><span class="line">      where</span><br><span class="line">          (player_id,event_date) in (select</span><br><span class="line">                                           player_id, </span><br><span class="line">                                           device_id</span><br><span class="line">                                           min(event_date)</span><br><span class="line">                                      from</span><br><span class="line">                                           Activity </span><br><span class="line">                                      group by </span><br><span class="line">                                           player_id</span><br><span class="line">                                      )</span><br><span class="line">      ) as t;</span><br></pre></td></tr></table></figure></div>

<p><strong>需求三</strong>：编写一个 SQL 查询，同时报告每组玩家和日期，以及玩家到目前为止玩了多少游戏。也就是说，在此日期之前玩家所玩的游戏总数。详细情况请查看示例。</p>
<table>
<thead>
<tr>
<th>player_id</th>
<th>event_date</th>
<th>games_played_so_far</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2016-03-01</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>2016-05-02</td>
<td>11</td>
</tr>
<tr>
<td>2</td>
<td>2017-06-25</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>2016-03-02</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>2018-07-03</td>
<td>5</td>
</tr>
</tbody></table>
<p>提示：对于 ID 为 3 的玩家，2018-07-03 共玩了 0+5=5 个游戏。</p>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;方法一</span><br><span class="line">SELECT C.player_id,C.event_date,C.games_played_so_far</span><br><span class="line">FROM (</span><br><span class="line">      SELECT </span><br><span class="line">      	A.player_id,</span><br><span class="line">      	A.event_date,</span><br><span class="line">          @sum_cnt:&#x3D;</span><br><span class="line">      		if(A.player_id &#x3D; @pre_id AND A.event_date !&#x3D; @pre_date,</span><br><span class="line">      			@sum_cnt + A.games_played,</span><br><span class="line">      			A.games_played </span><br><span class="line">      		)</span><br><span class="line">      		AS &#96;games_played_so_far&#96;,</span><br><span class="line">          @pre_id:&#x3D;A.player_id AS &#96;player_ids&#96;,</span><br><span class="line">          @pre_date:&#x3D;A.event_date AS &#96;event_dates&#96;</span><br><span class="line">      FROM </span><br><span class="line">          activity AS A,</span><br><span class="line">          (SELECT @pre_id:&#x3D;NULL,@pre_date:&#x3D;NULL,@sum_cnt:&#x3D;0) AS B</span><br><span class="line">      order BY </span><br><span class="line">          A.player_id,A.event_date</span><br><span class="line">) AS C</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;方法二</span><br><span class="line">SELECT </span><br><span class="line">      B.player_id,</span><br><span class="line">      B.event_date,</span><br><span class="line">      SUM(A.games_played) AS &#96;games_played_so_far&#96;</span><br><span class="line">FROM </span><br><span class="line">      Activity AS A</span><br><span class="line">JOIN </span><br><span class="line">      Activity AS B </span><br><span class="line">ON </span><br><span class="line">      A.player_id &#x3D; B.player_id </span><br><span class="line">      AND A.event_date &lt;&#x3D; B.event_date</span><br><span class="line">GROUP BY </span><br><span class="line">      B.player_id,B.event_date;</span><br></pre></td></tr></table></figure></div>

<p><strong>需求四</strong>：编写一个 SQL 查询，报告在首次登录的第二天再次登录的玩家的百分比，四舍五入到小数点后两位。换句话说，您需要计算从首次登录日期开始至少连续两天登录的玩家的数量，然后除以玩家总数。</p>
<table>
<thead>
<tr>
<th>fraction</th>
</tr>
</thead>
<tbody><tr>
<td>0.00</td>
</tr>
</tbody></table>
<p>提示：对于 ID 为 1 的玩家，2016-05-02 共玩了 5+6=11 个游戏.<br>对于 ID 为 3 的玩家，2018-07-03 共玩了 0+5=5 个游戏。</p>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      round(</span><br><span class="line">            sum(case when datediff(a.event_date,b.first_date)&#x3D;1 then 1 else 0 end)</span><br><span class="line">               &#x2F;</span><br><span class="line">               (select count(distinct(player_id)) from activity)</span><br><span class="line">            ,2 ) as fraction</span><br><span class="line">from </span><br><span class="line">      activity a,</span><br><span class="line">     (select </span><br><span class="line">             player_id,</span><br><span class="line">             min(event_date) first_date </span><br><span class="line">      from </span><br><span class="line">             activity </span><br><span class="line">      group by </span><br><span class="line">             player_id</span><br><span class="line">     ) b</span><br><span class="line">where </span><br><span class="line">      a.player_id&#x3D;b.player_id;</span><br></pre></td></tr></table></figure></div>

<p><strong>需求五</strong>：编写一个 SQL 查询，报告每个安装日期、当天安装游戏的玩家数量和第一天的保留时间。</p>
<table>
<thead>
<tr>
<th>install_dt</th>
<th>installs</th>
<th>Day1_retention</th>
</tr>
</thead>
<tbody><tr>
<td>2016-03-01</td>
<td>2</td>
<td>0.50</td>
</tr>
<tr>
<td>2017-06-25</td>
<td>1</td>
<td>0.00</td>
</tr>
</tbody></table>
<p>提示：玩家 1 和 3 在 2016-03-01 安装了游戏，但只有玩家 1 在 2016-03-02 重新登录，所以 2016-03-01 的第一天保留时间是 1/2=0.50<br>玩家 2 在 2017-06-25 安装了游戏，但在 2017-06-26 没有重新登录，因此 2017-06-25 的第一天保留为 0/1=0.00</p>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#方法一</span><br><span class="line">SELECT</span><br><span class="line">      A.install_date,</span><br><span class="line">      COUNT(A.player_id) AS &#96;installs&#96;,</span><br><span class="line">      COUNT(AA.player_id) AS &#96;return_cnt&#96;</span><br><span class="line">FROM </span><br><span class="line">   (SELECT </span><br><span class="line">           player_id,</span><br><span class="line">           MIN(event_date) AS &#96;install_date&#96;</span><br><span class="line">	FROM </span><br><span class="line">           Activity</span><br><span class="line">	GROUP BY </span><br><span class="line">           player_id</span><br><span class="line">    ) AS A</span><br><span class="line">left JOIN </span><br><span class="line">    Activity AS AA </span><br><span class="line">ON </span><br><span class="line">    AA.event_date &#x3D; DATE_ADD(A.install_date,INTERVAL 1 DAY) AND AA.player_id &#x3D; A.player_id</span><br><span class="line">GROUP BY</span><br><span class="line">    A.install_date;</span><br><span class="line"></span><br><span class="line">#方法二</span><br><span class="line">SELECT </span><br><span class="line">      A.event_date AS &#96;install_dt&#96;,</span><br><span class="line">      COUNT(A.player_id) AS &#96;installs&#96;,</span><br><span class="line">      round(COUNT(C.player_id)&#x2F;COUNT(A.player_id),2) AS &#96;Day1_retention&#96;</span><br><span class="line">FROM</span><br><span class="line">      Activity AS A </span><br><span class="line">left JOIN </span><br><span class="line">      Activity AS B</span><br><span class="line">ON </span><br><span class="line">      A.player_id &#x3D; B.player_id AND A.event_date &gt; B.event_date</span><br><span class="line">left JOIN </span><br><span class="line">      Activity AS C</span><br><span class="line">ON    </span><br><span class="line">      A.player_id &#x3D; C.player_id AND C.event_date &#x3D; DATE_ADD(A.event_date,INTERVAL 1 DAY)</span><br><span class="line">WHERE </span><br><span class="line">      B.event_date IS NULL</span><br><span class="line">GROUP BY </span><br><span class="line">      A.event_date;</span><br></pre></td></tr></table></figure></div>

<h2 id="13-员工薪水中位数"><a href="#13-员工薪水中位数" class="headerlink" title="13. 员工薪水中位数"></a>13. 员工薪水中位数</h2><p>需求：请编写SQL查询来查找每个公司的薪水中位数。挑战点：你是否可以在不使用任何内置的SQL函数的情况下解决此问题。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Company</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>5</td>
<td>A</td>
<td>451</td>
</tr>
<tr>
<td>6</td>
<td>A</td>
<td>513</td>
</tr>
<tr>
<td>12</td>
<td>B</td>
<td>234</td>
</tr>
<tr>
<td>9</td>
<td>B</td>
<td>1154</td>
</tr>
<tr>
<td>14</td>
<td>C</td>
<td>2645</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Employee (Id int, Company varchar(255), Salary int);</span><br><span class="line"></span><br><span class="line">insert into Employee (Id, Company, Salary) values (1, &#39;A&#39;, 2341);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (2, &#39;A&#39;, 341);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (3, &#39;A&#39;, 15);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (4, &#39;A&#39;, 15314);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (5, &#39;A&#39;, 451);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (6, &#39;A&#39;, 513);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (7, &#39;B&#39;, 15);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (8, &#39;B&#39;, 13);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (9, &#39;B&#39;, 1154);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (10, &#39;B&#39;, 1345);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (11, &#39;B&#39;, 1221);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (12, &#39;B&#39;, 234);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (13, &#39;C&#39;, 2345);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (14, &#39;C&#39;, 2645);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (15, &#39;C&#39;, 2645);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (16, &#39;C&#39;, 2652);</span><br><span class="line">insert into Employee (Id, Company, Salary) values (17, &#39;C&#39;, 65);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">     b.id,</span><br><span class="line">     b.company,</span><br><span class="line">     b.salary</span><br><span class="line">from </span><br><span class="line">    (select</span><br><span class="line">           id,</span><br><span class="line">           company,</span><br><span class="line">           salary,</span><br><span class="line">           case @com when company then @rk:&#x3D;@rk+1 else @rk:&#x3D;1 end rk,</span><br><span class="line">           @com:&#x3D;company</span><br><span class="line">    from </span><br><span class="line">           employee,</span><br><span class="line">           (select @rk:&#x3D;0, @com:&#x3D;&#39;&#39;) a</span><br><span class="line">    order by</span><br><span class="line">           company,salary</span><br><span class="line">    ) b</span><br><span class="line">left join </span><br><span class="line">    (select</span><br><span class="line">           company,</span><br><span class="line">           count(1)&#x2F;2 cnt</span><br><span class="line">     from </span><br><span class="line">           employee</span><br><span class="line">     group by company</span><br><span class="line">    ) c</span><br><span class="line">on </span><br><span class="line">     b.company&#x3D;c.company</span><br><span class="line">where</span><br><span class="line">     b.rk in (cnt+0.5,cnt+1,cnt);</span><br></pre></td></tr></table></figure></div>

<h2 id="14-至少有5名直接下属的经理"><a href="#14-至少有5名直接下属的经理" class="headerlink" title="14. 至少有5名直接下属的经理"></a>14. 至少有5名直接下属的经理</h2><p>需求：Employee 表，请编写一个SQL查询来查找至少有5名直接下属的经理。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Name</th>
</tr>
</thead>
<tbody><tr>
<td>John</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Employee (Id int, Name varchar(255), Department varchar(255), ManagerId int);</span><br><span class="line"></span><br><span class="line">insert into Employee (Id, Name, Department, ManagerId) values (101, &#39;John&#39;, &#39;A&#39;, null);</span><br><span class="line">insert into Employee (Id, Name, Department, ManagerId) values (102, &#39;Dan&#39;, &#39;A&#39;, 101);</span><br><span class="line">insert into Employee (Id, Name, Department, ManagerId) values (103, &#39;James&#39;, &#39;A&#39;, 101);</span><br><span class="line">insert into Employee (Id, Name, Department, ManagerId) values (104, &#39;Amy&#39;, &#39;A&#39;, 101);</span><br><span class="line">insert into Employee (Id, Name, Department, ManagerId) values (105, &#39;Anne&#39;, &#39;A&#39;, 101);</span><br><span class="line">insert into Employee (Id, Name, Department, ManagerId) values (106, &#39;Ron&#39;, &#39;B&#39;, 101);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    Name</span><br><span class="line">FROM</span><br><span class="line">    Employee AS t1 </span><br><span class="line">JOIN </span><br><span class="line">   (SELECT</span><br><span class="line">        ManagerId</span><br><span class="line">    FROM</span><br><span class="line">        Employee</span><br><span class="line">    GROUP BY </span><br><span class="line">        ManagerId</span><br><span class="line">    HAVING</span><br><span class="line">        COUNT(ManagerId) &gt;&#x3D; 5</span><br><span class="line">    ) AS t2</span><br><span class="line">ON  </span><br><span class="line">    t1.Id &#x3D; t2.ManagerId;</span><br></pre></td></tr></table></figure></div>

<h2 id="15-给定数字的频率查询中位数"><a href="#15-给定数字的频率查询中位数" class="headerlink" title="15. 给定数字的频率查询中位数"></a>15. 给定数字的频率查询中位数</h2><p>需求：编写一个 SQL 查询，满足条件：无论 person 是否有地址信息，都需要基于上述两表提供 person 的以下信息：<br>FirstName, LastName, City, State</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>median</th>
</tr>
</thead>
<tbody><tr>
<td>0.0000</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Numbers (Number int, Frequency int);</span><br><span class="line"></span><br><span class="line">insert into Numbers (Number, Frequency) values (0, 7);</span><br><span class="line">insert into Numbers (Number, Frequency) values (1, 1);</span><br><span class="line">insert into Numbers (Number, Frequency) values (2, 3);</span><br><span class="line">insert into Numbers (Number, Frequency) values (3, 1);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      avg(t.number) as median</span><br><span class="line">from</span><br><span class="line">      (select</span><br><span class="line">             n1.number,</span><br><span class="line">             n1.frequency,</span><br><span class="line">             (select </span><br><span class="line">                   sum(frequency) </span><br><span class="line">              from </span><br><span class="line">                   numbers n2</span><br><span class="line">              where </span><br><span class="line">                   n2.number&lt;&#x3D;n1.number</span><br><span class="line">             ) as asc_frequency,</span><br><span class="line">             (select</span><br><span class="line">                   sum(frequency)</span><br><span class="line">              from </span><br><span class="line">                   numbers n3 </span><br><span class="line">              where </span><br><span class="line">                   n3.number&gt;&#x3D;n1.number</span><br><span class="line">             ) as desc_frequency</span><br><span class="line">      from </span><br><span class="line">             numbers n1</span><br><span class="line">      ) t</span><br><span class="line">where </span><br><span class="line">      t.asc_frequency&gt;&#x3D; (select sum(frequency) from numbers)&#x2F;2</span><br><span class="line">      and t.desc_frequency&gt;&#x3D; (select sum(frequency) from numbers)&#x2F;2;</span><br></pre></td></tr></table></figure></div>

<h2 id="16-当选者"><a href="#16-当选者" class="headerlink" title="16. 当选者"></a>16. 当选者</h2><p>需求：请编写 sql 语句来找到当选者（CandidateId）的名字</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Name</th>
</tr>
</thead>
<tbody><tr>
<td>B</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Candidate (id int, Name varchar(255));</span><br><span class="line">Create table If Not Exists Vote (id int, CandidateId int);</span><br><span class="line"></span><br><span class="line">insert into Candidate (id, Name) values (1, &#39;A&#39;);</span><br><span class="line">insert into Candidate (id, Name) values (2, &#39;B&#39;);</span><br><span class="line">insert into Candidate (id, Name) values (3, &#39;C&#39;);</span><br><span class="line">insert into Candidate (id, Name) values (4, &#39;D&#39;);</span><br><span class="line">insert into Candidate (id, Name) values (5, &#39;E&#39;);</span><br><span class="line"></span><br><span class="line">insert into Vote (id, CandidateId) values (1, 2);</span><br><span class="line">insert into Vote (id, CandidateId) values (2, 44);</span><br><span class="line">insert into Vote (id, CandidateId) values (3, 3);</span><br><span class="line">insert into Vote (id, CandidateId) values (4, 2);</span><br><span class="line">insert into Vote (id, CandidateId) values (5, 5);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    name AS &#39;Name&#39;</span><br><span class="line">FROM</span><br><span class="line">    Candidate</span><br><span class="line">JOIN</span><br><span class="line">    (SELECT</span><br><span class="line">        Candidateid</span><br><span class="line">    FROM</span><br><span class="line">        Vote</span><br><span class="line">    GROUP BY </span><br><span class="line">        Candidateid</span><br><span class="line">    ORDER BY </span><br><span class="line">        COUNT(*) DESC</span><br><span class="line">    LIMIT 1</span><br><span class="line">    ) AS winner</span><br><span class="line">WHERE</span><br><span class="line">    Candidate.id &#x3D; winner.Candidateid;</span><br></pre></td></tr></table></figure></div>

<h2 id="17-员工奖金"><a href="#17-员工奖金" class="headerlink" title="17. 员工奖金"></a>17. 员工奖金</h2><p>需求：选出所有 bonus &lt; 1000 的员工的 name 及其 bonus。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>name</th>
<th>bonus</th>
</tr>
</thead>
<tbody><tr>
<td>John</td>
<td>null</td>
</tr>
<tr>
<td>Dan</td>
<td>500</td>
</tr>
<tr>
<td>Brad</td>
<td>null</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Employee (EmpId int, Name varchar(255), Supervisor int, Salary int);</span><br><span class="line">Create table If Not Exists Bonus (EmpId int, Bonus int);</span><br><span class="line"></span><br><span class="line">insert into Employee (EmpId, Name, Supervisor, Salary) values (3, &#39;Brad&#39;, null, 4000);</span><br><span class="line">insert into Employee (EmpId, Name, Supervisor, Salary) values (1, &#39;John&#39;, 3, 1000);</span><br><span class="line">insert into Employee (EmpId, Name, Supervisor, Salary) values (2, &#39;Dan&#39;, 3, 2000);</span><br><span class="line">insert into Employee (EmpId, Name, Supervisor, Salary) values (4, &#39;Thomas&#39;, 3, 4000);</span><br><span class="line"></span><br><span class="line">insert into Bonus (EmpId, Bonus) values (2, 500);</span><br><span class="line">insert into Bonus (EmpId, Bonus) values (4, 2000);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    Employee.name, </span><br><span class="line">    Bonus.bonus</span><br><span class="line">FROM</span><br><span class="line">    Employee</span><br><span class="line">LEFT JOIN</span><br><span class="line">    Bonus</span><br><span class="line">ON </span><br><span class="line">    Employee.empid &#x3D; Bonus.empid</span><br><span class="line">WHERE</span><br><span class="line">    bonus &lt; 1000 OR bonus IS NULL;</span><br></pre></td></tr></table></figure></div>

<h2 id="18-最高回答率"><a href="#18-最高回答率" class="headerlink" title="18. 最高回答率"></a>18. 最高回答率</h2><p>需求：请编写SQL查询来找到具有最高回答率的问题。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>survey_log</th>
</tr>
</thead>
<tbody><tr>
<td>285</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists survey_log (uid int, action varchar(255), question_id int, answer_id int, q_num int, timestamp int);</span><br><span class="line"></span><br><span class="line">insert into survey_log (uid, action, question_id, answer_id, q_num, timestamp) values (5, &#39;show&#39;, 285, null, 1, 123);</span><br><span class="line">insert into survey_log (uid, action, question_id, answer_id, q_num, timestamp) values (5, &#39;answer&#39;, 285, 124124, 1, &#39;124&#39;);</span><br><span class="line">insert into survey_log (uid, action, question_id, answer_id, q_num, timestamp) values (5, &#39;show&#39;, 369, null, 2, 125);</span><br><span class="line">insert into survey_log (uid, action, question_id, answer_id, q_num, timestamp) values (5, &#39;skip&#39;, 369, null, 2, 126);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#方法一</span><br><span class="line">SELECT </span><br><span class="line">    question_id as survey_log</span><br><span class="line">FROM</span><br><span class="line">   (SELECT </span><br><span class="line">         question_id,</span><br><span class="line">         SUM(case when action&#x3D;&quot;answer&quot; THEN 1 ELSE 0 END) as num_answer,</span><br><span class="line">         SUM(case when action&#x3D;&quot;show&quot; THEN 1 ELSE 0 END) as num_show</span><br><span class="line">	FROM </span><br><span class="line">         survey_log</span><br><span class="line">	GROUP BY </span><br><span class="line">         question_id</span><br><span class="line">    ) as tbl</span><br><span class="line">ORDER BY</span><br><span class="line">    (num_answer &#x2F; num_show) DESC</span><br><span class="line">LIMIT 1;</span><br><span class="line"></span><br><span class="line">#方法二</span><br><span class="line">SELECT </span><br><span class="line">    question_id AS &#39;survey_log&#39;</span><br><span class="line">FROM</span><br><span class="line">    survey_log</span><br><span class="line">GROUP BY</span><br><span class="line">    question_id</span><br><span class="line">ORDER BY</span><br><span class="line">    COUNT(answer_id) &#x2F; COUNT(IF(action &#x3D; &#39;show&#39;, 1, 0)) DESC</span><br><span class="line">LIMIT 1;</span><br></pre></td></tr></table></figure></div>

<h2 id="19-员工累计薪水"><a href="#19-员工累计薪水" class="headerlink" title="19. 员工累计薪水"></a>19. 员工累计薪水</h2><p>需求：查询一个员工三个月内的累计薪水，但是不包括最近一个月的薪水。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Month</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>3</td>
<td>90</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>50</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>100</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>40</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Employee (Id int, Month int, Salary int);</span><br><span class="line"></span><br><span class="line">insert into Employee (Id, Month, Salary) values (1, 1, 20);</span><br><span class="line">insert into Employee (Id, Month, Salary) values (2, 1, 20);</span><br><span class="line">insert into Employee (Id, Month, Salary) values (1, 2, 30);</span><br><span class="line">insert into Employee (Id, Month, Salary) values (2, 2, 30);</span><br><span class="line">insert into Employee (Id, Month, Salary) values (3, 2, 40);</span><br><span class="line">insert into Employee (Id, Month, Salary) values (1, 3, 40);</span><br><span class="line">insert into Employee (Id, Month, Salary) values (3, 3, 60);</span><br><span class="line">insert into Employee (Id, Month, Salary) values (1, 4, 60);</span><br><span class="line">insert into Employee (Id, Month, Salary) values (3, 4, 70);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    E1.id,</span><br><span class="line">    E1.month,</span><br><span class="line">    (IFNULL(E1.salary, 0) + IFNULL(E2.salary, 0) + IFNULL(E3.salary, 0)) AS Salary</span><br><span class="line">FROM</span><br><span class="line">    (SELECT</span><br><span class="line">        id, MAX(month) AS month</span><br><span class="line">    FROM</span><br><span class="line">        Employee</span><br><span class="line">    GROUP BY </span><br><span class="line">        id</span><br><span class="line">    HAVING </span><br><span class="line">        COUNT(*) &gt; 1) AS maxmonth</span><br><span class="line">    LEFT JOIN</span><br><span class="line">        Employee E1 </span><br><span class="line">    ON </span><br><span class="line">        (maxmonth.id &#x3D; E1.id AND maxmonth.month &gt; E1.month)</span><br><span class="line">    LEFT JOIN</span><br><span class="line">        Employee E2 </span><br><span class="line">    ON </span><br><span class="line">        (E2.id &#x3D; E1.id AND E2.month &#x3D; E1.month - 1)</span><br><span class="line">    LEFT JOIN </span><br><span class="line">        Employee E3 </span><br><span class="line">    ON</span><br><span class="line">        (E3.id &#x3D; E1.id AND E3.month &#x3D; E1.month - 2)</span><br><span class="line">ORDER BY </span><br><span class="line">    id ASC , month DESC;</span><br></pre></td></tr></table></figure></div>

<h2 id="20-统计各专业人数"><a href="#20-统计各专业人数" class="headerlink" title="20. 统计各专业人数"></a>20. 统计各专业人数</h2><p>需求：查询 department 表中每个专业的学生人数 （即使没有学生的专业也需列出）。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>dept_name</th>
<th>student_number</th>
</tr>
</thead>
<tbody><tr>
<td>Engineering</td>
<td>2</td>
</tr>
<tr>
<td>Science</td>
<td>1</td>
</tr>
<tr>
<td>Law</td>
<td>0</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS student (student_id INT,student_name VARCHAR(45), gender VARCHAR(6), dept_id INT);</span><br><span class="line">CREATE TABLE IF NOT EXISTS department (dept_id INT, dept_name VARCHAR(255));</span><br><span class="line"></span><br><span class="line">insert into student (student_id, student_name, gender, dept_id) values (1, &#39;Jack&#39;, &#39;M&#39;, 1);</span><br><span class="line">insert into student (student_id, student_name, gender, dept_id) values (2, &#39;Jane&#39;, &#39;F&#39;, 1);</span><br><span class="line">insert into student (student_id, student_name, gender, dept_id) values (3, &#39;Mark&#39;, &#39;M&#39;, 2);</span><br><span class="line"></span><br><span class="line">insert into department (dept_id, dept_name) values (1, &#39;Engineering&#39;);</span><br><span class="line">insert into department (dept_id, dept_name) values (2, &#39;Science&#39;);</span><br><span class="line">insert into department (dept_id, dept_name) values (3, &#39;Law&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    dept_name,</span><br><span class="line">    COUNT(student_id) AS student_number</span><br><span class="line">FROM</span><br><span class="line">    department</span><br><span class="line">LEFT OUTER JOIN</span><br><span class="line">    student </span><br><span class="line">ON</span><br><span class="line">    department.dept_id &#x3D; student.dept_id</span><br><span class="line">GROUP BY </span><br><span class="line">    department.dept_name</span><br><span class="line">ORDER BY </span><br><span class="line">    student_number DESC, </span><br><span class="line">    department.dept_name;</span><br></pre></td></tr></table></figure></div>

<h2 id="21-寻找用户推荐人"><a href="#21-寻找用户推荐人" class="headerlink" title="21. 寻找用户推荐人"></a>21. 寻找用户推荐人</h2><p>需求：写一个查询语句，返回一个编号列表，列表中编号的推荐人的编号都 <strong>不是</strong> 2</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>Will</td>
</tr>
<tr>
<td>Jane</td>
</tr>
<tr>
<td>Bill</td>
</tr>
<tr>
<td>Zack</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS customer (id INT,name VARCHAR(25),referee_id INT);</span><br><span class="line"></span><br><span class="line">insert into customer (id, name, referee_id) values (1, &#39;Will&#39;, null);</span><br><span class="line">insert into customer (id, name, referee_id) values (2, &#39;Jane&#39;, null);</span><br><span class="line">insert into customer (id, name, referee_id) values (3, &#39;Alex&#39;, 2);</span><br><span class="line">insert into customer (id, name, referee_id) values (4, &#39;Bill&#39;, null);</span><br><span class="line">insert into customer (id, name, referee_id) values (5, &#39;Zack&#39;, 1);</span><br><span class="line">insert into customer (id, name, referee_id) values (6, &#39;Mark&#39;, 2);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">      name</span><br><span class="line">FROM </span><br><span class="line">      customer</span><br><span class="line">WHERE </span><br><span class="line">      referee_id &lt;&gt; 2 OR referee_id IS NULL;</span><br></pre></td></tr></table></figure></div>

<h2 id="22-2016年的投资"><a href="#22-2016年的投资" class="headerlink" title="22. 2016年的投资"></a>22. 2016年的投资</h2><p>需求：写一个查询语句，将 2016 年 (TIV_2016) 所有成功投资的金额加起来，保留 2 位小数。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>TIV_2016</th>
</tr>
</thead>
<tbody><tr>
<td>45.00</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS insurance (PID INTEGER(11), TIV_2015 NUMERIC(15,2), TIV_2016 NUMERIC(15,2), LAT NUMERIC(5,2), LON NUMERIC(5,2) );</span><br><span class="line"></span><br><span class="line">insert into insurance (PID, TIV_2015, TIV_2016, LAT, LON) values (1, 10, 5, 10, 10);</span><br><span class="line">insert into insurance (PID, TIV_2015, TIV_2016, LAT, LON) values (2, 20, 20, 20, 20);</span><br><span class="line">insert into insurance (PID, TIV_2015, TIV_2016, LAT, LON) values (3, 10, 30, 20, 20);</span><br><span class="line">insert into insurance (PID, TIV_2015, TIV_2016, LAT, LON) values (4, 10, 40, 40, 40);</span><br></pre></td></tr></table></figure></div>

<p>提示：</p>
<p>对于一个投保人，他在 2016 年成功投资的条件是：</p>
<p>他在 2015 年的投保额 (TIV_2015) 至少跟一个其他投保人在 2015 年的投保额相同。<br>他所在的城市必须与其他投保人都不同（也就是说维度和经度不能跟其他任何一个投保人完全相同）。</p>
<p>就如最后一个投保人，第一个投保人同时满足两个条件：</p>
<ol>
<li>他在 2015 年的投保金额 TIV_2015 为 10 ，与第三个和第四个投保人在 2015 年的投保金额相同。</li>
<li>他所在城市的经纬度是独一无二的。</li>
</ol>
<p>第二个投保人两个条件都不满足。他在 2015 年的投资 TIV_2015 与其他任何投保人都不相同。<br>且他所在城市的经纬度与第三个投保人相同。基于同样的原因，第三个投保人投资失败。</p>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    SUM(insurance.TIV_2016) AS TIV_2016</span><br><span class="line">FROM</span><br><span class="line">    insurance</span><br><span class="line">WHERE</span><br><span class="line">    insurance.TIV_2015 IN(</span><br><span class="line">                          SELECT</span><br><span class="line">                                TIV_2015</span><br><span class="line">                          FROM</span><br><span class="line">                                insurance</span><br><span class="line">                          GROUP BY </span><br><span class="line">                                TIV_2015</span><br><span class="line">                          HAVING </span><br><span class="line">                                COUNT(*) &gt; 1</span><br><span class="line">                          )</span><br><span class="line">                      AND </span><br><span class="line">                          CONCAT(LAT, LON) IN(</span><br><span class="line">                                              SELECT</span><br><span class="line">                                                    CONCAT(LAT, LON)</span><br><span class="line">                                              FROM</span><br><span class="line">                                                    insurance</span><br><span class="line">                                              GROUP BY </span><br><span class="line">                                                    LAT , LON</span><br><span class="line">                                              HAVING COUNT(*) &#x3D; 1</span><br><span class="line">    );</span><br></pre></td></tr></table></figure></div>

<h2 id="23-订单最多的客户"><a href="#23-订单最多的客户" class="headerlink" title="23. 订单最多的客户"></a>23. 订单最多的客户</h2><p>需求：在表 orders 中找到订单数最多客户对应的 customer_number 。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>customer_number</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists orders (order_number int, customer_number int, order_date date, required_date date, shipped_date date, status char(15), comment char(200), key(order_number));</span><br><span class="line"></span><br><span class="line">insert into orders (order_number, customer_number) values (1, 1);</span><br><span class="line">insert into orders (order_number, customer_number) values (2, 2);</span><br><span class="line">insert into orders (order_number, customer_number) values (3, 3);</span><br><span class="line">insert into orders (order_number, customer_number) values (4, 3);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    customer_number</span><br><span class="line">FROM</span><br><span class="line">    orders</span><br><span class="line">GROUP BY </span><br><span class="line">    customer_number</span><br><span class="line">ORDER BY</span><br><span class="line">    COUNT(*) DESC</span><br><span class="line">LIMIT 1;</span><br></pre></td></tr></table></figure></div>

<p>进阶： 如果有多位顾客订单数并列最多，你能找到他们所有的 customer_number 吗？</p>
<h2 id="24-大的国家"><a href="#24-大的国家" class="headerlink" title="24. 大的国家"></a>24. 大的国家</h2><p>需求：编写一个SQL查询，输出表中所有大国家的名称、人口和面积。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>name</th>
<th>population</th>
<th>area</th>
</tr>
</thead>
<tbody><tr>
<td>Afghanistan</td>
<td>25500100</td>
<td>652230</td>
</tr>
<tr>
<td>Algeria</td>
<td>37100000</td>
<td>2381741</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists World (name varchar(255), continent varchar(255), area int, population int, gdp bigint);</span><br><span class="line"></span><br><span class="line">insert into World (name, continent, area, population, gdp) values (&#39;Afghanistan&#39;, &#39;Asia&#39;, 652230, 25500100, 20343000000);</span><br><span class="line">insert into World (name, continent, area, population, gdp) values (&#39;Albania&#39;, &#39;Europe&#39;, 28748, 2831741, 12960000000);</span><br><span class="line">insert into World (name, continent, area, population, gdp) values (&#39;Algeria&#39;, &#39;Africa&#39;, 2381741, 37100000, 188681000000);</span><br><span class="line">insert into World (name, continent, area, population, gdp) values (&#39;Andorra&#39;, &#39;Europe&#39;, 468, 78115, 3712000000);</span><br><span class="line">insert into World (name, continent, area, population, gdp) values (&#39;Angola&#39;, &#39;Africa&#39;, 1246700, 20609294, 100990000000);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#方法一：or</span><br><span class="line">select </span><br><span class="line">      w.name,</span><br><span class="line">      w.population,</span><br><span class="line">      w.area</span><br><span class="line">from </span><br><span class="line">      world w</span><br><span class="line">where </span><br><span class="line">      w.area &gt;3000000 or w.population &gt;25000000</span><br><span class="line"></span><br><span class="line">#方法二：union</span><br><span class="line">select </span><br><span class="line">      w.name,</span><br><span class="line">      w.population,</span><br><span class="line">      w.area</span><br><span class="line">from </span><br><span class="line">      world w</span><br><span class="line">where </span><br><span class="line">      w.area&gt;3000000</span><br><span class="line">union</span><br><span class="line">select</span><br><span class="line">      w.name,</span><br><span class="line">      w.population,</span><br><span class="line">      w.area</span><br><span class="line">from </span><br><span class="line">      world w</span><br><span class="line">where </span><br><span class="line">      w.population&gt;25000000</span><br></pre></td></tr></table></figure></div>

<h2 id="25-超过五名学生的课"><a href="#25-超过五名学生的课" class="headerlink" title="25. 超过五名学生的课"></a>25. 超过五名学生的课</h2><p>需求：编写一个 SQL 查询，列出所有超过或等于5名学生的课。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>class</th>
</tr>
</thead>
<tbody><tr>
<td>Math</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists courses (student varchar(255), class varchar(255));</span><br><span class="line"></span><br><span class="line">insert into courses (student, class) values (&#39;A&#39;, &#39;Math&#39;);</span><br><span class="line">insert into courses (student, class) values (&#39;B&#39;, &#39;English&#39;);</span><br><span class="line">insert into courses (student, class) values (&#39;C&#39;, &#39;Math&#39;);</span><br><span class="line">insert into courses (student, class) values (&#39;D&#39;, &#39;Biology&#39;);</span><br><span class="line">insert into courses (student, class) values (&#39;E&#39;, &#39;Math&#39;);</span><br><span class="line">insert into courses (student, class) values (&#39;F&#39;, &#39;Computer&#39;);</span><br><span class="line">insert into courses (student, class) values (&#39;G&#39;, &#39;Math&#39;);</span><br><span class="line">insert into courses (student, class) values (&#39;H&#39;, &#39;Math&#39;);</span><br><span class="line">insert into courses (student, class) values (&#39;I&#39;, &#39;Math&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      class </span><br><span class="line">from </span><br><span class="line">      courses </span><br><span class="line">group by </span><br><span class="line">      class</span><br><span class="line">having </span><br><span class="line">      count(distinct student)&gt;&#x3D;5 ;</span><br></pre></td></tr></table></figure></div>

<h2 id="26-好友申请"><a href="#26-好友申请" class="headerlink" title="26. 好友申请"></a>26. 好友申请</h2><p>需求一：写一个查询语句，求出好友申请的通过率，用 2 位小数表示。通过率由接受好友申请的数目除以申请总数。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>accept_rate</th>
</tr>
</thead>
<tbody><tr>
<td>0.80</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists friend_request ( sender_id INT NOT NULL, send_to_id INT NULL, request_date DATE NULL);</span><br><span class="line">Create table If Not Exists request_accepted ( requester_id INT NOT NULL, accepter_id INT NULL, accept_date DATE NULL);</span><br><span class="line"></span><br><span class="line">insert into friend_request (sender_id, send_to_id, request_date) values (1, 2, &#39;2016&#x2F;06&#x2F;01&#39;);</span><br><span class="line">insert into friend_request (sender_id, send_to_id, request_date) values (1, 3, &#39;2016&#x2F;06&#x2F;01&#39;);</span><br><span class="line">insert into friend_request (sender_id, send_to_id, request_date) values (1, 4, &#39;2016&#x2F;06&#x2F;01&#39;);</span><br><span class="line">insert into friend_request (sender_id, send_to_id, request_date) values (2, 3, &#39;2016&#x2F;06&#x2F;02&#39;);</span><br><span class="line">insert into friend_request (sender_id, send_to_id, request_date) values (3, 4, &#39;2016&#x2F;06&#x2F;09&#39;);</span><br><span class="line"></span><br><span class="line">insert into request_accepted (requester_id, accepter_id, accept_date) values (1, 2, &#39;2016&#x2F;06&#x2F;03&#39;);</span><br><span class="line">insert into request_accepted (requester_id, accepter_id, accept_date) values (1, 3, &#39;2016&#x2F;06&#x2F;08&#39;);</span><br><span class="line">insert into request_accepted (requester_id, accepter_id, accept_date) values (2, 3, &#39;2016&#x2F;06&#x2F;08&#39;);</span><br><span class="line">insert into request_accepted (requester_id, accepter_id, accept_date) values (3, 4, &#39;2016&#x2F;06&#x2F;09&#39;);</span><br><span class="line">insert into request_accepted (requester_id, accepter_id, accept_date) values (3, 4, &#39;2016&#x2F;06&#x2F;10&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      round(</span><br><span class="line">            ifnull(</span><br><span class="line">                   (select count(*) from (select distinct requester_id, accepter_id from request_accepted) as A)</span><br><span class="line">                   &#x2F;</span><br><span class="line">                   (select count(*) from (select distinct sender_id, send_to_id from friend_request) as B)</span><br><span class="line">            , 0)</span><br><span class="line">      , 2) as accept_rate;</span><br></pre></td></tr></table></figure></div>



<p>需求二：写一个查询语句，求出谁拥有最多的好友和他拥有的好友数目。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>num</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
<td>3</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">select ids as id, cnt as num</span><br><span class="line">from</span><br><span class="line">    (select</span><br><span class="line">           ids,</span><br><span class="line">           count(*) as cnt</span><br><span class="line">     from</span><br><span class="line">           (select </span><br><span class="line">                  requester_id as ids </span><br><span class="line">            from</span><br><span class="line">                  request_accepted</span><br><span class="line">            union all</span><br><span class="line">            select</span><br><span class="line">                  accepter_id </span><br><span class="line">            from</span><br><span class="line">                  request_accepted</span><br><span class="line">            ) as tbl1</span><br><span class="line">     group by ids</span><br><span class="line">     ) as tbl2</span><br><span class="line">order by </span><br><span class="line">     cnt desc</span><br><span class="line">limit 1;</span><br></pre></td></tr></table></figure></div>

<h2 id="27-体育馆人流量"><a href="#27-体育馆人流量" class="headerlink" title="27. 体育馆人流量"></a>27. 体育馆人流量</h2><p>需求：请编写一个查询语句，找出人流量的高峰期。高峰期时，至少连续三行记录中的人流量不少于100。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>visit_date</th>
<th>people</th>
</tr>
</thead>
<tbody><tr>
<td>5</td>
<td>2017-01-05</td>
<td>145</td>
</tr>
<tr>
<td>6</td>
<td>2017-01-06</td>
<td>1455</td>
</tr>
<tr>
<td>7</td>
<td>2017-01-07</td>
<td>199</td>
</tr>
<tr>
<td>8</td>
<td>2017-01-08</td>
<td>188</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists stadium (id int, visit_date DATE NULL, people int);</span><br><span class="line"></span><br><span class="line">insert into stadium (id, visit_date, people) values (1, &#39;2017-01-01&#39;, 10);</span><br><span class="line">insert into stadium (id, visit_date, people) values (2, &#39;2017-01-02&#39;, 109);</span><br><span class="line">insert into stadium (id, visit_date, people) values (3, &#39;2017-01-03&#39;, 150);</span><br><span class="line">insert into stadium (id, visit_date, people) values (4, &#39;2017-01-04&#39;, 99);</span><br><span class="line">insert into stadium (id, visit_date, people) values (5, &#39;2017-01-05&#39;, 145);</span><br><span class="line">insert into stadium (id, visit_date, people) values (6, &#39;2017-01-06&#39;, 1455);</span><br><span class="line">insert into stadium (id, visit_date, people) values (7, &#39;2017-01-07&#39;, 199);</span><br><span class="line">insert into stadium (id, visit_date, people) values (8, &#39;2017-01-08&#39;, 188);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">     distinct a.*</span><br><span class="line">FROM </span><br><span class="line">     stadium as a,</span><br><span class="line">     stadium as b,</span><br><span class="line">     stadium as c</span><br><span class="line">where</span><br><span class="line">     ((a.id &#x3D; b.id-1 and b.id+1 &#x3D; c.id) or(a.id-1 &#x3D; b.id and a.id+1 &#x3D; c.id) or(a.id-1 &#x3D; c.id and c.id-1 &#x3D; b.id))</span><br><span class="line">      and </span><br><span class="line">     (a.people&gt;&#x3D;100 and b.people&gt;&#x3D;100 and c.people&gt;&#x3D;100)</span><br><span class="line">order by </span><br><span class="line">     a.id;</span><br></pre></td></tr></table></figure></div>

<h2 id="28-连续空余座位"><a href="#28-连续空余座位" class="headerlink" title="28. 连续空余座位"></a>28. 连续空余座位</h2><p>需求：编写一个 SQL 查询，获取所有空余座位，并将它们按照 seat_id 排序</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>seat_id</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
</tr>
<tr>
<td>4</td>
</tr>
<tr>
<td>5</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists cinema (seat_id int primary key auto_increment, free bool);</span><br><span class="line"></span><br><span class="line">insert into cinema (seat_id, free) values (1, 1);</span><br><span class="line">insert into cinema (seat_id, free) values (2, 0);</span><br><span class="line">insert into cinema (seat_id, free) values (3, 1);</span><br><span class="line">insert into cinema (seat_id, free) values (4, 1);</span><br><span class="line">insert into cinema (seat_id, free) values (5, 1);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">     distinct a.seat_id</span><br><span class="line">from </span><br><span class="line">     cinema a </span><br><span class="line">join </span><br><span class="line">     cinema b</span><br><span class="line">on </span><br><span class="line">     abs(a.seat_id - b.seat_id) &#x3D; 1 and a.free &#x3D; true and b.free &#x3D; true</span><br><span class="line">order by </span><br><span class="line">     a.seat_id;</span><br></pre></td></tr></table></figure></div>

<h2 id="29-销售员"><a href="#29-销售员" class="headerlink" title="29. 销售员"></a>29. 销售员</h2><p>需求：输出所有表 salesperson中，没有向公司 ‘RED’ 销售任何东西的销售员。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>Amy</td>
</tr>
<tr>
<td>Mark</td>
</tr>
<tr>
<td>Alex</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists salesperson (sales_id int, name varchar(255), salary int,commission_rate int, hire_date varchar(255));</span><br><span class="line">Create table If Not Exists company (com_id int, name varchar(255), city varchar(255));</span><br><span class="line">Create table If Not Exists orders (order_id int, order_date varchar(255), com_id int, sales_id int, amount int);</span><br><span class="line"></span><br><span class="line">insert into salesperson (sales_id, name, salary, commission_rate, hire_date) values (1,&#39;John&#39;,100000, 6, &#39;4&#x2F;1&#x2F;2006&#39;);</span><br><span class="line">insert into salesperson (sales_id, name, salary, commission_rate, hire_date) values (2,&#39;Amy&#39;, 12000, 5, &#39;5&#x2F;1&#x2F;2010&#39;);</span><br><span class="line">insert into salesperson (sales_id, name, salary, commission_rate, hire_date) values (3,&#39;Mark&#39;,65000, 12, &#39;12&#x2F;25&#x2F;2008&#39;);</span><br><span class="line">insert into salesperson (sales_id, name, salary, commission_rate, hire_date) values (4,&#39;Pam&#39;, 25000, 25, &#39;1&#x2F;1&#x2F;2005&#39;);</span><br><span class="line">insert into salesperson (sales_id, name, salary, commission_rate, hire_date) values (5,&#39;Alex&#39;, 5000, 10, &#39;2&#x2F;3&#x2F;2007&#39;);</span><br><span class="line"></span><br><span class="line">insert into company (com_id, name, city) values (1, &#39;RED&#39;, &#39;Boston&#39;);</span><br><span class="line">insert into company (com_id, name, city) values (2, &#39;ORANGE&#39;, &#39;New York&#39;);</span><br><span class="line">insert into company (com_id, name, city) values (3, &#39;YELLOW&#39;, &#39;Boston&#39;);</span><br><span class="line">insert into company (com_id, name, city) values (4, &#39;GREEN&#39;, &#39;Austin&#39;);</span><br><span class="line"></span><br><span class="line">insert into orders (order_id, order_date, com_id, sales_id, amount) values (1, &#39;1&#x2F;1&#x2F;2014&#39;, 3, 4, 10000);</span><br><span class="line">insert into orders (order_id, order_date, com_id, sales_id, amount) values (2, &#39;2&#x2F;1&#x2F;2014&#39;, 4, 5, 5000);</span><br><span class="line">insert into orders (order_id, order_date, com_id, sales_id, amount) values (3, &#39;3&#x2F;1&#x2F;2014&#39;, 1, 1, 50000);</span><br><span class="line">insert into orders (order_id, order_date, com_id, sales_id, amount) values (4, &#39;4&#x2F;1&#x2F;2014&#39;, 1, 4, 25000);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    s.name</span><br><span class="line">FROM</span><br><span class="line">    salesperson s</span><br><span class="line">WHERE</span><br><span class="line">    s.sales_id NOT IN (</span><br><span class="line">                       SELECT</span><br><span class="line">                             o.sales_id</span><br><span class="line">                       FROM</span><br><span class="line">                             orders o</span><br><span class="line">                       LEFT JOIN</span><br><span class="line">                             company c </span><br><span class="line">                       ON</span><br><span class="line">                             o.com_id &#x3D; c.com_id</span><br><span class="line">                       WHERE</span><br><span class="line">                             c.name &#x3D; &#39;RED&#39;</span><br><span class="line">    );</span><br></pre></td></tr></table></figure></div>

<h2 id="30-节点树"><a href="#30-节点树" class="headerlink" title="30. 节点树"></a>30. 节点树</h2><p>需求：写一个查询语句，输出所有节点的编号和节点的类型，并将结果按照节点编号排序。</p>
<p>表 tree，<strong>id</strong> 是树节点的编号， <strong>p_id</strong> 是它父节点的 <strong>id 。</strong></p>
<p>树中每个节点属于以下三种类型之一：</p>
<p>​        叶子：如果这个节点没有任何孩子节点。</p>
<p>​        根：如果这个节点是整棵树的根，即没有父节点。</p>
<p>​        内部节点：如果这个节点既不是叶子节点也不是根节点。</p>
<table>
<thead>
<tr>
<th>id</th>
<th>p_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>null</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
</tr>
</tbody></table>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Root</td>
</tr>
<tr>
<td>2</td>
<td>Inner</td>
</tr>
<tr>
<td>3</td>
<td>Leaf</td>
</tr>
<tr>
<td>4</td>
<td>Leaf</td>
</tr>
<tr>
<td>5</td>
<td>Leaf</td>
</tr>
</tbody></table>
<p>解释:</p>
<p>节点 1 是根节点，因为它的父节点是 NULL ，同时它有孩子节点 2 和 3 。</p>
<p>节点 2 是内部节点，因为它有父节点 1 ，也有孩子节点 4 和 5 。</p>
<p>节点 3, 4 和 5 都是叶子节点，因为它们都有父节点同时没有孩子节点。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists tree (id int, p_id int);</span><br><span class="line"></span><br><span class="line">insert into tree (id, p_id) values (1, null);</span><br><span class="line">insert into tree (id, p_id) values (2, 1);</span><br><span class="line">insert into tree (id, p_id) values (3, 1);</span><br><span class="line">insert into tree (id, p_id) values (4, 2);</span><br><span class="line">insert into tree (id, p_id) values (5, 2);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">SELECT</span><br><span class="line">    id, &#39;Root&#39; AS Type</span><br><span class="line">FROM</span><br><span class="line">    tree</span><br><span class="line">WHERE</span><br><span class="line">    p_id IS NULL</span><br><span class="line"></span><br><span class="line">UNION</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">    id, &#39;Leaf&#39; AS Type</span><br><span class="line">FROM</span><br><span class="line">    tree</span><br><span class="line">WHERE</span><br><span class="line">    id NOT IN (SELECT DISTINCT</span><br><span class="line">            p_id</span><br><span class="line">        FROM</span><br><span class="line">            tree</span><br><span class="line">        WHERE</span><br><span class="line">            p_id IS NOT NULL)</span><br><span class="line">        AND p_id IS NOT NULL</span><br><span class="line"></span><br><span class="line">UNION</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">    id, &#39;Inner&#39; AS Type</span><br><span class="line">FROM</span><br><span class="line">    tree</span><br><span class="line">WHERE</span><br><span class="line">    id IN (SELECT DISTINCT</span><br><span class="line">            p_id</span><br><span class="line">        FROM</span><br><span class="line">            tree</span><br><span class="line">        WHERE</span><br><span class="line">            p_id IS NOT NULL)</span><br><span class="line">        AND p_id IS NOT NULL</span><br><span class="line">ORDER BY id;</span><br><span class="line"></span><br><span class="line">方法二：</span><br><span class="line">SELECT</span><br><span class="line">      id AS &#96;Id&#96;,</span><br><span class="line">      CASE </span><br><span class="line">          WHEN tree.id &#x3D; (SELECT atree.id FROM tree atree WHERE atree.p_id IS NULL) THEN &#39;Root&#39;</span><br><span class="line">          WHEN tree.id IN (SELECT atree.p_id FROM tree atree) THEN &#39;Inner&#39;</span><br><span class="line">          ELSE &#39;Leaf&#39;</span><br><span class="line">      END AS Type</span><br><span class="line">FROM</span><br><span class="line">      tree</span><br><span class="line">ORDER BY &#96;Id&#96;;</span><br><span class="line"></span><br><span class="line">方法三：</span><br><span class="line">SELECT</span><br><span class="line">    atree.id,</span><br><span class="line">    IF(ISNULL(atree.p_id),&#39;Root&#39;, IF(atree.id IN (SELECT p_id FROM tree), &#39;Inner&#39;,&#39;Leaf&#39;)) Type</span><br><span class="line">FROM</span><br><span class="line">    tree atree</span><br><span class="line">ORDER BY atree.id;</span><br></pre></td></tr></table></figure></div>

<h2 id="31-判断是否是三角形"><a href="#31-判断是否是三角形" class="headerlink" title="31. 判断是否是三角形"></a>31. 判断是否是三角形</h2><p>需求：编写一个 SQL 查询，判断三条线段是否能形成一个三角形。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
<th>z</th>
<th>triangle</th>
</tr>
</thead>
<tbody><tr>
<td>13</td>
<td>15</td>
<td>15</td>
<td>No</td>
</tr>
<tr>
<td>10</td>
<td>20</td>
<td>15</td>
<td>Yes</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists triangle (x int, y int, z int);</span><br><span class="line"></span><br><span class="line">insert into triangle (x, y, z) values (13, 15, 30);</span><br><span class="line">insert into triangle (x, y, z) values (10, 20, 15);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      x,</span><br><span class="line">      y,</span><br><span class="line">      z,</span><br><span class="line">      if((x + y &lt;&#x3D; z or x + z &lt;&#x3D; y or y + z &lt;&#x3D; x), &quot;No&quot;, &quot;Yes&quot;) as triangle</span><br><span class="line">from triangle;</span><br></pre></td></tr></table></figure></div>

<h2 id="32-平面上的最近距离"><a href="#32-平面上的最近距离" class="headerlink" title="32. 平面上的最近距离"></a>32. 平面上的最近距离</h2><p>需求：写一个查询语句找到两点之间的最近距离，保留 2 位小数。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>shortest</th>
</tr>
</thead>
<tbody><tr>
<td>1.00</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE If Not Exists point_2d (x INT NOT NULL, y INT NOT NULL);</span><br><span class="line"></span><br><span class="line">insert into point_2d (x, y) values (-1, -1);</span><br><span class="line">insert into point_2d (x, y) values (0, 0);</span><br><span class="line">insert into point_2d (x, y) values (-1, -2);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#方法一：</span><br><span class="line">SELECT</span><br><span class="line">    ROUND(SQRT(MIN((POW(p1.x - p2.x, 2) + POW(p1.y - p2.y, 2)))), 2) AS shortest</span><br><span class="line">FROM</span><br><span class="line">    point_2d p1</span><br><span class="line">JOIN</span><br><span class="line">    point_2d p2 </span><br><span class="line">ON </span><br><span class="line">    p1.x !&#x3D; p2.x OR p1.y !&#x3D; p2.y;</span><br><span class="line"></span><br><span class="line">#方法二：</span><br><span class="line">SELECT</span><br><span class="line">    ROUND(SQRT(MIN((POW(p1.x - p2.x, 2) + POW(p1.y - p2.y, 2)))),2) AS shortest</span><br><span class="line">FROM</span><br><span class="line">    point_2d p1</span><br><span class="line">JOIN</span><br><span class="line">    point_2d p2 </span><br><span class="line">ON (p1.x &lt;&#x3D; p2.x AND p1.y &lt; p2.y) OR (p1.x &lt;&#x3D; p2.x AND p1.y &gt; p2.y) OR (p1.x &lt; p2.x AND p1.y &#x3D; p2.y);</span><br></pre></td></tr></table></figure></div>

<h2 id="33-直线上最近距离"><a href="#33-直线上最近距离" class="headerlink" title="33. 直线上最近距离"></a>33. 直线上最近距离</h2><p>需求：找到这些点中最近两个点之间的距离。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>shortest</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE If Not Exists point (x INT NOT NULL, UNIQUE INDEX x_UNIQUE (x ASC));</span><br><span class="line"></span><br><span class="line">insert into point (x) values (-1);</span><br><span class="line">insert into point (x) values (0);</span><br><span class="line">insert into point (x) values (2);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    MIN(ABS(p1.x - p2.x)) AS shortest</span><br><span class="line">FROM</span><br><span class="line">    point p1</span><br><span class="line">JOIN</span><br><span class="line">    point p2 </span><br><span class="line">ON p1.x !&#x3D; p2.x;</span><br></pre></td></tr></table></figure></div>

<h2 id="34-二级关注者"><a href="#34-二级关注者" class="headerlink" title="34. 二级关注者"></a>34. 二级关注者</h2><p>需求：对每一个关注者(follower)，查询他的关注者数目。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>follower</th>
<th>num</th>
</tr>
</thead>
<tbody><tr>
<td>B</td>
<td>2</td>
</tr>
<tr>
<td>D</td>
<td>1</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists follow (followee varchar(255), follower varchar(255));</span><br><span class="line"></span><br><span class="line">insert into follow (followee, follower) values (&#39;A&#39;, &#39;B&#39;);</span><br><span class="line">insert into follow (followee, follower) values (&#39;B&#39;, &#39;C&#39;);</span><br><span class="line">insert into follow (followee, follower) values (&#39;B&#39;, &#39;D&#39;);</span><br><span class="line">insert into follow (followee, follower) values (&#39;D&#39;, &#39;E&#39;);</span><br></pre></td></tr></table></figure></div>

<p>解释：</p>
<p>以A为主体，A为被关注者，B为被关注者，求出关注B的关注者。这里需要注意，被关注者永远不会被他 / 她自己关注。<br>将结果按照字典序返回。</p>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      followee as &#39;follower&#39;,</span><br><span class="line">      count(distinct follower) as num</span><br><span class="line">from</span><br><span class="line">      follow</span><br><span class="line">where</span><br><span class="line">      followee in(select follower from follow)</span><br><span class="line">group by </span><br><span class="line">      1</span><br><span class="line">order by</span><br><span class="line">      1;</span><br></pre></td></tr></table></figure></div>

<h2 id="35-平均工资"><a href="#35-平均工资" class="headerlink" title="35. 平均工资"></a>35. 平均工资</h2><p>需求：写一个查询语句，求出在每一个工资发放日，每个部门的平均工资与公司的平均工资的比较结果 （高 / 低 / 相同）</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>pay_month</th>
<th>department_id</th>
<th>comparison</th>
</tr>
</thead>
<tbody><tr>
<td>2017-03</td>
<td>1</td>
<td>higher</td>
</tr>
<tr>
<td>2017-03</td>
<td>2</td>
<td>lower</td>
</tr>
<tr>
<td>2017-02</td>
<td>1</td>
<td>same</td>
</tr>
<tr>
<td>2017-02</td>
<td>2</td>
<td>same</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists salary (id int, employee_id int, amount int, pay_date date);</span><br><span class="line">Create table If Not Exists employee (employee_id int, department_id int);</span><br><span class="line"></span><br><span class="line">insert into salary (id, employee_id, amount, pay_date) values (1, 1, 9000, &#39;2017&#x2F;03&#x2F;31&#39;);</span><br><span class="line">insert into salary (id, employee_id, amount, pay_date) values (2, 2, 6000, &#39;2017&#x2F;03&#x2F;31&#39;);</span><br><span class="line">insert into salary (id, employee_id, amount, pay_date) values (3, 3, 10000, &#39;2017&#x2F;03&#x2F;31&#39;);</span><br><span class="line">insert into salary (id, employee_id, amount, pay_date) values (4, 1, 7000, &#39;2017&#x2F;02&#x2F;28&#39;);</span><br><span class="line">insert into salary (id, employee_id, amount, pay_date) values (5, 2, 6000, &#39;2017&#x2F;02&#x2F;28&#39;);</span><br><span class="line">insert into salary (id, employee_id, amount, pay_date) values (6, 3, 8000, &#39;2017&#x2F;02&#x2F;28&#39;);</span><br><span class="line"></span><br><span class="line">insert into employee (employee_id, department_id) values (1, 1);</span><br><span class="line">insert into employee (employee_id, department_id) values (2, 2);</span><br><span class="line">insert into employee (employee_id, department_id) values (3, 2);</span><br></pre></td></tr></table></figure></div>

<p>解释:</p>
<p>在三月，公司的平均工资是 (9000+6000+10000)/3 = 8333.33…</p>
<p>由于部门 1 里只有一个 employee_id 为 1 的员工，所以部门 1 的平均工资就是此人的工资 9000 。因为 9000 &gt; 8333.33 ，所以比较结果是 ‘higher’。</p>
<p>第二个部门的平均工资为 employee_id 为 2 和 3 两个人的平均工资，为 (6000+10000)/2=8000 。因为 8000 &lt; 8333.33 ，所以比较结果是 ‘lower’ 。</p>
<p> 在二月用同样的公式求平均工资并比较，比较结果为 ‘same’ ，因为部门 1 和部门 2 的平均工资与公司的平均工资相同，都是 7000 。</p>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      department_salary.pay_month,</span><br><span class="line">      department_id,</span><br><span class="line">      case</span><br><span class="line">          when department_avg&gt;company_avg then &#39;higher&#39;</span><br><span class="line">          when department_avg&lt;company_avg then &#39;lower&#39;</span><br><span class="line">          else &#39;same&#39;</span><br><span class="line">      end as comparison</span><br><span class="line">from</span><br><span class="line">     (select</span><br><span class="line">            department_id,</span><br><span class="line">            avg(amount) as department_avg,</span><br><span class="line">            date_format(pay_date, &#39;%Y-%m&#39;) as pay_month</span><br><span class="line">      from </span><br><span class="line">            salary </span><br><span class="line">      join</span><br><span class="line">            employee</span><br><span class="line">      on  </span><br><span class="line">            salary.employee_id &#x3D; employee.employee_id</span><br><span class="line">     group by</span><br><span class="line">            department_id, pay_month</span><br><span class="line">     ) as department_salary</span><br><span class="line">join</span><br><span class="line">    (select</span><br><span class="line">           avg(amount) as company_avg,</span><br><span class="line">           date_format(pay_date, &#39;%Y-%m&#39;) as pay_month </span><br><span class="line">     from </span><br><span class="line">           salary</span><br><span class="line">     group by</span><br><span class="line">           date_format(pay_date, &#39;%Y-%m&#39;)</span><br><span class="line">     ) as company_salary</span><br><span class="line">on </span><br><span class="line">     department_salary.pay_month &#x3D; company_salary.pay_month;</span><br></pre></td></tr></table></figure></div>

<h2 id="36-学生地理信息报告"><a href="#36-学生地理信息报告" class="headerlink" title="36. 学生地理信息报告"></a>36. 学生地理信息报告</h2><p>需求：写一个查询语句实现对大洲（continent）列的 透视表 操作，使得每个学生按照姓名的字母顺序依次排列在对应的大洲下面。输出的标题应依次为美洲（America）、亚洲（Asia）和欧洲（Europe）。数据保证来自美洲的学生不少于来自亚洲或者欧洲的学生。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>America</th>
<th>Asia</th>
<th>Europe</th>
</tr>
</thead>
<tbody><tr>
<td>Jack</td>
<td>Xi</td>
<td>Pascal</td>
</tr>
<tr>
<td>Jane</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists student (name varchar(50), continent varchar(7));</span><br><span class="line"></span><br><span class="line">insert into student (name, continent) values (&#39;Jane&#39;, &#39;America&#39;);</span><br><span class="line">insert into student (name, continent) values (&#39;Pascal&#39;, &#39;Europe&#39;);</span><br><span class="line">insert into student (name, continent) values (&#39;Xi&#39;, &#39;Asia&#39;);</span><br><span class="line">insert into student (name, continent) values (&#39;Jack&#39;, &#39;America&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">      MAX(if(A.continent &#x3D; &#39;America&#39;,A.NAME,NULL)) AS &#96;America&#96;,</span><br><span class="line">      MAX(if(A.continent &#x3D; &#39;Asia&#39;,A.NAME,NULL)) AS &#96;Asia&#96;,</span><br><span class="line">      MAX(if(A.continent &#x3D; &#39;Europe&#39;,A.NAME,NULL)) AS &#96;Europe&#96;</span><br><span class="line">FROM</span><br><span class="line">     (SELECT </span><br><span class="line">             S1.continent,</span><br><span class="line">             S1.NAME,</span><br><span class="line">             S1.row_id,</span><br><span class="line">             COUNT(*) AS &#96;trank&#96;</span><br><span class="line">	  FROM </span><br><span class="line">	        (SELECT</span><br><span class="line">                    S.*,</span><br><span class="line">                    @row_id:&#x3D;(@row_id + 1) AS &#96;row_id&#96;</span><br><span class="line">		     FROM</span><br><span class="line">                    student AS S,</span><br><span class="line">                    (SELECT @row_id:&#x3D;0) AS T</span><br><span class="line">             ) AS S1 </span><br><span class="line">	  JOIN </span><br><span class="line">	        (SELECT</span><br><span class="line">                    S.*,</span><br><span class="line">                    @n_row_id:&#x3D;(@n_row_id + 1) AS &#96;n_row_id&#96;</span><br><span class="line">		     FROM </span><br><span class="line">                    student AS S,</span><br><span class="line">                    (SELECT @n_row_id:&#x3D;0) AS T</span><br><span class="line">	         ) AS S2 </span><br><span class="line">	  ON </span><br><span class="line">            (S1.continent &#x3D; S2.continent AND</span><br><span class="line">            (S1.NAME &gt; S2.NAME OR (S1.NAME &#x3D; S2.NAME AND S1.row_id &gt;&#x3D; S2.n_row_id)))</span><br><span class="line">	  group BY</span><br><span class="line">             S1.continent,S1.NAME,S1.row_id</span><br><span class="line">	  order BY</span><br><span class="line">             S1.continent,S1.NAME</span><br><span class="line">      ) AS A</span><br><span class="line">GROUP BY </span><br><span class="line">      A.trank;</span><br></pre></td></tr></table></figure></div>

<h2 id="37-只出现一次的最大数字"><a href="#37-只出现一次的最大数字" class="headerlink" title="37. 只出现一次的最大数字"></a>37. 只出现一次的最大数字</h2><p>需求：编写一个 SQL 查询，找到只出现过一次的数字中，最大的一个数字。如果没有只出现一次的数字，输出 null 。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>num</th>
</tr>
</thead>
<tbody><tr>
<td>6</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists my_numbers (num int);</span><br><span class="line"></span><br><span class="line">insert into my_numbers (num) values (8);</span><br><span class="line">insert into my_numbers (num) values (8);</span><br><span class="line">insert into my_numbers (num) values (3);</span><br><span class="line">insert into my_numbers (num) values (3);</span><br><span class="line">insert into my_numbers (num) values (1);</span><br><span class="line">insert into my_numbers (num) values (4);</span><br><span class="line">insert into my_numbers (num) values (5);</span><br><span class="line">insert into my_numbers (num) values (6);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      ifnull((SELECT </span><br><span class="line">                    num</span><br><span class="line">              FROM </span><br><span class="line">                    my_numbers</span><br><span class="line">              group by </span><br><span class="line">                    num</span><br><span class="line">              having</span><br><span class="line">                    count(*) &#x3D; 1</span><br><span class="line">              order by </span><br><span class="line">                    num desc</span><br><span class="line">              limit 1), null) as num;</span><br></pre></td></tr></table></figure></div>

<h2 id="38-有趣的电影"><a href="#38-有趣的电影" class="headerlink" title="38. 有趣的电影"></a>38. 有趣的电影</h2><p>需求：编写一个 SQL 查询，找出所有影片描述为非 boring (不无聊) 的并且 id 为奇数 的影片，结果请按等级 rating 排列</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>movie</th>
<th>description</th>
<th>rating</th>
</tr>
</thead>
<tbody><tr>
<td>5</td>
<td>House card</td>
<td>Interesting</td>
<td>9.1</td>
</tr>
<tr>
<td>1</td>
<td>War</td>
<td>great 3D</td>
<td>8.9</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists cinema (id int, movie varchar(255), description varchar(255), rating float(2, 1));</span><br><span class="line"></span><br><span class="line">insert into cinema (id, movie, description, rating) values (1, &#39;War&#39;, &#39;great 3D&#39;, 8.9);</span><br><span class="line">insert into cinema (id, movie, description, rating) values (2, &#39;Science&#39;, &#39;fiction&#39;, 8.5);</span><br><span class="line">insert into cinema (id, movie, description, rating) values (3, &#39;irish&#39;, &#39;boring&#39;, 6.2);</span><br><span class="line">insert into cinema (id, movie, description, rating) values (4, &#39;Ice song&#39;, &#39;Fantacy&#39;, 8.6);</span><br><span class="line">insert into cinema (id, movie, description, rating) values (5, &#39;House card&#39;, &#39;Interesting&#39;, 9.1);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      id,</span><br><span class="line">      movie,</span><br><span class="line">      description,</span><br><span class="line">      rating</span><br><span class="line">from </span><br><span class="line">      cinema</span><br><span class="line">where </span><br><span class="line">      mod(id, 2) &#x3D; 1 and description !&#x3D; &#39;boring&#39;</span><br><span class="line">order by </span><br><span class="line">      rating DESC;</span><br></pre></td></tr></table></figure></div>

<h2 id="39-换座位"><a href="#39-换座位" class="headerlink" title="39. 换座位"></a>39. 换座位</h2><p>需求：编写一个 SQL 查询，小美是一所中学的信息科技老师，她有一张 seat 座位表，平时用来储存学生名字和与他们相对应的座位 id。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>student</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Doris</td>
</tr>
<tr>
<td>2</td>
<td>Abbot</td>
</tr>
<tr>
<td>3</td>
<td>Green</td>
</tr>
<tr>
<td>4</td>
<td>Emerson</td>
</tr>
<tr>
<td>5</td>
<td>Jeames</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists seat(id int, student varchar(255));</span><br><span class="line"></span><br><span class="line">insert into seat (id, student) values (1, &#39;Abbot&#39;);</span><br><span class="line">insert into seat (id, student) values (2, &#39;Doris&#39;);</span><br><span class="line">insert into seat (id, student) values (3, &#39;Emerson&#39;);</span><br><span class="line">insert into seat (id, student) values (4, &#39;Green&#39;);</span><br><span class="line">insert into seat (id, student) values (5, &#39;Jeames&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#方法一</span><br><span class="line">select </span><br><span class="line">      a.id,</span><br><span class="line">      ifnull(b.student,a.student) as student </span><br><span class="line">from </span><br><span class="line">      seat as a </span><br><span class="line">left </span><br><span class="line">      join seat as b </span><br><span class="line">on </span><br><span class="line">      (a.id%2&#x3D;1 &amp;&amp; a.id&#x3D;b.id-1) || (a.id%2&#x3D;0 &amp;&amp; a.id&#x3D;b.id+1) </span><br><span class="line">order by </span><br><span class="line">      a.id;</span><br><span class="line"></span><br><span class="line">#方法二</span><br><span class="line">select </span><br><span class="line">      if(id%2&#x3D;0,id-1,if(id&#x3D;cnt,id,id+1)) as id,</span><br><span class="line">      student</span><br><span class="line">from </span><br><span class="line">      (select </span><br><span class="line">             count(*) as cnt</span><br><span class="line">       from </span><br><span class="line">             seat</span><br><span class="line">      )as a,</span><br><span class="line">      seat</span><br><span class="line">order by id;</span><br><span class="line"></span><br><span class="line">#方法三      </span><br><span class="line">select </span><br><span class="line">      b.id,</span><br><span class="line">      a.student</span><br><span class="line">from </span><br><span class="line">      seat as a,</span><br><span class="line">      seat as b,</span><br><span class="line">      (select</span><br><span class="line">             count(*) as cnt</span><br><span class="line">       from</span><br><span class="line">             seat</span><br><span class="line">      ) as c </span><br><span class="line">where </span><br><span class="line">      b.id&#x3D;1^(a.id-1)+1 || (c.cnt%2 &amp;&amp; b.id&#x3D;c.cnt &amp;&amp; a.id&#x3D;c.cnt);</span><br></pre></td></tr></table></figure></div>

<h2 id="40-交换工资"><a href="#40-交换工资" class="headerlink" title="40. 交换工资"></a>40. 交换工资</h2><p>需求：编写一个 SQL 查询，判断三条线段是否能形成一个三角形。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>sex</th>
<th>salary</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>A</td>
<td>f</td>
<td>2500</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
<td>m</td>
<td>1500</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
<td>f</td>
<td>5500</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
<td>m</td>
<td>500</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists salary(id int, name varchar(100), sex char(1), salary int);</span><br><span class="line"></span><br><span class="line">insert into salary (id, name, sex, salary) values (1, &#39;A&#39;, &#39;m&#39;, 2500);</span><br><span class="line">insert into salary (id, name, sex, salary) values (2, &#39;B&#39;, &#39;f&#39;, 1500);</span><br><span class="line">insert into salary (id, name, sex, salary) values (3, &#39;C&#39;, &#39;m&#39;, 5500);</span><br><span class="line">insert into salary (id, name, sex, salary) values (4, &#39;D&#39;, &#39;f&#39;, 500);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UPDATE salary</span><br><span class="line">SET</span><br><span class="line">    sex &#x3D; CASE sex</span><br><span class="line">               WHEN &#39;m&#39; THEN &#39;f&#39;</span><br><span class="line">               ELSE &#39;m&#39;</span><br><span class="line">          END;</span><br></pre></td></tr></table></figure></div>

<h2 id="41-买下所有产品的用户"><a href="#41-买下所有产品的用户" class="headerlink" title="41. 买下所有产品的用户"></a>41. 买下所有产品的用户</h2><p>需求：编写一个 SQL 查询，从 Customer 表中查询购买了 Product 表中所有产品的客户的 id。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>customer_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
<tr>
<td>3</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Customer (customer_id int, product_key int)</span><br><span class="line">Create table Product (product_key int)</span><br><span class="line"></span><br><span class="line">insert into Customer (customer_id, product_key) values (1, 5)</span><br><span class="line">insert into Customer (customer_id, product_key) values (2, &#39;6&#39;)</span><br><span class="line">insert into Customer (customer_id, product_key) values (3, 5)</span><br><span class="line">insert into Customer (customer_id, product_key) values (3, &#39;6&#39;)</span><br><span class="line">insert into Customer (customer_id, product_key) values (1, &#39;6&#39;)</span><br><span class="line"></span><br><span class="line">insert into Product (product_key) values (5)</span><br><span class="line">insert into Product (product_key) values (&#39;6&#39;)</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select customer_id</span><br><span class="line">from </span><br><span class="line">(select customer_id,count(distinct product_key) as num </span><br><span class="line"> from Customer</span><br><span class="line"> group by customer_id</span><br><span class="line">) t</span><br><span class="line">join (</span><br><span class="line">    select count(product_key) as num</span><br><span class="line">    from Product</span><br><span class="line">) m </span><br><span class="line">on t.num &#x3D; m.num;</span><br></pre></td></tr></table></figure></div>

<h2 id="42-合作过至少三次的演员和导演"><a href="#42-合作过至少三次的演员和导演" class="headerlink" title="42. 合作过至少三次的演员和导演"></a>42. 合作过至少三次的演员和导演</h2><p>需求：编写一个 SQL 查询，查询语句获取合作过至少三次的演员和导演的 id 对 (actor_id, director_id)</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>actor_id</th>
<th>director_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>15</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists ActorDirector (actor_id int, director_id int, timestamp int);</span><br><span class="line"></span><br><span class="line">insert into ActorDirector (actor_id, director_id, timestamp) values (1, 1, 0);</span><br><span class="line">insert into ActorDirector (actor_id, director_id, timestamp) values (1, 1, 1);</span><br><span class="line">insert into ActorDirector (actor_id, director_id, timestamp) values (1, 1, 2);</span><br><span class="line">insert into ActorDirector (actor_id, director_id, timestamp) values (1, 2, 3);</span><br><span class="line">insert into ActorDirector (actor_id, director_id, timestamp) values (1, 2, 4);</span><br><span class="line">insert into ActorDirector (actor_id, director_id, timestamp) values (2, 1, 5);</span><br><span class="line">insert into ActorDirector (actor_id, director_id, timestamp) values (2, 1, 6);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      actor_id as ACTOR_ID ,</span><br><span class="line">      director_id as DIRECTOR_ID</span><br><span class="line">from </span><br><span class="line">      ActorDirector </span><br><span class="line">group by </span><br><span class="line">      actor_id,director_id </span><br><span class="line">having </span><br><span class="line">      count(*)&gt;&#x3D;3;</span><br></pre></td></tr></table></figure></div>

<h2 id="43-产品销售分析"><a href="#43-产品销售分析" class="headerlink" title="43. 产品销售分析"></a>43. 产品销售分析</h2><p>需求一：获取产品表 <code>Product</code> 中所有的 <strong>产品名称 product name</strong> 以及 该产品在 <code>Sales</code> 表中相对应的 <strong>上市年份 year</strong> 和 <strong>价格 price</strong>。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>product_name</th>
<th>year</th>
<th>price</th>
</tr>
</thead>
<tbody><tr>
<td>Nokia</td>
<td>2008</td>
<td>5000</td>
</tr>
<tr>
<td>Nokia</td>
<td>2009</td>
<td>5000</td>
</tr>
<tr>
<td>Apple</td>
<td>2011</td>
<td>9000</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Create table Sales (sale_id int, product_id int, year int, quantity int, price int);</span><br><span class="line">Create table Product (product_id int, product_name varchar(10));</span><br><span class="line"></span><br><span class="line">insert into Sales (sale_id, product_id, year, quantity, price) values (1, 100, 2008, 10, 5000);</span><br><span class="line">insert into Sales (sale_id, product_id, year, quantity, price) values (2, 100, 2009, 12, 5000);</span><br><span class="line">insert into Sales (sale_id, product_id, year, quantity, price) values (7, 200, 2011, 15, 9000);</span><br><span class="line"></span><br><span class="line">insert into Product (product_id, product_name) values (100, &#39;Nokia&#39;);</span><br><span class="line">insert into Product (product_id, product_name) values (200, &#39;Apple&#39;);</span><br><span class="line">insert into Product (product_id, product_name) values (300, &#39;Samsung&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      product_name,</span><br><span class="line">      year,</span><br><span class="line">      price</span><br><span class="line">from </span><br><span class="line">      Sales </span><br><span class="line">inner join </span><br><span class="line">      Product</span><br><span class="line">on</span><br><span class="line">      Sales.product_id &#x3D; Product.product_id;</span><br></pre></td></tr></table></figure></div>

<p>需求二：按产品 id product_id 来统计每个产品的销售总量。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>total_quantity</th>
</tr>
</thead>
<tbody><tr>
<td>100</td>
<td>22</td>
</tr>
<tr>
<td>200</td>
<td>15</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    product_id, </span><br><span class="line">    SUM(quantity) as total_quantity</span><br><span class="line">FROM</span><br><span class="line">    Sales</span><br><span class="line">GROUP BY</span><br><span class="line">    product_id;</span><br></pre></td></tr></table></figure></div>

<p>需求三：选出每个销售产品的 第一年 的 产品 id、年份、数量 和 价格。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>first_year</th>
<th>quantity</th>
<th>price</th>
</tr>
</thead>
<tbody><tr>
<td>100</td>
<td>2008</td>
<td>10</td>
<td>5000</td>
</tr>
<tr>
<td>200</td>
<td>2011</td>
<td>15</td>
<td>9000</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      product_id,</span><br><span class="line">      year as first_year, </span><br><span class="line">      quantity,</span><br><span class="line">      price</span><br><span class="line">from </span><br><span class="line">      Sales</span><br><span class="line">where </span><br><span class="line">     (product_id , year) in(</span><br><span class="line">                            select</span><br><span class="line">                                  product_id ,</span><br><span class="line">                                  min(year)</span><br><span class="line">                            from</span><br><span class="line">                                  Sales</span><br><span class="line">                            group by </span><br><span class="line">                                  product_id</span><br><span class="line">                            );</span><br></pre></td></tr></table></figure></div>

<h2 id="44-项目员工"><a href="#44-项目员工" class="headerlink" title="44. 项目员工"></a>44. 项目员工</h2><p>需求一：查询每一个项目中员工的平均工作年限，精确到小数点后两位。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>project_id</th>
<th>average_years</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2.00</td>
</tr>
<tr>
<td>2</td>
<td>2.50</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Project (project_id int, employee_id int);</span><br><span class="line">Create table If Not Exists Employee (employee_id int, name varchar(10), experience_years int);</span><br><span class="line"></span><br><span class="line">insert into Project (project_id, employee_id) values (1, 1);</span><br><span class="line">insert into Project (project_id, employee_id) values (1, 2);</span><br><span class="line">insert into Project (project_id, employee_id) values (1, 3);</span><br><span class="line">insert into Project (project_id, employee_id) values (2, 1);</span><br><span class="line">insert into Project (project_id, employee_id) values (2, 4);</span><br><span class="line"></span><br><span class="line">insert into Employee (employee_id, name, experience_years) values (1, &#39;Khaled&#39;, 3);</span><br><span class="line">insert into Employee (employee_id, name, experience_years) values (2, &#39;Ali&#39;, 2);</span><br><span class="line">insert into Employee (employee_id, name, experience_years) values (3, &#39;John&#39;, 1);</span><br><span class="line">insert into Employee (employee_id, name, experience_years) values (4, &#39;Doe&#39;, 2);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      project_id ,</span><br><span class="line">      round(avg(experience_years),2) as average_years</span><br><span class="line">from </span><br><span class="line">      Project</span><br><span class="line">left join </span><br><span class="line">      Employee</span><br><span class="line">on </span><br><span class="line">      Project.employee_id &#x3D; Employee.employee_id</span><br><span class="line">group by </span><br><span class="line">      project_id</span><br><span class="line">order by</span><br><span class="line">      project_id;</span><br></pre></td></tr></table></figure></div>

<p>需求二：报告所有雇员最多的项目。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>project_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">      project_id</span><br><span class="line">FROM </span><br><span class="line">      Project</span><br><span class="line">GROUP BY </span><br><span class="line">      project_id</span><br><span class="line">HAVING </span><br><span class="line">      COUNT(employee_id) &#x3D; (SELECT</span><br><span class="line">                                  MAX(count_employee_id)</span><br><span class="line">                            FROM</span><br><span class="line">                                (SELECT </span><br><span class="line">                                       project_id,</span><br><span class="line">                                       COUNT(employee_id) AS count_employee_id</span><br><span class="line">                                 FROM</span><br><span class="line">                                       Project</span><br><span class="line">                                 GROUP BY </span><br><span class="line">                                       project_id</span><br><span class="line">                                ) As temp</span><br><span class="line">                           );</span><br></pre></td></tr></table></figure></div>

<p>需求三：报告在每一个项目中经验最丰富的雇员是谁。如果出现经验年数相同的情况，请报告所有具有最大经验年数的员工。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>project_id</th>
<th>employee_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      p.project_id,</span><br><span class="line">      p.employee_id</span><br><span class="line">from </span><br><span class="line">      Project p</span><br><span class="line">join </span><br><span class="line">      Employee e</span><br><span class="line">on </span><br><span class="line">      p.employee_id &#x3D; e.employee_id</span><br><span class="line">where </span><br><span class="line">     (p.project_id, e.experience_years) in (select</span><br><span class="line">                                                  p.project_id,</span><br><span class="line">                                                  max(e.experience_years)</span><br><span class="line">                                            from</span><br><span class="line">                                                  project p </span><br><span class="line">                                            join</span><br><span class="line">                                                  employee e</span><br><span class="line">                                            on </span><br><span class="line">                                                  p.employee_id &#x3D; e.employee_id</span><br><span class="line">                                            group by</span><br><span class="line">                                                  p.project_id</span><br><span class="line">                                           );</span><br></pre></td></tr></table></figure></div>

<h2 id="45-销售分析"><a href="#45-销售分析" class="headerlink" title="45. 销售分析"></a>45. 销售分析</h2><p>需求一：编写一个 SQL 查询，查询总销售额最高的销售者，如果有并列的，就都展示出来。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>seller_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
<tr>
<td>3</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Product (product_id int, product_name varchar(10), unit_price int);</span><br><span class="line">Create table If Not Exists Sales (seller_id int, product_id int,buyer_id int, sale_date date, quantity int, price int);</span><br><span class="line"></span><br><span class="line">insert into Product (product_id, product_name, unit_price) values (1, &#39;S8&#39;, 1000);</span><br><span class="line">insert into Product (product_id, product_name, unit_price) values (2, &#39;G4&#39;, 800);</span><br><span class="line">insert into Product (product_id, product_name, unit_price) values (3, &#39;iPhone&#39;, 1400);</span><br><span class="line"></span><br><span class="line">insert into Sales (seller_id, product_id, buyer_id, sale_date, quantity, price) values (1, 1, 1,&#39;2019-01-21&#39;, 2, 2000);</span><br><span class="line">insert into Sales (seller_id, product_id, buyer_id, sale_date, quantity, price) values (1, 2, 2,&#39;2019-02-17&#39;, 1, 800);</span><br><span class="line">insert into Sales (seller_id, product_id, buyer_id, sale_date, quantity, price) values (2, 1, 3,&#39;2019-06-02&#39;, 1, 800);</span><br><span class="line">insert into Sales (seller_id, product_id, buyer_id, sale_date, quantity, price) values (3, 3, 3,&#39;2019-05-13&#39;, 2, 2800);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      seller_id </span><br><span class="line">from </span><br><span class="line">      Sales</span><br><span class="line">group by </span><br><span class="line">      seller_id</span><br><span class="line">having </span><br><span class="line">      sum(price) &#x3D; (select</span><br><span class="line">                          sum(price) as ye_ji</span><br><span class="line">                    from  </span><br><span class="line">                          Sales</span><br><span class="line">                    group by</span><br><span class="line">                          seller_id</span><br><span class="line">                    order by </span><br><span class="line">                          ye_ji desc</span><br><span class="line">                    limit 1</span><br><span class="line">                   );</span><br></pre></td></tr></table></figure></div>

<p>需求二：编写一个 SQL 查询，查询购买了 S8 手机却没有购买 iPhone 的买家。注意这里 S8 和 iPhone 是 Product 表中的产品。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>buyer_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#方法一</span><br><span class="line">select </span><br><span class="line">      distinct buyer_id</span><br><span class="line">from </span><br><span class="line">      product p </span><br><span class="line">inner join </span><br><span class="line">      sales s</span><br><span class="line">on </span><br><span class="line">      p.product_id&#x3D;s.product_id</span><br><span class="line">where </span><br><span class="line">      product_name&#x3D;&#39;S8&#39; and buyer_id not in (select</span><br><span class="line">                                                    buyer_id</span><br><span class="line">                                              from</span><br><span class="line">                                                    product p</span><br><span class="line">                                              inner join</span><br><span class="line">                                                    sales s</span><br><span class="line">                                              on</span><br><span class="line">                                                    p.product_id&#x3D;s.product_id</span><br><span class="line">                                              where</span><br><span class="line">                                                    product_name&#x3D;&#39;iPhone&#39;</span><br><span class="line">                                              );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#方法二</span><br><span class="line">select </span><br><span class="line">      s8 as buyer_id</span><br><span class="line">from </span><br><span class="line">      (select </span><br><span class="line">             distinct buyer_id s8</span><br><span class="line">       from</span><br><span class="line">             product p </span><br><span class="line">       inner join </span><br><span class="line">             sales s</span><br><span class="line">       on</span><br><span class="line">             p.product_id&#x3D;s.product_id</span><br><span class="line">       where</span><br><span class="line">             product_name&#x3D;&#39;S8&#39;) t1</span><br><span class="line">left join</span><br><span class="line">      (select</span><br><span class="line">             distinct buyer_id ip</span><br><span class="line">       from</span><br><span class="line">             product p</span><br><span class="line">       inner join </span><br><span class="line">             sales s</span><br><span class="line">       on</span><br><span class="line">             p.product_id&#x3D;s.product_id</span><br><span class="line">       where</span><br><span class="line">             product_name&#x3D;&#39;iPhone&#39;</span><br><span class="line">      ) t2</span><br><span class="line">on </span><br><span class="line">       s8&#x3D;ip</span><br><span class="line">where </span><br><span class="line">       ip is null;</span><br></pre></td></tr></table></figure></div>

<p>需求三：编写一个 SQL 查询，报告2019年春季才售出的产品。即在2019-01-01至2019-03-31（含）之间。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>product_name</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>S8</td>
</tr>
<tr>
<td>2</td>
<td>G4</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">      s.product_id,</span><br><span class="line">      product_name</span><br><span class="line">FROM </span><br><span class="line">      Sales s</span><br><span class="line">JOIN </span><br><span class="line">      Product p</span><br><span class="line">ON </span><br><span class="line">      s.product_id &#x3D; p.product_id</span><br><span class="line">GROUP BY </span><br><span class="line">      s.product_id</span><br><span class="line">HAVING </span><br><span class="line">      sale_date &gt;&#x3D; &#39;2019-01-01&#39; AND </span><br><span class="line">      sale_date &lt;&#x3D; &#39;2019-03-31&#39;;</span><br></pre></td></tr></table></figure></div>

<h2 id="46-小众书籍"><a href="#46-小众书籍" class="headerlink" title="46. 小众书籍"></a>46. 小众书籍</h2><p>需求：筛选出订单总量 少于10本 的 书籍 。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>book_id</th>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>“Kalila And Demna”</td>
</tr>
<tr>
<td>2</td>
<td>“28 Letters”</td>
</tr>
<tr>
<td>5</td>
<td>“The Hunger Games”</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Books (book_id int, name varchar(50), available_from date);</span><br><span class="line">Create table If Not Exists Orders (order_id int, book_id int, quantity int, dispatch_date date);</span><br><span class="line"></span><br><span class="line">insert into Books (book_id, name, available_from) values (1, &#39;Kalila And Demna&#39;, &#39;2010-01-01&#39;);</span><br><span class="line">insert into Books (book_id, name, available_from) values (2, &#39;28 Letters&#39;, &#39;2012-05-12&#39;);</span><br><span class="line">insert into Books (book_id, name, available_from) values (3, &#39;The Hobbit&#39;, &#39;2019-06-10&#39;);</span><br><span class="line">insert into Books (book_id, name, available_from) values (4, &#39;13 Reasons Why&#39;, &#39;2019-06-01&#39;);</span><br><span class="line">insert into Books (book_id, name, available_from) values (5, &#39;The Hunger Games&#39;, &#39;2008-09-21&#39;);</span><br><span class="line"></span><br><span class="line">insert into Orders (order_id, book_id, quantity, dispatch_date) values (1, 1, 2, &#39;2018-07-26&#39;);</span><br><span class="line">insert into Orders (order_id, book_id, quantity, dispatch_date) values (2, 1, 1, &#39;2018-11-05&#39;);</span><br><span class="line">insert into Orders (order_id, book_id, quantity, dispatch_date) values (3, 3, 8, &#39;2019-06-11&#39;);</span><br><span class="line">insert into Orders (order_id, book_id, quantity, dispatch_date) values (4, 4, 6, &#39;2019-06-05&#39;);</span><br><span class="line">insert into Orders (order_id, book_id, quantity, dispatch_date) values (5, 4, 5, &#39;2019-06-20&#39;);</span><br><span class="line">insert into Orders (order_id, book_id, quantity, dispatch_date) values (6, 5, 9, &#39;2009-02-02&#39;);</span><br><span class="line">insert into Orders (order_id, book_id, quantity, dispatch_date) values (7, 5, 8, &#39;2010-04-13&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      t1.book_id,</span><br><span class="line">      t1.name</span><br><span class="line">from </span><br><span class="line">      (select * from books where available_from &lt;date_sub(&#39;2019-06-23&#39;,interval 1 Month)) t1 </span><br><span class="line">left join </span><br><span class="line">      (select </span><br><span class="line">             *,</span><br><span class="line">             case</span><br><span class="line">                  when dispatch_date between &#39;2018-06-23&#39; and &#39;2019-06-23&#39; then quantity</span><br><span class="line">                  else 0 </span><br><span class="line">              end num </span><br><span class="line">       from orders</span><br><span class="line">      )  t2 </span><br><span class="line">on </span><br><span class="line">     t1.book_id&#x3D;t2.book_id </span><br><span class="line">group by </span><br><span class="line">     t1.book_id </span><br><span class="line">having </span><br><span class="line">     sum(if(t2.num is null,0,t2.num))&lt;10;</span><br></pre></td></tr></table></figure></div>

<h2 id="47-每日新用户统计"><a href="#47-每日新用户统计" class="headerlink" title="47. 每日新用户统计"></a>47. 每日新用户统计</h2><p>需求一：查询每一个项目中员工的平均工作年限，精确到小数点后两位。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>login_date</th>
<th>user_count</th>
</tr>
</thead>
<tbody><tr>
<td>2019-05-01</td>
<td>1</td>
</tr>
<tr>
<td>2019-06-21</td>
<td>2</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Traffic (user_id int, activity ENUM(&#39;login&#39;, &#39;logout&#39;, &#39;jobs&#39;, &#39;groups&#39;, &#39;homepage&#39;), activity_date date);</span><br><span class="line"></span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (1, &#39;login&#39;, &#39;2019-05-01&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (1, &#39;homepage&#39;, &#39;2019-05-01&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (1, &#39;logout&#39;, &#39;2019-05-01&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (2, &#39;login&#39;, &#39;2019-06-21&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (2, &#39;logout&#39;, &#39;2019-06-21&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (3, &#39;login&#39;, &#39;2019-01-01&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (3, &#39;jobs&#39;, &#39;2019-01-01&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (3, &#39;logout&#39;, &#39;2019-01-01&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (4, &#39;login&#39;, &#39;2019-06-21&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (4, &#39;groups&#39;, &#39;2019-06-21&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (4, &#39;logout&#39;, &#39;2019-06-21&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (5, &#39;login&#39;, &#39;2019-03-01&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (5, &#39;logout&#39;, &#39;2019-03-01&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (5, &#39;login&#39;, &#39;2019-06-21&#39;);</span><br><span class="line">insert into Traffic (user_id, activity, activity_date) values (5, &#39;logout&#39;, &#39;2019-06-21&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">    minx as login_date,</span><br><span class="line">    count(user_id) as user_count</span><br><span class="line">from </span><br><span class="line">   (select </span><br><span class="line">          user_id,</span><br><span class="line">          min(activity_date) as minx</span><br><span class="line">    from </span><br><span class="line">          Traffic</span><br><span class="line">    where</span><br><span class="line">          activity&#x3D;&#39;login&#39;</span><br><span class="line">    group by </span><br><span class="line">          user_id</span><br><span class="line">    having </span><br><span class="line">          datediff(&#39;2019-06-30&#39;,minx)&lt;&#x3D;90</span><br><span class="line">    )s</span><br><span class="line">group by </span><br><span class="line">    minx;</span><br></pre></td></tr></table></figure></div>

<h2 id="48-每位学生的最高成绩"><a href="#48-每位学生的最高成绩" class="headerlink" title="48. 每位学生的最高成绩"></a>48. 每位学生的最高成绩</h2><p>需求一：查询每一个项目中员工的平均工作年限，精确到小数点后两位。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>average_years</th>
<th>grade</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>99</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>95</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>82</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Enrollments (student_id int, course_id int, grade int);</span><br><span class="line"></span><br><span class="line">insert into Enrollments (student_id, course_id, grade) values (2, 2, 95);</span><br><span class="line">insert into Enrollments (student_id, course_id, grade) values (2, 3, 95);</span><br><span class="line">insert into Enrollments (student_id, course_id, grade) values (1, 1, 90);</span><br><span class="line">insert into Enrollments (student_id, course_id, grade) values (1, 2, 99);</span><br><span class="line">insert into Enrollments (student_id, course_id, grade) values (3, 1, 80);</span><br><span class="line">insert into Enrollments (student_id, course_id, grade) values (3, 2, 75);</span><br><span class="line">insert into Enrollments (student_id, course_id, grade) values (3, 3, 82);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      t.student_id,</span><br><span class="line">      if(count(e.grade) &gt; 1 ,min(e.course_id),course_id) as course_id,</span><br><span class="line">      t.max1 as grade</span><br><span class="line">from </span><br><span class="line">      Enrollments e </span><br><span class="line">right join</span><br><span class="line">     (select</span><br><span class="line">            student_id,</span><br><span class="line">            max(grade) as max1 </span><br><span class="line">      from </span><br><span class="line">            Enrollments</span><br><span class="line">      group by</span><br><span class="line">            student_id </span><br><span class="line">     )t</span><br><span class="line">on</span><br><span class="line">      t.student_id&#x3D;e.student_id and</span><br><span class="line">      t.max1 &#x3D; e.grade</span><br><span class="line">group by </span><br><span class="line">      e.student_id </span><br><span class="line">order by</span><br><span class="line">      t.student_id;</span><br></pre></td></tr></table></figure></div>

<h2 id="49-Reported-Posts"><a href="#49-Reported-Posts" class="headerlink" title="49. Reported Posts"></a>49. Reported Posts</h2><p>需求一：Write an SQL query that reports the number of posts reported yesterday for each report reason. Assume today is 2019-07-05.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>report_reason</th>
<th>report_count</th>
</tr>
</thead>
<tbody><tr>
<td>spam</td>
<td>1</td>
</tr>
<tr>
<td>racism</td>
<td>2</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Actions (user_id int, post_id int, action_date date, action ENUM(&#39;view&#39;, &#39;like&#39;, &#39;reaction&#39;, &#39;comment&#39;, &#39;report&#39;, &#39;share&#39;), extra varchar(10));</span><br><span class="line"></span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (1, 1, &#39;2019-07-01&#39;, &#39;view&#39;, null);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (1, 1, &#39;2019-07-01&#39;, &#39;like&#39;, null);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (1, 1, &#39;2019-07-01&#39;, &#39;share&#39;, null);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (2, 4, &#39;2019-07-04&#39;, &#39;view&#39;, null);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (2, 4, &#39;2019-07-04&#39;, &#39;report&#39;, &#39;spam&#39;);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (3, 4, &#39;2019-07-04&#39;, &#39;view&#39;, null);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (3, 4, &#39;2019-07-04&#39;, &#39;report&#39;, &#39;spam&#39;);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (4, 3, &#39;2019-07-02&#39;, &#39;view&#39;, null);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (4, 3, &#39;2019-07-02&#39;, &#39;report&#39;, &#39;spam&#39;);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (5, 2, &#39;2019-07-04&#39;, &#39;view&#39;, null);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (5, 2, &#39;2019-07-04&#39;, &#39;report&#39;, &#39;racism&#39;);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (5, 5, &#39;2019-07-04&#39;, &#39;view&#39;, null);</span><br><span class="line">insert into Actions (user_id, post_id, action_date, action, extra) values (5, 5, &#39;2019-07-04&#39;, &#39;report&#39;, &#39;racism&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      extra report_reason,</span><br><span class="line">      count(distinct post_id) report_count </span><br><span class="line">from </span><br><span class="line">      Actions </span><br><span class="line">where </span><br><span class="line">      datediff(&#39;2019-07-05&#39;, action_date) &#x3D; 1 and</span><br><span class="line">      extra is not null and</span><br><span class="line">      action &#x3D; &#39;report&#39; </span><br><span class="line">group by</span><br><span class="line">      extra;</span><br></pre></td></tr></table></figure></div>

<p>需求二：Write an SQL query to find the average for daily percentage of posts that got removed after being reported as spam, rounded to 2 decimal places.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>average_daily_percent</th>
</tr>
</thead>
<tbody><tr>
<td>50.00</td>
</tr>
</tbody></table>
<p>The percentage for 2019-07-04 is 50% because only one post of two spam reported posts was removed.<br>The percentage for 2019-07-02 is 100% because one post was reported as spam and it was removed.<br>The other days had no spam reports so the average is (50 + 100) / 2 = 75%<br>Note that the output is only one number and that we do not care about the remove dates.</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists Removals (post_id int, remove_date date);</span><br><span class="line"></span><br><span class="line">insert into Removals (post_id, remove_date) values (2, &#39;2019-07-20&#39;);</span><br><span class="line">insert into Removals (post_id, remove_date) values (3, &#39;2019-07-18&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">      round(</span><br><span class="line">             SUM(delCount &#x2F; spamCount * 100) </span><br><span class="line">             &#x2F;</span><br><span class="line">             COUNT(DISTINCT action_date),</span><br><span class="line">          2) AS average_daily_percent</span><br><span class="line">FROM </span><br><span class="line">     (SELECT</span><br><span class="line">             action_date,</span><br><span class="line">             COUNT(distinct a.post_id) AS spamCount, </span><br><span class="line">             count(distinct b.post_id) AS delCount</span><br><span class="line">	  FROM</span><br><span class="line">             Actions a</span><br><span class="line">      LEFT JOIN</span><br><span class="line">             Removals b </span><br><span class="line">      ON </span><br><span class="line">             a.post_id &#x3D; b.post_id</span><br><span class="line">      where</span><br><span class="line">             a.extra &#x3D; &#39;spam&#39;</span><br><span class="line">	  GROUP BY </span><br><span class="line">             a.action_date</span><br><span class="line">     ) a;</span><br></pre></td></tr></table></figure></div>

<h2 id="50-Active-Businesses"><a href="#50-Active-Businesses" class="headerlink" title="50. Active Businesses"></a>50. Active Businesses</h2><p>需求：Write an SQL query to find all active businesses. An active business is a business that has more than one event type with occurences greater than the average occurences of that event type among all businesses.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>business_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
</tbody></table>
<p>Average for ‘reviews’, ‘ads’ and ‘page views’ are (7+3)/2=5, (11+7+6)/3=8, (3+12)/2=7.5 respectively.<br>Business with id 1 has 7 ‘reviews’ events (more than 5) and 11 ‘ads’ events (more than 8) so it is an active business.</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Events (business_id int, event_type varchar(10), occurences int);</span><br><span class="line"></span><br><span class="line">insert into Events (business_id, event_type, occurences) values (1, &#39;reviews&#39;, 7);</span><br><span class="line">insert into Events (business_id, event_type, occurences) values (3, &#39;reviews&#39;, 3);</span><br><span class="line">insert into Events (business_id, event_type, occurences) values (1, &#39;ads&#39;, 11);</span><br><span class="line">insert into Events (business_id, event_type, occurences) values (2, &#39;ads&#39;, 7);</span><br><span class="line">insert into Events (business_id, event_type, occurences) values (3, &#39;ads&#39;, 6);</span><br><span class="line">insert into Events (business_id, event_type, occurences) values (1, &#39;page views&#39;, 3);</span><br><span class="line">insert into Events (business_id, event_type, occurences) values (2, &#39;page views&#39;, 12);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">      DISTINCT(business_id) </span><br><span class="line">FROM </span><br><span class="line">      Events e </span><br><span class="line">LEFT JOIN</span><br><span class="line">      Events tmp</span><br><span class="line">ON    </span><br><span class="line">      e.event_type &#x3D; tmp.event_type </span><br><span class="line">WHERE</span><br><span class="line">      e.occurences &gt; tmp.avg_count</span><br><span class="line">GROUP BY </span><br><span class="line">      business_id</span><br><span class="line">HAVING </span><br><span class="line">      COUNT(1) &gt; 1</span><br></pre></td></tr></table></figure></div>

<h2 id="51-User-Purchase-Platform"><a href="#51-User-Purchase-Platform" class="headerlink" title="51. User Purchase Platform"></a>51. User Purchase Platform</h2><p>需求一：Write an SQL query to find the total number of users and the total amount spent using mobile only, desktop only and both mobile and desktop together for each date.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>spend_date</th>
<th>platform</th>
<th>total_amount</th>
<th>total_users</th>
</tr>
</thead>
<tbody><tr>
<td>2019-07-01</td>
<td>desktop</td>
<td>100</td>
<td>1</td>
</tr>
<tr>
<td>2019-07-01</td>
<td>mobile</td>
<td>100</td>
<td>1</td>
</tr>
<tr>
<td>2019-07-01</td>
<td>both</td>
<td>200</td>
<td>1</td>
</tr>
<tr>
<td>2019-07-02</td>
<td>desktop</td>
<td>100</td>
<td>1</td>
</tr>
<tr>
<td>2019-07-02</td>
<td>mobile</td>
<td>100</td>
<td>1</td>
</tr>
<tr>
<td>2019-07-02</td>
<td>both</td>
<td>0</td>
<td>0</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Spending (user_id int, spend_date date, platform ENUM(&#39;desktop&#39;, &#39;mobile&#39;), amount int);</span><br><span class="line"></span><br><span class="line">insert into Spending (user_id, spend_date, platform, amount) values (1, &#39;2019-07-01&#39;, &#39;mobile&#39;, 100);</span><br><span class="line">insert into Spending (user_id, spend_date, platform, amount) values (1, &#39;2019-07-01&#39;, &#39;desktop&#39;, 100);</span><br><span class="line">insert into Spending (user_id, spend_date, platform, amount) values (2, &#39;2019-07-01&#39;, &#39;mobile&#39;, 100);</span><br><span class="line">insert into Spending (user_id, spend_date, platform, amount) values (2, &#39;2019-07-02&#39;, &#39;mobile&#39;, 100);</span><br><span class="line">insert into Spending (user_id, spend_date, platform, amount) values (3, &#39;2019-07-01&#39;, &#39;desktop&#39;, 100);</span><br><span class="line">insert into Spending (user_id, spend_date, platform, amount) values (3, &#39;2019-07-02&#39;, &#39;desktop&#39;, 100);</span><br></pre></td></tr></table></figure></div>

<p>On 2019-07-01, user 1 purchased using both desktop and mobile, user 2 purchased using mobile only and user 3 purchased using desktop only.<br>On 2019-07-02, user 2 purchased using mobile only, user 3 purchased using desktop only and no one purchased using both platforms.</p>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      temp1.spend_date,</span><br><span class="line">      temp1.platform, </span><br><span class="line">      ifnull(temp3.total_amount, 0) total_amount, </span><br><span class="line">      ifnull(temp3.total_users,0) total_users</span><br><span class="line">from</span><br><span class="line">     (select</span><br><span class="line">            distinct(spend_date),</span><br><span class="line">            p.platform   </span><br><span class="line">      from </span><br><span class="line">            Spending,</span><br><span class="line">           (select</span><br><span class="line">                  &#39;desktop&#39; as platform union</span><br><span class="line">            select </span><br><span class="line">                  &#39;mobile&#39; as platform union</span><br><span class="line">            select</span><br><span class="line">                  &#39;both&#39; as platform</span><br><span class="line">           ) as p </span><br><span class="line">       ) as temp1</span><br><span class="line">left join </span><br><span class="line">      (select</span><br><span class="line">             spend_date,</span><br><span class="line">             platform,</span><br><span class="line">             sum(amount) as total_amount,</span><br><span class="line">             count(user_id) total_users</span><br><span class="line">       from</span><br><span class="line">            (select</span><br><span class="line">                   spend_date,</span><br><span class="line">                   user_id, </span><br><span class="line">                   case count(distinct platform)</span><br><span class="line">                        when 1 then platform</span><br><span class="line">                        when 2 then &#39;both&#39;</span><br><span class="line">                   end as  platform, </span><br><span class="line">                   sum(amount) as amount</span><br><span class="line">             from </span><br><span class="line">                   Spending</span><br><span class="line">             group by</span><br><span class="line">                   spend_date,</span><br><span class="line">                   user_id</span><br><span class="line">            ) as temp2</span><br><span class="line">      group by</span><br><span class="line">             spend_date,</span><br><span class="line">             platform</span><br><span class="line">      ) as  temp3</span><br><span class="line">on </span><br><span class="line">      temp1.platform &#x3D; temp3.platform and</span><br><span class="line">      temp1.spend_date &#x3D; temp3.spend_date;</span><br></pre></td></tr></table></figure></div>

<h2 id="52-User-Activity-for-the-Past-30-Days"><a href="#52-User-Activity-for-the-Past-30-Days" class="headerlink" title="52. User Activity for the Past 30 Days"></a>52. User Activity for the Past 30 Days</h2><p>需求一：Write an SQL query to find the average for daily percentage of posts that got removed after being reported as spam, rounded to 2 decimal places.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>day</th>
<th>active_users</th>
</tr>
</thead>
<tbody><tr>
<td>2019-07-20</td>
<td>2</td>
</tr>
<tr>
<td>2019-07-21</td>
<td>2</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Activity (user_id int, session_id int, activity_date date, activity_type ENUM(&#39;open_session&#39;, &#39;end_session&#39;, &#39;scroll_down&#39;, &#39;send_message&#39;));</span><br><span class="line"></span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (1, 1, &#39;2019-07-20&#39;, &#39;open_session&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (1, 1, &#39;2019-07-20&#39;, &#39;scroll_down&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (1, 1, &#39;2019-07-20&#39;, &#39;end_session&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (2, 4, &#39;2019-07-20&#39;, &#39;open_session&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (2, 4, &#39;2019-07-21&#39;, &#39;send_message&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (2, 4, &#39;2019-07-21&#39;, &#39;end_session&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (3, 2, &#39;2019-07-21&#39;, &#39;open_session&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (3, 2, &#39;2019-07-21&#39;, &#39;send_message&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (3, 2, &#39;2019-07-21&#39;, &#39;end_session&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (4, 3, &#39;2019-06-25&#39;, &#39;open_session&#39;);</span><br><span class="line">insert into Activity (user_id, session_id, activity_date, activity_type) values (4, 3, &#39;2019-06-25&#39;, &#39;end_session&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      t.activity_date as day,</span><br><span class="line">      count(distinct t.user_id) as active_users</span><br><span class="line">from </span><br><span class="line">     (select </span><br><span class="line">            activity_date,</span><br><span class="line">            user_id</span><br><span class="line">      from</span><br><span class="line">            Activity</span><br><span class="line">      where </span><br><span class="line">            datediff(&#39;2019-07-27&#39;,activity_date) &lt;30 and</span><br><span class="line">            datediff( &#39;2019-07-27&#39;, activity_date) &gt;&#x3D;0</span><br><span class="line">      group by</span><br><span class="line">            user_id,</span><br><span class="line">            activity_date</span><br><span class="line">      having </span><br><span class="line">            count(activity_type)&gt;0</span><br><span class="line">     ) as t</span><br><span class="line">group by </span><br><span class="line">      t.activity_date;</span><br></pre></td></tr></table></figure></div>

<p>需求二：编写SQL查询以查找截至2019年7月27日（含）的30天内每个用户的平均会话数，四舍五入到小数点后两位。我们要为用户计算的会话是在该时间段内至少进行了一项活动的会话。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>average_sessions_per_user</th>
</tr>
</thead>
<tbody><tr>
<td>1.00</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">      ROUND(IFNULL(AVG(count_session_id), 0), 2) AS average_sessions_per_user</span><br><span class="line">FROM</span><br><span class="line">     (SELECT</span><br><span class="line">            COUNT(DISTINCT session_id) AS count_session_id</span><br><span class="line">      FROM</span><br><span class="line">            Activity</span><br><span class="line">      WHERE </span><br><span class="line">            activity_date BETWEEN DATE_SUB(&quot;2019-07-27&quot;, INTERVAL 29 DAY) AND &quot;2019-07-27&quot;</span><br><span class="line">      GROUP BY</span><br><span class="line">            user_id</span><br><span class="line">      ) AS temp;</span><br></pre></td></tr></table></figure></div>

<h2 id="52-文章浏览"><a href="#52-文章浏览" class="headerlink" title="52. 文章浏览"></a>52. 文章浏览</h2><p>需求一：查询每一个项目中员工的平均工作年限，精确到小数点后两位。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>id</th>
</tr>
</thead>
<tbody><tr>
<td>4</td>
</tr>
<tr>
<td>7</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Views (article_id int, author_id int, viewer_id int, view_date date);</span><br><span class="line">Truncate table Views;</span><br><span class="line">insert into Views (article_id, author_id, viewer_id, view_date) values (1, 3, 5, &#39;2019-08-01&#39;);</span><br><span class="line">insert into Views (article_id, author_id, viewer_id, view_date) values (3, 4, 5, &#39;2019-08-01&#39;);</span><br><span class="line">insert into Views (article_id, author_id, viewer_id, view_date) values (1, 3, &#39;6&#39;, &#39;2019-08-02&#39;);</span><br><span class="line">insert into Views (article_id, author_id, viewer_id, view_date) values (2, &#39;7&#39;, &#39;7&#39;, &#39;2019-08-01&#39;);</span><br><span class="line">insert into Views (article_id, author_id, viewer_id, view_date) values (2, &#39;7&#39;, &#39;6&#39;, &#39;2019-08-02&#39;);</span><br><span class="line">insert into Views (article_id, author_id, viewer_id, view_date) values (4, &#39;7&#39;, 1, &#39;2019-07-22&#39;);</span><br><span class="line">insert into Views (article_id, author_id, viewer_id, view_date) values (3, 4, 4, &#39;2019-07-21&#39;);</span><br><span class="line">insert into Views (article_id, author_id, viewer_id, view_date) values (3, 4, 4, &#39;2019-07-21&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      distinct viewer_id as id</span><br><span class="line">from </span><br><span class="line">      Views </span><br><span class="line">where </span><br><span class="line">      viewer_id &#x3D; author_id</span><br><span class="line">order by </span><br><span class="line">      viewer_id;</span><br></pre></td></tr></table></figure></div>

<p>需求二：Write an SQL query to find all the people who viewed more than one article on the same date, sorted in ascending order by their id.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>project_id</th>
</tr>
</thead>
<tbody><tr>
<td>5</td>
</tr>
<tr>
<td>6</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">      DISTINCT viewer_id as id </span><br><span class="line">FROM </span><br><span class="line">      views</span><br><span class="line">GROUP BY </span><br><span class="line">      viewer_id,view_date</span><br><span class="line">HAVING</span><br><span class="line">      COUNT(DISTINCT article_id)&gt;&#x3D;2</span><br><span class="line">ORDER BY </span><br><span class="line">      viewer_id;</span><br></pre></td></tr></table></figure></div>

<h2 id="53-Market-Analysis"><a href="#53-Market-Analysis" class="headerlink" title="53. Market Analysis"></a>53. Market Analysis</h2><p>需求一：Write an SQL query to find for each user, the join date and the number of orders they made as a buyer in 2019.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>buyer_id</th>
<th>join_date</th>
<th>orders_in_2019</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2018-01-01</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>2018-02-09</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>2018-01-19</td>
<td>0</td>
</tr>
<tr>
<td>4</td>
<td>2018-05-21</td>
<td>0</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Users (user_id int, join_date date, favorite_brand varchar(10));</span><br><span class="line">create table if not exists Orders (order_id int, order_date date, item_id int, buyer_id int, seller_id int);</span><br><span class="line">create table if not exists Items (item_id int, item_brand varchar(10));</span><br><span class="line"></span><br><span class="line">insert into Users (user_id, join_date, favorite_brand) values (1, &#39;2018-01-01&#39;, &#39;Lenovo&#39;);</span><br><span class="line">insert into Users (user_id, join_date, favorite_brand) values (2, &#39;2018-02-09&#39;, &#39;Samsung&#39;);</span><br><span class="line">insert into Users (user_id, join_date, favorite_brand) values (3, &#39;2018-01-19&#39;, &#39;LG&#39;);</span><br><span class="line">insert into Users (user_id, join_date, favorite_brand) values (4, &#39;2018-05-21&#39;, &#39;HP&#39;);</span><br><span class="line"></span><br><span class="line">insert into Orders (order_id, order_date, item_id, buyer_id, seller_id) values (1, &#39;2019-08-01&#39;, 4, 1, 2);</span><br><span class="line">insert into Orders (order_id, order_date, item_id, buyer_id, seller_id) values (2, &#39;2018-08-02&#39;, 2, 1, 3);</span><br><span class="line">insert into Orders (order_id, order_date, item_id, buyer_id, seller_id) values (3, &#39;2019-08-03&#39;, 3, 2, 3);</span><br><span class="line">insert into Orders (order_id, order_date, item_id, buyer_id, seller_id) values (4, &#39;2018-08-04&#39;, 1, 4, 2);</span><br><span class="line">insert into Orders (order_id, order_date, item_id, buyer_id, seller_id) values (5, &#39;2018-08-04&#39;, 1, 3, 4);</span><br><span class="line">insert into Orders (order_id, order_date, item_id, buyer_id, seller_id) values (6, &#39;2019-08-05&#39;, 2, 2, 4);</span><br><span class="line"></span><br><span class="line">insert into Items (item_id, item_brand) values (1, &#39;Samsung&#39;);</span><br><span class="line">insert into Items (item_id, item_brand) values (2, &#39;Lenovo&#39;);</span><br><span class="line">insert into Items (item_id, item_brand) values (3, &#39;LG&#39;);</span><br><span class="line">insert into Items (item_id, item_brand) values (4, &#39;HP&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">       user_id AS buyer_id,</span><br><span class="line">       join_date,</span><br><span class="line">       IFNULL(COUNT(buyer_Id), 0) AS orders_in_2019</span><br><span class="line">FROM </span><br><span class="line">       Users u </span><br><span class="line">LEFT JOIN</span><br><span class="line">       Orders o</span><br><span class="line">ON  </span><br><span class="line">       U.user_id &#x3D; o.buyer_id AND</span><br><span class="line">       order_date &gt;&#x3D; &#39;2019-01-01&#39;</span><br><span class="line">GROUP BY</span><br><span class="line">       user_id</span><br><span class="line">ORDER BY</span><br><span class="line">       user_id;</span><br></pre></td></tr></table></figure></div>

<p>需求二：Write an SQL query to find for each user, whether the brand of the second item (by date) they sold is their favorite brand. If a user sold less than two items, report the answer for that user as no.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>2nd_item_fav_brand</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>no</td>
</tr>
<tr>
<td>2</td>
<td>no</td>
</tr>
<tr>
<td>3</td>
<td>yes</td>
</tr>
<tr>
<td>4</td>
<td>no</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      user_id as seller_id,</span><br><span class="line">      case</span><br><span class="line">         when t3.item_brand is null then &#39;no&#39;</span><br><span class="line">         when t3.item_brand &#x3D; u.favorite_brand then &#39;yes&#39;</span><br><span class="line">         else &#39;no&#39; </span><br><span class="line">      end as 2nd_item_fav_brand</span><br><span class="line">from </span><br><span class="line">      Users u</span><br><span class="line">left join </span><br><span class="line">     (select</span><br><span class="line">            order_id,</span><br><span class="line">            order_date,</span><br><span class="line">            t2.item_id,</span><br><span class="line">            buyer_id,</span><br><span class="line">            seller_id,</span><br><span class="line">            i.item_brand as item_brand</span><br><span class="line">      from </span><br><span class="line">           (select</span><br><span class="line">                  order_id,</span><br><span class="line">                  order_date,</span><br><span class="line">                  item_id,</span><br><span class="line">                  buyer_id,</span><br><span class="line">                  seller_id,</span><br><span class="line">                  cast(if(@prev &#x3D; seller_id,@rank :&#x3D; @rank + 1,@rank :&#x3D; 1) as unsigned) as rank,</span><br><span class="line">                  @prev :&#x3D; seller_id as prev</span><br><span class="line">            from </span><br><span class="line">                 (select</span><br><span class="line">                         order_id,</span><br><span class="line">                         order_date,</span><br><span class="line">                         item_id,</span><br><span class="line">                         buyer_id,</span><br><span class="line">                         seller_id</span><br><span class="line">                  from</span><br><span class="line">                         Orders</span><br><span class="line">                  group by</span><br><span class="line">                         seller_id,</span><br><span class="line">                         order_date</span><br><span class="line">                 ) as t1,</span><br><span class="line">                 (select </span><br><span class="line">                         @rank :&#x3D; 0,</span><br><span class="line">                         @prev :&#x3D; null</span><br><span class="line">                 ) as init) t2,</span><br><span class="line">                 Items i</span><br><span class="line">            where</span><br><span class="line">                  rank &#x3D; 2 and</span><br><span class="line">                  t2.item_id &#x3D; i.item_id</span><br><span class="line">     ) as t3</span><br><span class="line">on </span><br><span class="line">       u.user_id &#x3D; t3.seller_id;</span><br></pre></td></tr></table></figure></div>

<h2 id="54-Product-Price-at-a-Given-Date"><a href="#54-Product-Price-at-a-Given-Date" class="headerlink" title="54. Product Price at a Given Date"></a>54. Product Price at a Given Date</h2><p>需求一：Write an SQL query to find the prices of all products on 2019-08-16. Assume the price of all products before any change is 10.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>project_id</th>
<th>price</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>50</td>
</tr>
<tr>
<td>1</td>
<td>35</td>
</tr>
<tr>
<td>3</td>
<td>10</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Products (product_id int, new_price int, change_date date);</span><br><span class="line">Truncate table Products;</span><br><span class="line">insert into Products (product_id, new_price, change_date) values (1, 20, &#39;2019-08-14&#39;);</span><br><span class="line">insert into Products (product_id, new_price, change_date) values (2, 50, &#39;2019-08-14&#39;);</span><br><span class="line">insert into Products (product_id, new_price, change_date) values (1, 30, &#39;2019-08-15&#39;);</span><br><span class="line">insert into Products (product_id, new_price, change_date) values (1, 35, &#39;2019-08-16&#39;);</span><br><span class="line">insert into Products (product_id, new_price, change_date) values (2, 65, &#39;2019-08-17&#39;);</span><br><span class="line">insert into Products (product_id, new_price, change_date) values (3, 20, &#39;2019-08-18&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    * </span><br><span class="line">FROM </span><br><span class="line">    (SELECT </span><br><span class="line">           product_id,</span><br><span class="line">           new_price AS price</span><br><span class="line">     FROM </span><br><span class="line">           Products</span><br><span class="line">     WHERE (product_id, change_date) IN (</span><br><span class="line">                                          SELECT</span><br><span class="line">                                                product_id,</span><br><span class="line">                                                MAX(change_date)</span><br><span class="line">                                          FROM </span><br><span class="line">                                                Products</span><br><span class="line">                                          WHERE </span><br><span class="line">                                                change_date &lt;&#x3D; &#39;2019-08-16&#39;</span><br><span class="line">                                          GROUP BY</span><br><span class="line">                                                product_id</span><br><span class="line">                                         )</span><br><span class="line">     UNION</span><br><span class="line">     SELECT</span><br><span class="line">            DISTINCT product_id, 10 AS price</span><br><span class="line">     FROM </span><br><span class="line">            Products</span><br><span class="line">     WHERE </span><br><span class="line">            product_id NOT IN (SELECT</span><br><span class="line">                                     product_id</span><br><span class="line">                               FROM  </span><br><span class="line">                                     Products</span><br><span class="line">                               WHERE change_date &lt;&#x3D; &#39;2019-08-16&#39;</span><br><span class="line">                              )</span><br><span class="line">     ) tmp</span><br><span class="line">ORDER BY </span><br><span class="line">     price DESC;</span><br></pre></td></tr></table></figure></div>

<h2 id="55-Immediate-Food-Delivery"><a href="#55-Immediate-Food-Delivery" class="headerlink" title="55. Immediate Food Delivery"></a>55. Immediate Food Delivery</h2><p>需求一：Write an SQL query to find the percentage of immediate orders in the table, rounded to 2 decimal places.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>immediate_percentage</th>
</tr>
</thead>
<tbody><tr>
<td>42.86</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Delivery (delivery_id int, customer_id int, order_date date, customer_pref_delivery_date date);</span><br><span class="line">Truncate table Delivery;</span><br><span class="line">insert into Delivery (delivery_id, customer_id, order_date, customer_pref_delivery_date) values (1, 1, &#39;2019-08-01&#39;, &#39;2019-08-02&#39;);</span><br><span class="line">insert into Delivery (delivery_id, customer_id, order_date, customer_pref_delivery_date) values (2, 5, &#39;2019-08-02&#39;, &#39;2019-08-02&#39;);</span><br><span class="line">insert into Delivery (delivery_id, customer_id, order_date, customer_pref_delivery_date) values (3, 1, &#39;2019-08-11&#39;, &#39;2019-08-11&#39;);</span><br><span class="line">insert into Delivery (delivery_id, customer_id, order_date, customer_pref_delivery_date) values (4, 3, &#39;2019-08-24&#39;, &#39;2019-08-26&#39;);</span><br><span class="line">insert into Delivery (delivery_id, customer_id, order_date, customer_pref_delivery_date) values (5, 4, &#39;2019-08-21&#39;, &#39;2019-08-22&#39;);</span><br><span class="line">insert into Delivery (delivery_id, customer_id, order_date, customer_pref_delivery_date) values (6, 2, &#39;2019-08-11&#39;, &#39;2019-08-13&#39;);</span><br><span class="line">insert into Delivery (delivery_id, customer_id, order_date, customer_pref_delivery_date) values (7, 4, &#39;2019-08-09&#39;, &#39;2019-08-09&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT ROUND(</span><br><span class="line">    (SELECT COUNT(delivery_id)</span><br><span class="line">    FROM Delivery</span><br><span class="line">    WHERE order_date &#x3D; customer_pref_delivery_date)</span><br><span class="line">    * 100 &#x2F; COUNT(delivery_id)</span><br><span class="line">        , 2) </span><br><span class="line">AS immediate_percentage</span><br><span class="line">FROM Delivery;</span><br></pre></td></tr></table></figure></div>

<p>需求二：Write an SQL query to find the percentage of immediate orders in the first orders of all customers, rounded to 2 decimal places.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>immediate_percentage</th>
</tr>
</thead>
<tbody><tr>
<td>40.00</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      round(</span><br><span class="line">               count(case when d.order_date &#x3D; d.customer_pref_delivery_date then 1 end)</span><br><span class="line">               * </span><br><span class="line">               100&#x2F;count(*),</span><br><span class="line">            2) as immediate_percentage</span><br><span class="line">from </span><br><span class="line">     Delivery d,</span><br><span class="line">    (select</span><br><span class="line">           delivery_id,</span><br><span class="line">           customer_id,</span><br><span class="line">           min(order_date) as order_date</span><br><span class="line">     from</span><br><span class="line">           Delivery</span><br><span class="line">     group by</span><br><span class="line">           customer_id</span><br><span class="line">    ) as t</span><br><span class="line">where</span><br><span class="line">     d.customer_id &#x3D; t.customer_id</span><br><span class="line">     and d.order_date &#x3D; t.order_date;</span><br></pre></td></tr></table></figure></div>

<h2 id="56-重新格式化部门表"><a href="#56-重新格式化部门表" class="headerlink" title="56. 重新格式化部门表"></a>56. 重新格式化部门表</h2><p>需求一：编写一个 SQL 查询来重新格式化表，使得新的表中有一个部门 id 列和一些对应 每个月 的收入（revenue）列。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>Jan_Revenue</th>
<th>Feb_Revenue</th>
<th>Mar_Revenue</th>
<th>…</th>
<th>Dec_Revenue</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>8000</td>
<td>7000</td>
<td>6000</td>
<td>…</td>
<td>null</td>
</tr>
<tr>
<td>2</td>
<td>9000</td>
<td>null</td>
<td>null</td>
<td>…</td>
<td>null</td>
</tr>
<tr>
<td>3</td>
<td>null</td>
<td>10000</td>
<td>null</td>
<td>…</td>
<td>null</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Department (id int, revenue int, month varchar(5));</span><br><span class="line">Truncate table Department;</span><br><span class="line">insert into Department (id, revenue, month) values (1, 8000, &#39;Jan&#39;);</span><br><span class="line">insert into Department (id, revenue, month) values (2, 9000, &#39;Jan&#39;);</span><br><span class="line">insert into Department (id, revenue, month) values (3, 10000, &#39;Feb&#39;);</span><br><span class="line">insert into Department (id, revenue, month) values (1, 7000, &#39;Feb&#39;);</span><br><span class="line">insert into Department (id, revenue, month) values (1, 6000, &#39;Mar&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">      DISTINCT id AS &quot;id&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Jan&quot;, revenue, null)) AS &quot;Jan_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Feb&quot;, revenue, null)) AS &quot;Feb_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Mar&quot;, revenue, null)) AS &quot;Mar_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Apr&quot;, revenue, null)) AS &quot;Apr_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;May&quot;, revenue, null)) AS &quot;May_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Jun&quot;, revenue, null)) AS &quot;Jun_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Jul&quot;, revenue, null)) AS &quot;Jul_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Aug&quot;, revenue, null)) AS &quot;Aug_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Sep&quot;, revenue, null)) AS &quot;Sep_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Oct&quot;, revenue, null)) AS &quot;Oct_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Nov&quot;, revenue, null)) AS &quot;Nov_Revenue&quot;,</span><br><span class="line">      SUM(IF (month &#x3D; &quot;Dec&quot;, revenue, null)) AS &quot;Dec_Revenue&quot; </span><br><span class="line">FROM </span><br><span class="line">      Department</span><br><span class="line">GROUP BY id;</span><br></pre></td></tr></table></figure></div>

<h2 id="57-每月交易"><a href="#57-每月交易" class="headerlink" title="57. 每月交易"></a>57. 每月交易</h2><p>需求一：查询每一个项目中员工的平均工作年限，精确到小数点后两位。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>month</th>
<th>country</th>
<th>trans_count</th>
<th>approved_count</th>
<th>trans_total_amount</th>
<th>approved_total_amount</th>
</tr>
</thead>
<tbody><tr>
<td>2018-12</td>
<td>US</td>
<td>2</td>
<td>1</td>
<td>3000</td>
<td>1000</td>
</tr>
<tr>
<td>2019-01</td>
<td>US</td>
<td>1</td>
<td>1</td>
<td>2000</td>
<td>2000</td>
</tr>
<tr>
<td>2019-01</td>
<td>DE</td>
<td>1</td>
<td>1</td>
<td>2000</td>
<td>2000</td>
</tr>
<tr>
<td>2019-05</td>
<td>US</td>
<td>2</td>
<td>1</td>
<td>3000</td>
<td>1000</td>
</tr>
<tr>
<td>2019-06</td>
<td>US</td>
<td>3</td>
<td>2</td>
<td>12000</td>
<td>8000</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists Transactions (id int, country varchar(4), state enum(&#39;approved&#39;, &#39;declined&#39;), amount int, trans_date date);</span><br><span class="line">create table if not exists Chargebacks (trans_id int, trans_date date);</span><br><span class="line"></span><br><span class="line">insert into Transactions (id, country, state, amount, trans_date) values (101, &#39;US&#39;, &#39;approved&#39;, 1000, &#39;2018-12-18&#39;);</span><br><span class="line">insert into Transactions (id, country, state, amount, trans_date) values (102, &#39;US&#39;, &#39;declined&#39;, 2000, &#39;2018-12-19&#39;);</span><br><span class="line">insert into Transactions (id, country, state, amount, trans_date) values (103, &#39;US&#39;, &#39;approved&#39;, 2000, &#39;2019-01-01&#39;);</span><br><span class="line">insert into Transactions (id, country, state, amount, trans_date) values (104, &#39;DE&#39;, &#39;approved&#39;, 2000, &#39;2019-01-07&#39;);</span><br><span class="line">insert into Transactions (id, country, state, amount, trans_date) values (105, &#39;US&#39;, &#39;approved&#39;, 1000, &#39;2019-05-18&#39;);</span><br><span class="line">insert into Transactions (id, country, state, amount, trans_date) values (106, &#39;US&#39;, &#39;declined&#39;, 2000, &#39;2019-05-19&#39;);</span><br><span class="line">insert into Transactions (id, country, state, amount, trans_date) values (107, &#39;US&#39;, &#39;approved&#39;, 3000, &#39;2019-06-10&#39;);</span><br><span class="line">insert into Transactions (id, country, state, amount, trans_date) values (108, &#39;US&#39;, &#39;declined&#39;, 4000, &#39;2019-06-13&#39;);</span><br><span class="line">insert into Transactions (id, country, state, amount, trans_date) values (109, &#39;US&#39;, &#39;approved&#39;, 5000, &#39;2019-06-15&#39;);</span><br><span class="line"></span><br><span class="line">insert into Chargebacks (trans_id, trans_date) values (102, &#39;2019-05-29&#39;);</span><br><span class="line">insert into Chargebacks (trans_id, trans_date) values (101, &#39;2019-06-30&#39;);</span><br><span class="line">insert into Chargebacks (trans_id, trans_date) values (105, &#39;2019-09-18&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      date_format(trans_date,&#39;%Y-%m&#39;) as month,</span><br><span class="line">      country,</span><br><span class="line">      count(*) as trans_count,</span><br><span class="line">      sum(if(state&#x3D;&#39;approved&#39;,1,0)) as approved_count,</span><br><span class="line">      sum(amount) as trans_total_amount,</span><br><span class="line">      sum(if(state&#x3D;&#39;approved&#39;,amount,0)) as approved_total_amount</span><br><span class="line">from </span><br><span class="line">      Transactions t</span><br><span class="line">group by</span><br><span class="line">      date_format(trans_date,&#39;%Y-%m&#39;),</span><br><span class="line">      country;</span><br></pre></td></tr></table></figure></div>

<p>需求二：编写一个 SQL 查询，以查找每个月和每个国家/地区的已批准交易的数量及其总金额、退单的数量及其总金额。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>month</th>
<th>country</th>
<th>approved_count</th>
<th>approved_amount</th>
<th>chargeback_count</th>
<th>chargeback_amount</th>
</tr>
</thead>
<tbody><tr>
<td>2018-12</td>
<td>US</td>
<td>1</td>
<td>1000</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2019-01</td>
<td>DE</td>
<td>1</td>
<td>2000</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2019-01</td>
<td>US</td>
<td>1</td>
<td>2000</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2019-05</td>
<td>US</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>2000</td>
</tr>
<tr>
<td>2019-06</td>
<td>US</td>
<td>2</td>
<td>8000</td>
<td>1</td>
<td>1000</td>
</tr>
<tr>
<td>2019-09</td>
<td>US</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1000</td>
</tr>
</tbody></table>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">       month as MONTH,</span><br><span class="line">       country as COUNTRY,</span><br><span class="line">       SUM(IF(type &#x3D; &#39;approved&#39;, 1, 0)) AS APPROVED_COUNT,</span><br><span class="line">       SUM(IF(type &#x3D; &#39;approved&#39;, amount, 0)) AS APPROVED_AMOUNT,</span><br><span class="line">       SUM(IF(type &#x3D; &#39;chargeback&#39;, 1, 0)) AS CHARGEBACK_COUNT,</span><br><span class="line">       SUM(IF(type &#x3D; &#39;chargeback&#39;, amount, 0)) AS CHARGEBACK_AMOUNT</span><br><span class="line">FROM </span><br><span class="line">      (SELECT </span><br><span class="line">              date_format(t.trans_date,&#39;%Y-%m&#39;) AS month,</span><br><span class="line">              t.country,</span><br><span class="line">              amount,</span><br><span class="line">              &#39;approved&#39; AS type</span><br><span class="line">        FROM</span><br><span class="line">              Transactions AS t</span><br><span class="line">        WHERE </span><br><span class="line">              state &#x3D; &#39;approved&#39;</span><br><span class="line">        UNION ALL</span><br><span class="line">        SELECT</span><br><span class="line">              date_format(c.trans_date,&#39;%Y-%m&#39;) AS month,</span><br><span class="line">              t.country,</span><br><span class="line">              amount,</span><br><span class="line">              &#39;chargeback&#39; AS type</span><br><span class="line">         FROM </span><br><span class="line">              Transactions AS t</span><br><span class="line">         INNER JOIN</span><br><span class="line">              Chargebacks AS c </span><br><span class="line">         ON t.id &#x3D; c.trans_id</span><br><span class="line">         ) AS tt</span><br><span class="line">GROUP BY </span><br><span class="line">         tt.month,</span><br><span class="line">         tt.country;</span><br></pre></td></tr></table></figure></div>

<h2 id="58-锦标赛优胜者"><a href="#58-锦标赛优胜者" class="headerlink" title="58. 锦标赛优胜者"></a>58. 锦标赛优胜者</h2><p>需求一：编写一个 SQL 查询来查找每组中的获胜者。每组的获胜者是在组内得分最高的选手。如果平局，得分最低的选手获胜。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>group_id</th>
<th>player_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>35</td>
</tr>
<tr>
<td>3</td>
<td>40</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Players (player_id int, group_id int);</span><br><span class="line">Create table If Not Exists Matches (match_id int, first_player int, second_player int, first_score int, second_score int);</span><br><span class="line">Truncate table Players;</span><br><span class="line">insert into Players (player_id, group_id) values (10, 2);</span><br><span class="line">insert into Players (player_id, group_id) values (15, 1);</span><br><span class="line">insert into Players (player_id, group_id) values (20, 3);</span><br><span class="line">insert into Players (player_id, group_id) values (25, 1);</span><br><span class="line">insert into Players (player_id, group_id) values (30, 1);</span><br><span class="line">insert into Players (player_id, group_id) values (35, 2);</span><br><span class="line">insert into Players (player_id, group_id) values (40, 3);</span><br><span class="line">insert into Players (player_id, group_id) values (45, 1);</span><br><span class="line">insert into Players (player_id, group_id) values (50, 2);</span><br><span class="line">Truncate table Matches;</span><br><span class="line">insert into Matches (match_id, first_player, second_player, first_score, second_score) values (1, 15, 45, 3, 0);</span><br><span class="line">insert into Matches (match_id, first_player, second_player, first_score, second_score) values (2, 30, 25, 1, 2);</span><br><span class="line">insert into Matches (match_id, first_player, second_player, first_score, second_score) values (3, 30, 15, 2, 0);</span><br><span class="line">insert into Matches (match_id, first_player, second_player, first_score, second_score) values (4, 40, 20, 5, 2);</span><br><span class="line">insert into Matches (match_id, first_player, second_player, first_score, second_score) values (5, 35, 50, 1, 1);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      group_id,</span><br><span class="line">      player_id</span><br><span class="line">from </span><br><span class="line">    (select </span><br><span class="line">           group_id,</span><br><span class="line">           player_id,</span><br><span class="line">           sum(</span><br><span class="line">               case</span><br><span class="line">                   when player_id &#x3D; first_player then first_score</span><br><span class="line">                   when player_id &#x3D; second_player then second_score</span><br><span class="line">               end</span><br><span class="line">               ) as totalScores</span><br><span class="line">     from </span><br><span class="line">          Players p,</span><br><span class="line">          Matches m</span><br><span class="line">     where</span><br><span class="line">          p.player_id &#x3D; m.first_player or</span><br><span class="line">          p.player_id &#x3D; m.second_player</span><br><span class="line">     group by</span><br><span class="line">          group_id,</span><br><span class="line">          player_id</span><br><span class="line">     order by</span><br><span class="line">          group_id,</span><br><span class="line">          totalScores desc,</span><br><span class="line">          player_id</span><br><span class="line">    ) as temp</span><br><span class="line">group by </span><br><span class="line">     group_id</span><br><span class="line">order by </span><br><span class="line">     group_id,</span><br><span class="line">     totalScores desc,</span><br><span class="line">     player_id;</span><br></pre></td></tr></table></figure></div>

<h2 id="59-Last-Person-to-Fit-in-the-Elevator"><a href="#59-Last-Person-to-Fit-in-the-Elevator" class="headerlink" title="59. Last Person to Fit in the Elevator"></a>59. Last Person to Fit in the Elevator</h2><p>需求：Queue table is ordered by turn in the example for simplicity.<br>In the example George Washington(id 5), John Adams(id 3) and Thomas Jefferson(id 6) will enter the elevator as their weight sum is 250 + 350 + 400 = 1000.<br>Thomas Jefferson(id 6) is the last person to fit in the elevator because he has the last turn in these three people.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>person_name</th>
</tr>
</thead>
<tbody><tr>
<td>Thomas Jefferson</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Queue (person_id int, person_name varchar(30), weight int, turn int);</span><br><span class="line">Truncate table Queue;</span><br><span class="line">insert into Queue (person_id, person_name, weight, turn) values (5, &#39;George Washington&#39;, 250, 1);</span><br><span class="line">insert into Queue (person_id, person_name, weight, turn) values (4, &#39;Thomas Jefferson&#39;, 175, 5);</span><br><span class="line">insert into Queue (person_id, person_name, weight, turn) values (3, &#39;John Adams&#39;, 350, 2);</span><br><span class="line">insert into Queue (person_id, person_name, weight, turn) values (6, &#39;Thomas Jefferson&#39;, 400, 3);</span><br><span class="line">insert into Queue (person_id, person_name, weight, turn) values (1, &#39;James Elephant&#39;, 500, 6);</span><br><span class="line">insert into Queue (person_id, person_name, weight, turn) values (2, &#39;Will Johnliams&#39;, 200, 4);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      person_name</span><br><span class="line">from </span><br><span class="line">      Queue q1</span><br><span class="line">where </span><br><span class="line">     (select</span><br><span class="line">           sum(weight)</span><br><span class="line">      from</span><br><span class="line">           Queue</span><br><span class="line">      where turn &lt;&#x3D; q1.turn) &lt;&#x3D; 1000</span><br><span class="line">order by </span><br><span class="line">      turn desc </span><br><span class="line">limit 1;</span><br></pre></td></tr></table></figure></div>

<h2 id="60-Queries-Quality-and-Percentage"><a href="#60-Queries-Quality-and-Percentage" class="headerlink" title="60. Queries Quality and Percentage"></a>60. Queries Quality and Percentage</h2><p>需求：Write an SQL query to find each query_name, the quality and poor_query_percentage.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>query_name</th>
<th>quality</th>
<th>poor_query_percentage</th>
</tr>
</thead>
<tbody><tr>
<td>Dog</td>
<td>2.50</td>
<td>33.33</td>
</tr>
<tr>
<td>Cat</td>
<td>0.66</td>
<td>33.33</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Queries (query_name varchar(30), result varchar(50), position int, rating int);</span><br><span class="line">Truncate table Queries;</span><br><span class="line">insert into Queries (query_name, result, position, rating) values (&#39;Dog&#39;, &#39;Golden Retriever&#39;, 1, 5);</span><br><span class="line">insert into Queries (query_name, result, position, rating) values (&#39;Dog&#39;, &#39;German Shepherd&#39;, 2, 5);</span><br><span class="line">insert into Queries (query_name, result, position, rating) values (&#39;Dog&#39;, &#39;Mule&#39;, &#39;200&#39;, 1);</span><br><span class="line">insert into Queries (query_name, result, position, rating) values (&#39;Cat&#39;, &#39;Shirazi&#39;, 5, 2);</span><br><span class="line">insert into Queries (query_name, result, position, rating) values (&#39;Cat&#39;, &#39;Siamese&#39;, 3, 3);</span><br><span class="line">insert into Queries (query_name, result, position, rating) values (&#39;Cat&#39;, &#39;Sphynx&#39;, 7, 4);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      query_name,</span><br><span class="line">      round(avg(rating&#x2F;position), 2) as quality ,</span><br><span class="line">      round((count(if(rating&lt;3, True, null)) &#x2F; count(query_name)) *100 , 2) as poor_query_percentage</span><br><span class="line">from</span><br><span class="line">      Queries</span><br><span class="line">group by </span><br><span class="line">      query_name;</span><br></pre></td></tr></table></figure></div>

<h2 id="61-Team-Scores-in-Football-Tournament"><a href="#61-Team-Scores-in-Football-Tournament" class="headerlink" title="61. Team Scores in Football Tournament"></a>61. Team Scores in Football Tournament</h2><p>需求一：You would like to compute the scores of all teams after all matches. Points are awarded as follows:<br>A team receives three points if they win a match (Score strictly more goals than the opponent team).<br>A team receives one point if they draw a match (Same number of goals as the opponent team).<br>A team receives no points if they lose a match (Score less goals than the opponent team).<br>Write an SQL query that selects the team_id, team_name and num_points of each team in the tournament after all described matches. Result table should be ordered by num_points (decreasing order). In case of a tie, order the records by team_id (increasing order).</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>team_id</th>
<th>team_name</th>
<th>num_points</th>
</tr>
</thead>
<tbody><tr>
<td>10</td>
<td>Leetcode FC</td>
<td>7</td>
</tr>
<tr>
<td>20</td>
<td>NewYork FC</td>
<td>3</td>
</tr>
<tr>
<td>50</td>
<td>Toronto FC</td>
<td>3</td>
</tr>
<tr>
<td>30</td>
<td>Atlanta FC</td>
<td>1</td>
</tr>
<tr>
<td>40</td>
<td>Chicago FC</td>
<td>0</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Teams (team_id int, team_name varchar(30));</span><br><span class="line">Create table If Not Exists Matches (match_id int, host_team int, guest_team int, host_goals int, guest_goals int);</span><br><span class="line">Truncate table Teams;</span><br><span class="line">insert into Teams (team_id, team_name) values (10, &#39;Leetcode FC&#39;);</span><br><span class="line">insert into Teams (team_id, team_name) values (20, &#39;NewYork FC&#39;);</span><br><span class="line">insert into Teams (team_id, team_name) values (30, &#39;Atlanta FC&#39;);</span><br><span class="line">insert into Teams (team_id, team_name) values (40, &#39;Chicago FC&#39;);</span><br><span class="line">insert into Teams (team_id, team_name) values (50, &#39;Toronto FC&#39;);</span><br><span class="line">Truncate table Matches;</span><br><span class="line">insert into Matches (match_id, host_team, guest_team, host_goals, guest_goals) values (1, 10, 20, 30, 0);</span><br><span class="line">insert into Matches (match_id, host_team, guest_team, host_goals, guest_goals) values (2, 30, 10, 2, 2);</span><br><span class="line">insert into Matches (match_id, host_team, guest_team, host_goals, guest_goals) values (3, 10, 50, 5, 1);</span><br><span class="line">insert into Matches (match_id, host_team, guest_team, host_goals, guest_goals) values (4, 20, 30, 1, 0);</span><br><span class="line">insert into Matches (match_id, host_team, guest_team, host_goals, guest_goals) values (5, 50, 30, 1, 0);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">     *</span><br><span class="line">FROM</span><br><span class="line">    (SELECT </span><br><span class="line">           a.team_id,</span><br><span class="line">           MAX(team_name) AS team_name,</span><br><span class="line">           SUM(</span><br><span class="line">                CASE </span><br><span class="line">			        WHEN a.team_id &#x3D; b.host_team THEN </span><br><span class="line">				    CASE </span><br><span class="line">					    WHEN b.host_goals &gt; b.guest_goals THEN 3</span><br><span class="line">					    WHEN b.host_goals &#x3D; b.guest_goals THEN 1</span><br><span class="line">			            ELSE 0</span><br><span class="line">				    END</span><br><span class="line">			        WHEN a.team_id &#x3D; b.guest_team THEN </span><br><span class="line">				    CASE </span><br><span class="line">					    WHEN b.host_goals &lt; b.guest_goals THEN 3</span><br><span class="line">					    WHEN b.host_goals &#x3D; b.guest_goals THEN 1</span><br><span class="line">					    ELSE 0</span><br><span class="line">				    END</span><br><span class="line">			        ELSE 0</span><br><span class="line">		       END</span><br><span class="line">           ) AS num_points</span><br><span class="line">	FROM </span><br><span class="line">         Teams a</span><br><span class="line">    LEFT JOIN</span><br><span class="line">         Matches b</span><br><span class="line">    ON </span><br><span class="line">         a.team_id &#x3D; b.host_team OR </span><br><span class="line">         a.team_id &#x3D; b.guest_team</span><br><span class="line">	GROUP BY a.team_id</span><br><span class="line">    ) a </span><br><span class="line">ORDER BY</span><br><span class="line">    a.num_points DESC,</span><br><span class="line">    a.team_id;</span><br></pre></td></tr></table></figure></div>

<h2 id="62-报告系统状态的连续日期"><a href="#62-报告系统状态的连续日期" class="headerlink" title="62. 报告系统状态的连续日期"></a>62. 报告系统状态的连续日期</h2><p>需求：系统 每天 运行一个任务。每个任务都独立于先前的任务。任务的状态可以是失败或是成功。编写一个 SQL 查询 2019-01-01 到 2019-12-31 期间任务连续同状态 period_state 的起止日期（start_date 和 end_date）。即如果任务失败了，就是失败状态的起止日期，如果任务成功了，就是成功状态的起止日期。最后结果按照起始日期 start_date 排序</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>period_state</th>
<th>start date</th>
<th>end date</th>
</tr>
</thead>
<tbody><tr>
<td>present</td>
<td>2019-01-01</td>
<td>2019-01-03</td>
</tr>
<tr>
<td>missing</td>
<td>2019-01-04</td>
<td>2019-01-05</td>
</tr>
<tr>
<td>present</td>
<td>2019-01-06</td>
<td>2019-01-06</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Failed (fail_date date);</span><br><span class="line">Create table If Not Exists Succeeded (success_date date);</span><br><span class="line">Truncate table Failed;</span><br><span class="line">insert into Failed (fail_date) values (&#39;2018-12-28&#39;);</span><br><span class="line">insert into Failed (fail_date) values (&#39;2018-12-29&#39;);</span><br><span class="line">insert into Failed (fail_date) values (&#39;2019-01-04&#39;);</span><br><span class="line">insert into Failed (fail_date) values (&#39;2019-01-05&#39;);</span><br><span class="line">Truncate table Succeeded;</span><br><span class="line">insert into Succeeded (success_date) values (&#39;2018-12-30&#39;);</span><br><span class="line">insert into Succeeded (success_date) values (&#39;2018-12-31&#39;);</span><br><span class="line">insert into Succeeded (success_date) values (&#39;2019-01-01&#39;);</span><br><span class="line">insert into Succeeded (success_date) values (&#39;2019-01-02&#39;);</span><br><span class="line">insert into Succeeded (success_date) values (&#39;2019-01-03&#39;);</span><br><span class="line">insert into Succeeded (success_date) values (&#39;2019-01-06&#39;);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      if(str&#x3D;1,&#39;succeeded&#39;,&#39;failed&#39;) as period_state ,</span><br><span class="line">      min(date) as start_date,</span><br><span class="line">      max(date) as end_date</span><br><span class="line">from </span><br><span class="line">     (select </span><br><span class="line">            @diff :&#x3D; @diff+ if(num &#x3D; 1 , 1,0) as diff,</span><br><span class="line">            date,</span><br><span class="line">            str</span><br><span class="line">      from</span><br><span class="line">           (select </span><br><span class="line">                  case </span><br><span class="line">                      when @str &#x3D; str and  date_add(@pre,interval 1 day) &#x3D; date  then @num :&#x3D; @num +1</span><br><span class="line">                      when @str:&#x3D;str then  @num :&#x3D; 1</span><br><span class="line">                      else @num :&#x3D; 1</span><br><span class="line">                  end as num,</span><br><span class="line">                  @pre :&#x3D; date,</span><br><span class="line">                  date,</span><br><span class="line">                  str</span><br><span class="line">            from </span><br><span class="line">                 (select </span><br><span class="line">                        fail_date as date ,</span><br><span class="line">                        0 as &#39;str&#39;</span><br><span class="line">                  from </span><br><span class="line">                        Failed </span><br><span class="line">                  union  </span><br><span class="line">                  select</span><br><span class="line">                        success_date,</span><br><span class="line">                        1</span><br><span class="line">                  from </span><br><span class="line">                        Succeeded </span><br><span class="line">                 ) s,</span><br><span class="line">                 (select @pre:&#x3D;null,@num:&#x3D;0,@str :&#x3D; null) s1</span><br><span class="line">            where </span><br><span class="line">                  date between &#39;2019-01-01&#39; and &#39;2019-12-31&#39;</span><br><span class="line">            order by</span><br><span class="line">                  date </span><br><span class="line">           ) s,</span><br><span class="line">           (select @diff:&#x3D;0)  s1</span><br><span class="line">     ) ys</span><br><span class="line">group by </span><br><span class="line">      diff,</span><br><span class="line">      str;</span><br></pre></td></tr></table></figure></div>

<h2 id="62-每个帖子的评论数"><a href="#62-每个帖子的评论数" class="headerlink" title="62. 每个帖子的评论数"></a>62. 每个帖子的评论数</h2><p>需求一：编写 SQL 语句以查找每个帖子的评论数。结果表应包含帖子的 post_id 和对应的评论数 number_of_comments 并且按 post_id 升序排列。Submissions 可能包含重复的评论。您应该计算每个帖子的唯一评论数。Submissions 可能包含重复的帖子。您应该将它们视为一个帖子。</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>post_id</th>
<th>number_of_comments</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>12</td>
<td>0</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Submissions (sub_id int, parent_id int);</span><br><span class="line">Truncate table Submissions;</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (1, null);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (2, null);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (1, null);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (12, null);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (3, 1);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (5, 2);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (3, 1);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (4, 1);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (9, 1);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (10, 2);</span><br><span class="line">insert into Submissions (sub_id, parent_id) values (6, 7);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	  post_id,</span><br><span class="line">	  COUNT( DISTINCT S2.sub_id ) AS number_of_comments </span><br><span class="line">FROM</span><br><span class="line">	(SELECT</span><br><span class="line">           DISTINCT sub_id AS post_id </span><br><span class="line">     FROM </span><br><span class="line">           Submissions</span><br><span class="line">     WHERE </span><br><span class="line">           parent_id IS NULL</span><br><span class="line">    ) S1</span><br><span class="line">LEFT JOIN</span><br><span class="line">     Submissions S2</span><br><span class="line">ON</span><br><span class="line">     S1.post_id &#x3D; S2.parent_id </span><br><span class="line">GROUP BY</span><br><span class="line">     S1.post_id;</span><br></pre></td></tr></table></figure></div>

<h2 id="63-Average-Selling-Price"><a href="#63-Average-Selling-Price" class="headerlink" title="63. Average Selling Price"></a>63. Average Selling Price</h2><p>需求一：Write an SQL query to find the average selling price for each product.  average_price should be rounded to 2 decimal places.</p>
<p>The query result format is in the following example:</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>average_price</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>6.96</td>
</tr>
<tr>
<td>2</td>
<td>16.96</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Prices (product_id int, start_date date, end_date date, price int);</span><br><span class="line">Create table If Not Exists UnitsSold (product_id int, purchase_date date, units int);</span><br><span class="line">Truncate table Prices;</span><br><span class="line">insert into Prices (product_id, start_date, end_date, price) values (1, &#39;2019-02-17&#39;, &#39;2019-02-28&#39;, 5);</span><br><span class="line">insert into Prices (product_id, start_date, end_date, price) values (1, &#39;2019-03-01&#39;, &#39;2019-03-22&#39;, 20);</span><br><span class="line">insert into Prices (product_id, start_date, end_date, price) values (2, &#39;2019-02-01&#39;, &#39;2019-02-20&#39;, 15);</span><br><span class="line">insert into Prices (product_id, start_date, end_date, price) values (2, &#39;2019-02-21&#39;, &#39;2019-03-31&#39;, 30);</span><br><span class="line">Truncate table UnitsSold;</span><br><span class="line">insert into UnitsSold (product_id, purchase_date, units) values (1, &#39;2019-02-25&#39;, 100);</span><br><span class="line">insert into UnitsSold (product_id, purchase_date, units) values (1, &#39;2019-03-01&#39;, 15);</span><br><span class="line">insert into UnitsSold (product_id, purchase_date, units) values (2, &#39;2019-02-10&#39;, 200);</span><br><span class="line">insert into UnitsSold (product_id, purchase_date, units) values (2, &#39;2019-03-22&#39;, 30);</span><br></pre></td></tr></table></figure></div>

<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      product_id,</span><br><span class="line">      round(sum(a)&#x2F;sum(units),2) as average_price</span><br><span class="line">from</span><br><span class="line">   (select </span><br><span class="line">          p.product_id as product_id,</span><br><span class="line">          price,units,</span><br><span class="line">          price * units as a</span><br><span class="line">    from </span><br><span class="line">          Prices p </span><br><span class="line">    left join</span><br><span class="line">          UnitsSold u</span><br><span class="line">    on </span><br><span class="line">          p.product_id&#x3D;u.product_id and </span><br><span class="line">          purchase_date&lt;&#x3D;end_date and </span><br><span class="line">          purchase_date&gt;&#x3D;start_date</span><br><span class="line">   )t</span><br><span class="line">group by </span><br><span class="line">    product_id;</span><br></pre></td></tr></table></figure></div>

<h2 id="64-Page-Recommendations"><a href="#64-Page-Recommendations" class="headerlink" title="64. Page Recommendations"></a>64. Page Recommendations</h2><p>需求一：Write an SQL query to recommend pages to the user with user_id = 1 using the pages that your friends liked. It should not recommend pages you already liked. Return result table in any order without duplicates.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>recommended_page</th>
</tr>
</thead>
<tbody><tr>
<td>23</td>
</tr>
<tr>
<td>24</td>
</tr>
<tr>
<td>56</td>
</tr>
<tr>
<td>33</td>
</tr>
<tr>
<td>77</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Friendship (user1_id int, user2_id int);</span><br><span class="line">Create table If Not Exists Likes (user_id int, page_id int);</span><br><span class="line">Truncate table Friendship;</span><br><span class="line">insert into Friendship (user1_id, user2_id) values (1, 2);</span><br><span class="line">insert into Friendship (user1_id, user2_id) values (1, 3);</span><br><span class="line">insert into Friendship (user1_id, user2_id) values (1, 4);</span><br><span class="line">insert into Friendship (user1_id, user2_id) values (2, 3);</span><br><span class="line">insert into Friendship (user1_id, user2_id) values (2, 4);</span><br><span class="line">insert into Friendship (user1_id, user2_id) values (2, 5);</span><br><span class="line">insert into Friendship (user1_id, user2_id) values (6, 1);</span><br><span class="line">Truncate table Likes;</span><br><span class="line">insert into Likes (user_id, page_id) values (1, 88);</span><br><span class="line">insert into Likes (user_id, page_id) values (2, 23);</span><br><span class="line">insert into Likes (user_id, page_id) values (3, 24);</span><br><span class="line">insert into Likes (user_id, page_id) values (4, 56);</span><br><span class="line">insert into Likes (user_id, page_id) values (5, 11);</span><br><span class="line">insert into Likes (user_id, page_id) values (6, 33);</span><br><span class="line">insert into Likes (user_id, page_id) values (2, 77);</span><br><span class="line">insert into Likes (user_id, page_id) values (3, 77);</span><br><span class="line">insert into Likes (user_id, page_id) values (6, 88);</span><br></pre></td></tr></table></figure></div>

<p>解释：</p>
<p>User one is friend with users 2, 3, 4 and 6.</p>
<p>Suggested pages are 23 from user 2, 24 from user 3, 56 from user 3 and 33 from user 6.</p>
<p>Page 77 is suggested from both user 2 and user 3.<br>Page 88 is not suggested because user 1 already likes it.</p>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      distinct page_id as recommended_page</span><br><span class="line">from </span><br><span class="line">      Likes,</span><br><span class="line">      friendship</span><br><span class="line">where </span><br><span class="line">      page_id not in(select </span><br><span class="line">                            page_id </span><br><span class="line">                     from </span><br><span class="line">                            likes</span><br><span class="line">                     where </span><br><span class="line">                            user_id&#x3D;1</span><br><span class="line">                    ) and</span><br><span class="line">      user_id in (select</span><br><span class="line">                        user1_id</span><br><span class="line">                  from</span><br><span class="line">                        friendship</span><br><span class="line">                  where user2_id&#x3D;1</span><br><span class="line">                 ) or</span><br><span class="line">      user_id in (select</span><br><span class="line">                        user2_id </span><br><span class="line">                  from </span><br><span class="line">                        friendship </span><br><span class="line">                  where</span><br><span class="line">                        user1_id&#x3D;1);</span><br></pre></td></tr></table></figure></div>

<h2 id="65-All-People-Report-to-the-Given-Manager"><a href="#65-All-People-Report-to-the-Given-Manager" class="headerlink" title="65. All People Report to the Given Manager"></a>65. All People Report to the Given Manager</h2><p>需求一：Write an SQL query to find employee_id of all employees that directly or indirectly report their work to the head of the company.</p>
<p>The indirect relation between managers will not exceed 3 managers as the company is small. Return result table in any order without duplicates.</p>
<p>展示效果：</p>
<table>
<thead>
<tr>
<th>employee_id</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
</tr>
<tr>
<td>77</td>
</tr>
<tr>
<td>4</td>
</tr>
<tr>
<td>7</td>
</tr>
</tbody></table>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Create table If Not Exists Employees (employee_id int, employee_name varchar(30), manager_id int);</span><br><span class="line">Truncate table Employees;</span><br><span class="line">insert into Employees (employee_id, employee_name, manager_id) values (1, &#39;Boss&#39;, 1);</span><br><span class="line">insert into Employees (employee_id, employee_name, manager_id) values (3, &#39;Alice&#39;, 3);</span><br><span class="line">insert into Employees (employee_id, employee_name, manager_id) values (2, &#39;Bob&#39;, 1);</span><br><span class="line">insert into Employees (employee_id, employee_name, manager_id) values (4, &#39;Daniel&#39;, 2);</span><br><span class="line">insert into Employees (employee_id, employee_name, manager_id) values (7, &#39;Luis&#39;, 4);</span><br><span class="line">insert into Employees (employee_id, employee_name, manager_id) values (8, &#39;John&#39;, 3);</span><br><span class="line">insert into Employees (employee_id, employee_name, manager_id) values (9, &#39;Angela&#39;, 8);</span><br><span class="line">insert into Employees (employee_id, employee_name, manager_id) values (77, &#39;Robert&#39;, 1);</span><br></pre></td></tr></table></figure></div>

<p>提示：</p>
<p>The head of the company is the employee with employee_id 1.</p>
<p>The employees with employee_id 2 and 77 report their work directly to the head of the company.</p>
<p>The employee with employee_id 4 report his work indirectly to the head of the company 4 –&gt; 2 –&gt; 1. </p>
<p>The employee with employee_id 7 report his work indirectly to the head of the company 7 –&gt; 4 –&gt; 2 –&gt; 1.</p>
<p>The employees with employee_id 3, 8 and 9 don’t report their work to head of company directly or indirectly. </p>
<p>最终SQL:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">      employee_id EMPLOYEE_ID</span><br><span class="line">from </span><br><span class="line">      employees</span><br><span class="line">where </span><br><span class="line">      manager_id&#x3D;1 and </span><br><span class="line">      employee_id!&#x3D;1</span><br><span class="line">union</span><br><span class="line">select</span><br><span class="line">      a1.employee_id</span><br><span class="line">from </span><br><span class="line">      employees a1,</span><br><span class="line">     (select </span><br><span class="line">            employee_id</span><br><span class="line">      from</span><br><span class="line">            employees</span><br><span class="line">      where</span><br><span class="line">            manager_id&#x3D;1 and</span><br><span class="line">            employee_id!&#x3D;1</span><br><span class="line">     ) a</span><br><span class="line">where</span><br><span class="line">     manager_id&#x3D;a.employee_id</span><br><span class="line">union</span><br><span class="line">select </span><br><span class="line">     a2.employee_id</span><br><span class="line">from </span><br><span class="line">     employees a2,</span><br><span class="line">    (select</span><br><span class="line">           a1.employee_id employee_id</span><br><span class="line">    from </span><br><span class="line">           employees a1,</span><br><span class="line">           (select </span><br><span class="line">                  employee_id</span><br><span class="line">            from</span><br><span class="line">                  employees</span><br><span class="line">            where</span><br><span class="line">                  manager_id&#x3D;1 and</span><br><span class="line">                  employee_id!&#x3D;1</span><br><span class="line">           ) a</span><br><span class="line">    where </span><br><span class="line">           manager_id&#x3D;a.employee_id</span><br><span class="line">    ) a3</span><br><span class="line">where </span><br><span class="line">    manager_id&#x3D;a3.employee_id</span><br><span class="line">order by </span><br><span class="line">    employee_id;</span><br></pre></td></tr></table></figure></div>


</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Yang4</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://masteryang4.github.io/2020/06/18/MySQL%E7%BB%83%E4%B9%A0%E9%A2%98/">https://masteryang4.github.io/2020/06/18/MySQL%E7%BB%83%E4%B9%A0%E9%A2%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://masteryang4.github.io">MasterYangBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL/">SQL    </a><a class="post-meta__tags" href="/tags/MySQL/">MySQL    </a></div><div class="post_share"><div class="social-share" data-image="https://pic.downk.cc/item/5eeb147114195aa5946b0444.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://pic.downk.cc/item/5ea1a251c2a9a83be535b287.png" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://pic.downk.cc/item/5ea1a33ac2a9a83be536f9bc.png" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2020/06/18/kafka%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"><img class="next_cover lazyload" data-src="https://pic.downk.cc/item/5eeb0c4714195aa594556a5b.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>kafka知识整理</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/05/26/HiveSQL之常用查询函数case/" title="HiveSQL之常用查询函数case"><img class="relatedPosts_cover lazyload"data-src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=2286062658,1417061056&fm=26&gp=0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-26</div><div class="relatedPosts_title">HiveSQL之常用查询函数case</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/14/MyISAM与InnoDB的区别-详/" title="MyISAM与InnoDB的区别(详)"><img class="relatedPosts_cover lazyload"data-src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1586800440961&di=126ecdb9ec80fbd1db370da33b54e328&imgtype=0&src=http%3A%2F%2Fcdn.45squared.com%2Fwp-content%2Fuploads%2F20180304110830%2Fmysql-logo.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-14</div><div class="relatedPosts_title">MyISAM与InnoDB的区别(详)</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/14/MySQL事务相关/" title="MySQL事务相关"><img class="relatedPosts_cover lazyload"data-src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1586800440961&di=126ecdb9ec80fbd1db370da33b54e328&imgtype=0&src=http%3A%2F%2Fcdn.45squared.com%2Fwp-content%2Fuploads%2F20180304110830%2Fmysql-logo.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-14</div><div class="relatedPosts_title">MySQL事务相关</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/10/SQL的执行顺序问题/" title="SQL的执行顺序问题"><img class="relatedPosts_cover lazyload"data-src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1586800440961&di=126ecdb9ec80fbd1db370da33b54e328&imgtype=0&src=http%3A%2F%2Fcdn.45squared.com%2Fwp-content%2Fuploads%2F20180304110830%2Fmysql-logo.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-10</div><div class="relatedPosts_title">SQL的执行顺序问题</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'IeiQD5I6g4Doamc68SctmEnW-gzGzoHsz',
  appKey:'ORWhRoGUBY02RR9DMa5OSIow',
  placeholder:'评论一下~（支持Markdown格式）',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Yang4</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/fireworks.js"></script><script id="ribbon" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>